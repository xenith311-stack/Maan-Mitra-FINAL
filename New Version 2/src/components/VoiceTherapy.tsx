import { useState, useEffect, useRef } from 'react';

import { Mic, MicOff, Play, RotateCcw, Heart, CheckCircle, ArrowRight, Home } from 'lucide-react';
// Removed voiceAnalysis import - now using unified STT approach
import { AVAILABLE_VOICES, type VoiceOption } from '../services/speechServices';
// Local VoiceAnalysisResult interface for therapy processing
interface VoiceAnalysisResult {
  transcript: string;
  confidence: number;
  language: string;
  emotionalIndicators: {
    tone: 'calm' | 'stressed' | 'sad' | 'anxious' | 'happy' | 'angry' | 'neutral';
    intensity: number;
    valence: number;
    arousal: number;
    speechRate: 'very_slow' | 'slow' | 'normal' | 'fast' | 'very_fast';
    volume: 'whisper' | 'quiet' | 'normal' | 'loud' | 'shouting';
    pitch: 'very_low' | 'low' | 'normal' | 'high' | 'very_high';
  };
  linguisticFeatures: {
    wordCount: number;
    sentimentScore: number;
    complexityScore: number;
    hesitationMarkers: number;
    fillerWords: number;
    emotionalWords: string[];
    culturalExpressions: string[];
  };
  mentalHealthIndicators: {
    stressLevel: number;
    depressionIndicators: string[];
    anxietyIndicators: string[];
    cognitiveLoad: number;
    emotionalRegulation: number;
  };
  culturalContext: {
    languageMixing: number;
    culturalReferences: string[];
    formalityLevel: number;
    respectMarkers: string[];
  };
  recommendations: {
    immediate: string[];
    therapeutic: string[];
    communication: string[];
  };
}
import { useAuth } from './auth/AuthProvider';
import { firebaseService } from '../services/firebaseService';
import { httpsCallable, getFunctions } from 'firebase/functions';
import { toast } from 'sonner';

interface TherapyExercise {
  id: string;
  title: string;
  subtitle: string;
  description: string;
  benefits: string[];
  scenarios: TherapyScenario[];
  difficulty: 'beginner' | 'intermediate' | 'advanced';
  type: 'breathing' | 'grounding' | 'affirmation' | 'mindfulness' | 'expression' | 'interactive';
  icon: string;
  color: string;
  preview: string;
  isUserControlled: boolean;
}

interface TherapyScenario {
  id: string;
  title: string;
  description: string;
  steps: InteractiveStep[];
}

// Define types for multilingual strings
type LangString = {
  [key: string]: string; // e.g., { en: "Hello", hi: "‡§®‡§Æ‡§∏‡•ç‡§§‡•á", mr: "‡§®‡§Æ‡§∏‡•ç‡§ï‡§æ‡§∞" }
};

type LangStringArray = {
  [key: string]: string[]; // e.g., { en: ["Great!"], hi: ["‡§¨‡§¢‡§º‡§ø‡§Ø‡§æ!"] }
};

interface InteractiveStep {
  id: string;
  type: 'choice' | 'voice' | 'breathing' | 'reflection' | 'challenge';
  title: LangString;
  instruction: LangString;
  voiceGuide: LangString;
  choices?: Choice[];
  expectedResponse?: LangString;
  feedback: {
    positive: LangStringArray;
    encouraging: LangStringArray;
    guidance: LangStringArray;
  };
  duration?: number;
  points?: number;
}

interface Choice {
  id: string;
  text: LangString;
  emoji: string;
  response: LangString;
  nextStep?: string;
  points: number;
}

interface VoiceSession {
  id: string;
  startTime: Date;
  exercise: TherapyExercise;
  scenario: TherapyScenario;
  currentStep: number;
  progress: number;
  voiceAnalysis: VoiceAnalysisResult[];
  userChoices: string[];
  points: number;
  achievements: string[];
  completed: boolean;
  mood: 'excited' | 'calm' | 'focused' | 'reflective';
  selectedVoice: any;
  isUserControlled: boolean;
}

const THERAPY_EXERCISES: TherapyExercise[] = [
  {
    id: 'confidence-builder',
    title: 'Confidence Builder',
    subtitle: 'Unlock your inner strength',
    description: 'Interactive challenges to build unshakeable confidence through voice',
    benefits: ['Builds self-confidence', 'Improves public speaking', 'Reduces social anxiety'],
    difficulty: 'intermediate',
    type: 'interactive',
    icon: 'ü¶Å',
    color: 'from-yellow-400 to-orange-500',
    preview: 'Face your fears and speak with power!',
    isUserControlled: true,
    scenarios: [
      {
        id: 'power-voice',
        title: 'Find Your Power Voice',
        description: 'Discover the voice that commands respect',
        steps: [
          {
            id: 'mood-check',
            type: 'choice',
            title: {
              en: 'How are you feeling right now?',
              hi: '‡§Ü‡§™ ‡§Ö‡§≠‡•Ä ‡§ï‡•à‡§∏‡§æ ‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç?',
              mr: '‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§≤‡§æ ‡§Ü‡§§‡§æ ‡§ï‡§∏‡§Ç ‡§µ‡§æ‡§ü‡§§‡§Ç‡§Ø?'
            },
            instruction: {
              en: 'Choose your current energy level',
              hi: '‡§Ö‡§™‡§®‡•Ä ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§ä‡§∞‡•ç‡§ú‡§æ ‡§∏‡•ç‡§§‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç',
              mr: '‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§∏‡§¶‡•ç‡§Ø ‡§ä‡§∞‡•ç‡§ú‡§æ ‡§™‡§æ‡§§‡§≥‡•Ä ‡§®‡§ø‡§µ‡§°‡§æ'
            },
            voiceGuide: {
              en: 'Let\'s start by checking in with your energy. How are you feeling right now?',
              hi: '‡§ö‡§≤‡§ø‡§è, ‡§Ü‡§™‡§ï‡•Ä ‡§ä‡§∞‡•ç‡§ú‡§æ ‡§ï‡•Ä ‡§ú‡§æ‡§Å‡§ö ‡§ï‡§∞‡§ï‡•á ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§Ü‡§™ ‡§Ö‡§≠‡•Ä ‡§ï‡•à‡§∏‡§æ ‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç?',
              mr: '‡§ö‡§≤‡§æ, ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§ä‡§∞‡•ç‡§ú‡•á‡§ö‡•Ä ‡§§‡§™‡§æ‡§∏‡§£‡•Ä ‡§ï‡§∞‡•Ç‡§® ‡§∏‡•Å‡§∞‡•Å‡§µ‡§æ‡§§ ‡§ï‡§∞‡•Ç‡§Ø‡§æ. ‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§≤‡§æ ‡§Ü‡§§‡§æ ‡§ï‡§∏‡§Ç ‡§µ‡§æ‡§ü‡§§‡§Ç‡§Ø?'
            },
            choices: [
              { 
                id: 'energetic', 
                text: { 
                  en: 'Energetic & Ready', 
                  hi: '‡§ä‡§∞‡•ç‡§ú‡§æ‡§µ‡§æ‡§® ‡§î‡§∞ ‡§§‡•à‡§Ø‡§æ‡§∞',
                  mr: '‡§â‡§§‡•ç‡§∏‡§æ‡§π‡•Ä ‡§Ü‡§£‡§ø ‡§§‡§Ø‡§æ‡§∞'
                }, 
                emoji: '‚ö°', 
                response: { 
                  en: 'Amazing! That energy will fuel your confidence!', 
                  hi: '‡§Ö‡§¶‡•ç‡§≠‡•Å‡§§! ‡§Ø‡§π ‡§ä‡§∞‡•ç‡§ú‡§æ ‡§Ü‡§™‡§ï‡•á ‡§Ü‡§§‡•ç‡§Æ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§ï‡•ã ‡§¨‡§¢‡§º‡§æ‡§è‡§ó‡•Ä!',
                  mr: '‡§Ö‡§™‡•ç‡§∞‡§§‡§ø‡§Æ! ‡§π‡•Ä ‡§ä‡§∞‡•ç‡§ú‡§æ ‡§§‡•Å‡§Æ‡§ö‡§æ ‡§Ü‡§§‡•ç‡§Æ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§µ‡§æ‡§¢‡§µ‡•á‡§≤!'
                }, 
                points: 10 
              },
              { 
                id: 'nervous', 
                text: { 
                  en: 'Nervous but Willing', 
                  hi: '‡§ò‡§¨‡§∞‡§æ‡§Ø‡§æ ‡§π‡•Å‡§Ü ‡§≤‡•á‡§ï‡§ø‡§® ‡§§‡•à‡§Ø‡§æ‡§∞',
                  mr: '‡§ò‡§æ‡§¨‡§∞‡§≤‡•á‡§≤‡§æ ‡§™‡§£ ‡§§‡§Ø‡§æ‡§∞'
                }, 
                emoji: 'üò∞', 
                response: { 
                  en: 'Perfect! Nervousness means you care. Let\'s channel that energy!', 
                  hi: '‡§¨‡§ø‡§≤‡•ç‡§ï‡•Å‡§≤ ‡§∏‡§π‡•Ä! ‡§ò‡§¨‡§∞‡§æ‡§π‡§ü ‡§ï‡§æ ‡§Æ‡§§‡§≤‡§¨ ‡§π‡•à ‡§ï‡§ø ‡§Ü‡§™ ‡§™‡§∞‡§µ‡§æ‡§π ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§Ü‡§á‡§è ‡§á‡§∏ ‡§ä‡§∞‡•ç‡§ú‡§æ ‡§ï‡•ã ‡§∏‡§π‡•Ä ‡§¶‡§ø‡§∂‡§æ ‡§¶‡•á‡§Ç!',
                  mr: '‡§™‡§∞‡§´‡•á‡§ï‡•ç‡§ü! ‡§ò‡§æ‡§¨‡§∞‡§£‡•á ‡§Æ‡•ç‡§π‡§£‡§ú‡•á ‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä ‡§ï‡§æ‡§≥‡§ú‡•Ä ‡§ò‡•á‡§§‡§æ. ‡§ö‡§≤‡§æ ‡§π‡•Ä ‡§ä‡§∞‡•ç‡§ú‡§æ ‡§Ø‡•ã‡§ó‡•ç‡§Ø ‡§¶‡§ø‡§∂‡•á‡§®‡•á ‡§µ‡§≥‡§µ‡•Ç‡§Ø‡§æ!'
                }, 
                points: 15 
              },
              { 
                id: 'tired', 
                text: { 
                  en: 'Tired but Trying', 
                  hi: '‡§•‡§ï‡§æ ‡§π‡•Å‡§Ü ‡§≤‡•á‡§ï‡§ø‡§® ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞ ‡§∞‡§π‡§æ',
                  mr: '‡§•‡§ï‡§≤‡•á‡§≤‡§æ ‡§™‡§£ ‡§™‡•ç‡§∞‡§Ø‡§§‡•ç‡§® ‡§ï‡§∞‡§§ ‡§Ü‡§π‡•á'
                }, 
                emoji: 'üò¥', 
                response: { 
                  en: 'I admire your commitment! Let\'s build energy together!', 
                  hi: '‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§™‡•ç‡§∞‡§§‡§ø‡§¨‡§¶‡•ç‡§ß‡§§‡§æ ‡§ï‡•Ä ‡§™‡•ç‡§∞‡§∂‡§Ç‡§∏‡§æ ‡§ï‡§∞‡§§‡§æ ‡§π‡•Ç‡§Å! ‡§Ü‡§á‡§è ‡§Æ‡§ø‡§≤‡§ï‡§∞ ‡§ä‡§∞‡•ç‡§ú‡§æ ‡§¨‡§®‡§æ‡§§‡•á ‡§π‡•à‡§Ç!',
                  mr: '‡§Æ‡•Ä ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§µ‡§ö‡§®‡§¨‡§¶‡•ç‡§ß‡§§‡•á‡§ö‡•Ä ‡§™‡•ç‡§∞‡§∂‡§Ç‡§∏‡§æ ‡§ï‡§∞‡§§‡•ã! ‡§ö‡§≤‡§æ ‡§è‡§ï‡§§‡•ç‡§∞ ‡§ä‡§∞‡•ç‡§ú‡§æ ‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§£ ‡§ï‡§∞‡•Ç‡§Ø‡§æ!'
                }, 
                points: 20 
              },
              { 
                id: 'excited', 
                text: { 
                  en: 'Excited to Grow', 
                  hi: '‡§¨‡§¢‡§º‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§â‡§§‡•ç‡§∏‡§æ‡§π‡§ø‡§§',
                  mr: '‡§µ‡§æ‡§¢‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§â‡§§‡•ç‡§∏‡§æ‡§π‡§ø‡§§'
                }, 
                emoji: 'üöÄ', 
                response: { 
                  en: 'Your excitement is contagious! Let\'s harness that power!', 
                  hi: '‡§Ü‡§™‡§ï‡§æ ‡§â‡§§‡•ç‡§∏‡§æ‡§π ‡§∏‡§Ç‡§ï‡•ç‡§∞‡§æ‡§Æ‡§ï ‡§π‡•à! ‡§Ü‡§á‡§è ‡§á‡§∏ ‡§∂‡§ï‡•ç‡§§‡§ø ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç!',
                  mr: '‡§§‡•Å‡§Æ‡§ö‡§æ ‡§â‡§§‡•ç‡§∏‡§æ‡§π ‡§∏‡§Ç‡§∏‡§∞‡•ç‡§ó‡§ú‡§®‡•ç‡§Ø ‡§Ü‡§π‡•á! ‡§ö‡§≤‡§æ ‡§Ø‡§æ ‡§∂‡§ï‡•ç‡§§‡•Ä‡§ö‡§æ ‡§µ‡§æ‡§™‡§∞ ‡§ï‡§∞‡•Ç‡§Ø‡§æ!'
                }, 
                points: 10 
              }
            ],
            feedback: {
              positive: {
                en: ['Your honesty is the first step to growth!'],
                hi: ['‡§Ü‡§™‡§ï‡•Ä ‡§à‡§Æ‡§æ‡§®‡§¶‡§æ‡§∞‡•Ä ‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§ï‡•Ä ‡§ì‡§∞ ‡§™‡§π‡§≤‡§æ ‡§ï‡§¶‡§Æ ‡§π‡•à!'],
                mr: ['‡§§‡•Å‡§Æ‡§ö‡§æ ‡§™‡•ç‡§∞‡§æ‡§Æ‡§æ‡§£‡§ø‡§ï‡§™‡§£‡§æ ‡§π‡§æ‡§ö ‡§µ‡§ø‡§ï‡§æ‡§∏‡§æ‡§ö‡§æ ‡§™‡§π‡§ø‡§≤‡§æ ‡§ü‡§™‡•ç‡§™‡§æ ‡§Ü‡§π‡•á!']
              },
              encouraging: {
                en: ['Every feeling is valid and useful!'],
                hi: ['‡§π‡§∞ ‡§≠‡§æ‡§µ‡§®‡§æ ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§î‡§∞ ‡§â‡§™‡§Ø‡•ã‡§ó‡•Ä ‡§π‡•à!'],
                mr: ['‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï ‡§≠‡§æ‡§µ‡§®‡§æ ‡§µ‡•à‡§ß ‡§Ü‡§£‡§ø ‡§â‡§™‡§Ø‡•Å‡§ï‡•ç‡§§ ‡§Ü‡§π‡•á!']
              },
              guidance: {
                en: ['Let\'s use this energy to build something amazing!'],
                hi: ['‡§Ü‡§á‡§è ‡§á‡§∏ ‡§ä‡§∞‡•ç‡§ú‡§æ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡•Å‡§õ ‡§Ö‡§¶‡•ç‡§≠‡•Å‡§§ ‡§¨‡§®‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡§∞‡•á‡§Ç!'],
                mr: ['‡§ö‡§≤‡§æ, ‡§Ø‡§æ ‡§ä‡§∞‡•ç‡§ú‡•á‡§ö‡§æ ‡§µ‡§æ‡§™‡§∞ ‡§ï‡§æ‡§π‡•Ä‡§§‡§∞‡•Ä ‡§Ö‡§¶‡•ç‡§≠‡•Å‡§§ ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§ï‡§∞‡•Ç‡§Ø‡§æ!']
              }
            },
            points: 5
          },
          {
            id: 'power-phrase',
            type: 'voice',
            title: {
              en: 'Speak Your Power Phrase',
              hi: '‡§Ö‡§™‡§®‡§æ ‡§∂‡§ï‡•ç‡§§‡§ø ‡§µ‡§æ‡§ï‡•ç‡§Ø ‡§¨‡•ã‡§≤‡•á‡§Ç',
              mr: '‡§§‡•Å‡§Æ‡§ö‡•á ‡§∂‡§ï‡•ç‡§§‡•Ä ‡§µ‡§æ‡§ï‡•ç‡§Ø ‡§¨‡•ã‡§≤‡§æ'
            },
            instruction: {
              en: 'Say "I am powerful and confident" with conviction',
              hi: '‡§¶‡•É‡§¢‡§º ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§ï‡§π‡•á‡§Ç "‡§Æ‡•à‡§Ç ‡§∂‡§ï‡•ç‡§§‡§ø‡§∂‡§æ‡§≤‡•Ä ‡§î‡§∞ ‡§Ü‡§§‡•ç‡§Æ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏‡•Ä ‡§π‡•Ç‡§Å"',
              mr: '‡§¶‡•É‡§¢ ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏‡§æ‡§®‡•á ‡§Æ‡•ç‡§π‡§£‡§æ "‡§Æ‡•Ä ‡§∂‡§ï‡•ç‡§§‡§ø‡§∂‡§æ‡§≤‡•Ä ‡§Ü‡§£‡§ø ‡§Ü‡§§‡•ç‡§Æ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏‡•Ç ‡§Ü‡§π‡•á"'
            },
            voiceGuide: {
              en: 'Now, I want you to say "I am powerful and confident" - but not just say it, DECLARE it! Let me hear your power!',
              hi: '‡§Ö‡§¨, ‡§Æ‡•à‡§Ç ‡§ö‡§æ‡§π‡§§‡§æ ‡§π‡•Ç‡§Å ‡§ï‡§ø ‡§Ü‡§™ ‡§ï‡§π‡•á‡§Ç "‡§Æ‡•à‡§Ç ‡§∂‡§ï‡•ç‡§§‡§ø‡§∂‡§æ‡§≤‡•Ä ‡§î‡§∞ ‡§Ü‡§§‡•ç‡§Æ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏‡•Ä ‡§π‡•Ç‡§Å" - ‡§≤‡•á‡§ï‡§ø‡§® ‡§∏‡§ø‡§∞‡•ç‡§´ ‡§ï‡§π‡§®‡§æ ‡§®‡§π‡•Ä‡§Ç, ‡§ò‡•ã‡§∑‡§£‡§æ ‡§ï‡§∞‡§®‡§æ! ‡§Æ‡•Å‡§ù‡•á ‡§Ü‡§™‡§ï‡•Ä ‡§∂‡§ï‡•ç‡§§‡§ø ‡§∏‡•Å‡§®‡§æ‡§à ‡§¶‡•á!',
              mr: '‡§Ü‡§§‡§æ, ‡§Æ‡•Ä ‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§≤‡§æ ‡§Æ‡•ç‡§π‡§£‡§æ‡§Ø‡§ö‡§Ç ‡§Ü‡§π‡•á "‡§Æ‡•Ä ‡§∂‡§ï‡•ç‡§§‡§ø‡§∂‡§æ‡§≤‡•Ä ‡§Ü‡§£‡§ø ‡§Ü‡§§‡•ç‡§Æ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏‡•Ç ‡§Ü‡§π‡•á" - ‡§™‡§£ ‡§´‡§ï‡•ç‡§§ ‡§Æ‡•ç‡§π‡§£‡§æ‡§Ø‡§ö‡§Ç ‡§®‡§æ‡§π‡•Ä, ‡§ò‡•ã‡§∑‡§£‡§æ ‡§ï‡§∞‡§æ‡§Ø‡§ö‡•Ä! ‡§Æ‡§≤‡§æ ‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§∂‡§ï‡•ç‡§§‡•Ä ‡§ê‡§ï‡•Ç ‡§¶‡•ç‡§Ø‡§æ!'
            },
            expectedResponse: {
              en: 'I am powerful and confident',
              hi: '‡§Æ‡•à‡§Ç ‡§∂‡§ï‡•ç‡§§‡§ø‡§∂‡§æ‡§≤‡•Ä ‡§î‡§∞ ‡§Ü‡§§‡•ç‡§Æ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏‡•Ä ‡§π‡•Ç‡§Å',
              mr: '‡§Æ‡•Ä ‡§∂‡§ï‡•ç‡§§‡§ø‡§∂‡§æ‡§≤‡•Ä ‡§Ü‡§£‡§ø ‡§Ü‡§§‡•ç‡§Æ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏‡•Ç ‡§Ü‡§π‡•á'
            },
            feedback: {
              positive: {
                en: ['WOW! I can hear the strength in your voice!', 'That was incredible! You sound like a leader!', 'Amazing! Your confidence is shining through!'],
                hi: ['‡§µ‡§æ‡§π! ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§Ü‡§µ‡§æ‡§ú‡§º ‡§Æ‡•á‡§Ç ‡§§‡§æ‡§ï‡§§ ‡§∏‡•Å‡§® ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Å!', '‡§Ø‡§π ‡§Ö‡§µ‡§ø‡§∂‡•ç‡§µ‡§∏‡§®‡•Ä‡§Ø ‡§•‡§æ! ‡§Ü‡§™ ‡§è‡§ï ‡§®‡•á‡§§‡§æ ‡§ï‡•Ä ‡§§‡§∞‡§π ‡§≤‡§ó‡§§‡•á ‡§π‡•à‡§Ç!', '‡§Ö‡§¶‡•ç‡§≠‡•Å‡§§! ‡§Ü‡§™‡§ï‡§æ ‡§Ü‡§§‡•ç‡§Æ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§ö‡§Æ‡§ï ‡§∞‡§π‡§æ ‡§π‡•à!'],
                mr: ['‡§µ‡§æ‡§π! ‡§Æ‡•Ä ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§Ü‡§µ‡§æ‡§ú‡§æ‡§§ ‡§§‡§æ‡§ï‡§¶ ‡§ê‡§ï‡•Ç ‡§∂‡§ï‡§§‡•ã!', '‡§π‡•á ‡§Ö‡§µ‡§ø‡§∂‡•ç‡§µ‡§∏‡§®‡•Ä‡§Ø ‡§π‡•ã‡§§‡•á! ‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä ‡§è‡§ï‡§æ ‡§®‡•á‡§§‡•ç‡§Ø‡§æ‡§∏‡§æ‡§∞‡§ñ‡•á ‡§µ‡§æ‡§ü‡§§‡§æ!', '‡§Ö‡§™‡•ç‡§∞‡§§‡§ø‡§Æ! ‡§§‡•Å‡§Æ‡§ö‡§æ ‡§Ü‡§§‡•ç‡§Æ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§ö‡§Æ‡§ï‡§§ ‡§Ü‡§π‡•á!']
              },
              encouraging: {
                en: ['Good start! Now let\'s add even more power to that voice!', 'I can hear your potential! Let\'s unlock more of it!', 'Nice! Your voice is getting stronger!'],
                hi: ['‡§Ö‡§ö‡•ç‡§õ‡•Ä ‡§∂‡•Å‡§∞‡•Å‡§Ü‡§§! ‡§Ö‡§¨ ‡§Ü‡§á‡§è ‡§â‡§∏ ‡§Ü‡§µ‡§æ‡§ú‡§º ‡§Æ‡•á‡§Ç ‡§î‡§∞ ‡§≠‡•Ä ‡§∂‡§ï‡•ç‡§§‡§ø ‡§ú‡•ã‡§°‡§º‡§§‡•á ‡§π‡•à‡§Ç!', '‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§∏‡•Å‡§® ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Å! ‡§Ü‡§á‡§è ‡§á‡§∏‡•á ‡§î‡§∞ ‡§ñ‡•ã‡§≤‡§§‡•á ‡§π‡•à‡§Ç!', '‡§¨‡§¢‡§º‡§ø‡§Ø‡§æ! ‡§Ü‡§™‡§ï‡•Ä ‡§Ü‡§µ‡§æ‡§ú‡§º ‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à!'],
                mr: ['‡§ö‡§æ‡§Ç‡§ó‡§≤‡•Ä ‡§∏‡•Å‡§∞‡•Å‡§µ‡§æ‡§§! ‡§Ü‡§§‡§æ ‡§§‡•ç‡§Ø‡§æ ‡§Ü‡§µ‡§æ‡§ú‡§æ‡§§ ‡§Ü‡§£‡§ñ‡•Ä ‡§∂‡§ï‡•ç‡§§‡•Ä ‡§ú‡•ã‡§°‡•Ç‡§Ø‡§æ!', '‡§Æ‡•Ä ‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§ê‡§ï‡•Ç ‡§∂‡§ï‡§§‡•ã! ‡§ö‡§≤‡§æ ‡§§‡•Ä ‡§Ü‡§£‡§ñ‡•Ä ‡§â‡§ò‡§°‡•Ç‡§Ø‡§æ!', '‡§õ‡§æ‡§®! ‡§§‡•Å‡§Æ‡§ö‡§æ ‡§Ü‡§µ‡§æ‡§ú ‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§π‡•ã‡§§ ‡§Ü‡§π‡•á!']
              },
              guidance: {
                en: ['Try speaking from your chest, not your throat', 'Stand tall and project your voice forward', 'Imagine you\'re speaking to inspire 1000 people'],
                hi: ['‡§Ö‡§™‡§®‡•á ‡§ó‡§≤‡•á ‡§∏‡•á ‡§®‡§π‡•Ä‡§Ç, ‡§õ‡§æ‡§§‡•Ä ‡§∏‡•á ‡§¨‡•ã‡§≤‡§®‡•á ‡§ï‡•Ä ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞‡•á‡§Ç', '‡§∏‡•Ä‡§ß‡•á ‡§ñ‡§°‡§º‡•á ‡§π‡•ã‡§Ç ‡§î‡§∞ ‡§Ö‡§™‡§®‡•Ä ‡§Ü‡§µ‡§æ‡§ú‡§º ‡§ï‡•ã ‡§Ü‡§ó‡•á ‡§™‡•ç‡§∞‡§ï‡•ç‡§∑‡•á‡§™‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç', '‡§ï‡§≤‡•ç‡§™‡§®‡§æ ‡§ï‡§∞‡•á‡§Ç ‡§ï‡§ø ‡§Ü‡§™ 1000 ‡§≤‡•ã‡§ó‡•ã‡§Ç ‡§ï‡•ã ‡§™‡•ç‡§∞‡•á‡§∞‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§¨‡•ã‡§≤ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç'],
                mr: ['‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§ó‡§≥‡•ç‡§Ø‡§æ‡§§‡•Ç‡§® ‡§®‡§æ‡§π‡•Ä, ‡§õ‡§æ‡§§‡•Ä‡§§‡•Ç‡§® ‡§¨‡•ã‡§≤‡§£‡•ç‡§Ø‡§æ‡§ö‡§æ ‡§™‡•ç‡§∞‡§Ø‡§§‡•ç‡§® ‡§ï‡§∞‡§æ', '‡§∏‡§∞‡§≥ ‡§â‡§≠‡•á ‡§∞‡§æ‡§π‡§æ ‡§Ü‡§£‡§ø ‡§§‡•Å‡§Æ‡§ö‡§æ ‡§Ü‡§µ‡§æ‡§ú ‡§™‡•Å‡§¢‡•á ‡§™‡•ç‡§∞‡§ï‡•ç‡§∑‡•á‡§™‡§ø‡§§ ‡§ï‡§∞‡§æ', '‡§ï‡§≤‡•ç‡§™‡§®‡§æ ‡§ï‡§∞‡§æ ‡§ï‡•Ä ‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä 1000 ‡§≤‡•ã‡§ï‡§æ‡§Ç‡§®‡§æ ‡§™‡•ç‡§∞‡•á‡§∞‡§£‡§æ ‡§¶‡•á‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§¨‡•ã‡§≤‡§§ ‡§Ü‡§π‡§æ‡§§']
              }
            },
            points: 25
          },
          {
            id: 'challenge-choice',
            type: 'choice',
            title: {
              en: 'Choose Your Challenge',
              hi: '‡§Ö‡§™‡§®‡•Ä ‡§ö‡•Å‡§®‡•å‡§§‡•Ä ‡§ö‡•Å‡§®‡•á‡§Ç',
              mr: '‡§§‡•Å‡§Æ‡§ö‡•á ‡§Ü‡§µ‡•ç‡§π‡§æ‡§® ‡§®‡§ø‡§µ‡§°‡§æ'
            },
            instruction: {
              en: 'What confidence challenge excites you most?',
              hi: '‡§ï‡•å‡§® ‡§∏‡•Ä ‡§Ü‡§§‡•ç‡§Æ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§ö‡•Å‡§®‡•å‡§§‡•Ä ‡§Ü‡§™‡§ï‡•ã ‡§∏‡§¨‡§∏‡•á ‡§ú‡•ç‡§Ø‡§æ‡§¶‡§æ ‡§â‡§§‡•ç‡§∏‡§æ‡§π‡§ø‡§§ ‡§ï‡§∞‡§§‡•Ä ‡§π‡•à?',
              mr: '‡§ï‡•ã‡§£‡§§‡•á ‡§Ü‡§§‡•ç‡§Æ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§Ü‡§µ‡•ç‡§π‡§æ‡§® ‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§≤‡§æ ‡§∏‡§∞‡•ç‡§µ‡§æ‡§§ ‡§ú‡§æ‡§∏‡•ç‡§§ ‡§â‡§§‡•ç‡§∏‡§æ‡§π‡§ø‡§§ ‡§ï‡§∞‡§§‡•á?'
            },
            voiceGuide: {
              en: 'You\'re doing great! Now, what challenge would push you to grow the most?',
              hi: '‡§Ü‡§™ ‡§¨‡§π‡•Å‡§§ ‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç! ‡§Ö‡§¨, ‡§ï‡•å‡§® ‡§∏‡•Ä ‡§ö‡•Å‡§®‡•å‡§§‡•Ä ‡§Ü‡§™‡§ï‡•ã ‡§∏‡§¨‡§∏‡•á ‡§ú‡•ç‡§Ø‡§æ‡§¶‡§æ ‡§¨‡§¢‡§º‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§™‡•ç‡§∞‡•á‡§∞‡§ø‡§§ ‡§ï‡§∞‡•á‡§ó‡•Ä?',
              mr: '‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä ‡§ñ‡•Ç‡§™ ‡§ö‡§æ‡§Ç‡§ó‡§≤‡•á ‡§ï‡§∞‡§§ ‡§Ü‡§π‡§æ‡§§! ‡§Ü‡§§‡§æ, ‡§ï‡•ã‡§£‡§§‡•á ‡§Ü‡§µ‡•ç‡§π‡§æ‡§® ‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§≤‡§æ ‡§∏‡§∞‡•ç‡§µ‡§æ‡§§ ‡§ú‡§æ‡§∏‡•ç‡§§ ‡§µ‡§æ‡§¢‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§™‡•ç‡§∞‡•á‡§∞‡§ø‡§§ ‡§ï‡§∞‡•á‡§≤?'
            },
            choices: [
              { 
                id: 'presentation', 
                text: { 
                  en: 'Give a Mini Presentation', 
                  hi: '‡§è‡§ï ‡§õ‡•ã‡§ü‡•Ä ‡§™‡•ç‡§∞‡§∏‡•ç‡§§‡•Å‡§§‡§ø ‡§¶‡•á‡§Ç',
                  mr: '‡§è‡§ï ‡§õ‡•ã‡§ü‡•á ‡§∏‡§æ‡§¶‡§∞‡•Ä‡§ï‡§∞‡§£ ‡§¶‡•ç‡§Ø‡§æ'
                }, 
                emoji: 'üé§', 
                response: { 
                  en: 'Bold choice! Let\'s make you a presentation master!', 
                  hi: '‡§∏‡§æ‡§π‡§∏‡§ø‡§ï ‡§ö‡•Å‡§®‡§æ‡§µ! ‡§Ü‡§á‡§è ‡§Ü‡§™‡§ï‡•ã ‡§™‡•ç‡§∞‡§∏‡•ç‡§§‡•Å‡§§‡§ø ‡§ï‡§æ ‡§Æ‡§æ‡§∏‡•ç‡§ü‡§∞ ‡§¨‡§®‡§æ‡§§‡•á ‡§π‡•à‡§Ç!',
                  mr: '‡§ß‡§æ‡§°‡§∏‡•Ä ‡§®‡§ø‡§µ‡§°! ‡§ö‡§≤‡§æ ‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§≤‡§æ ‡§∏‡§æ‡§¶‡§∞‡•Ä‡§ï‡§∞‡§£‡§æ‡§ö‡§æ ‡§Æ‡§æ‡§∏‡•ç‡§ü‡§∞ ‡§¨‡§®‡§µ‡•Ç‡§Ø‡§æ!'
                }, 
                points: 30 
              },
              { 
                id: 'compliment', 
                text: { 
                  en: 'Give Yourself Compliments', 
                  hi: '‡§Ö‡§™‡§®‡•Ä ‡§§‡§æ‡§∞‡•Ä‡§´ ‡§ï‡§∞‡•á‡§Ç',
                  mr: '‡§∏‡•ç‡§µ‡§§‡§É‡§ö‡•Ä ‡§™‡•ç‡§∞‡§∂‡§Ç‡§∏‡§æ ‡§ï‡§∞‡§æ'
                }, 
                emoji: 'üíñ', 
                response: { 
                  en: 'Self-love is the foundation of confidence!', 
                  hi: '‡§Ü‡§§‡•ç‡§Æ-‡§™‡•ç‡§∞‡•á‡§Æ ‡§Ü‡§§‡•ç‡§Æ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§ï‡•Ä ‡§®‡•Ä‡§Ç‡§µ ‡§π‡•à!',
                  mr: '‡§∏‡•ç‡§µ‡§™‡•ç‡§∞‡•á‡§Æ ‡§π‡§æ ‡§Ü‡§§‡•ç‡§Æ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏‡§æ‡§ö‡§æ ‡§™‡§æ‡§Ø‡§æ ‡§Ü‡§π‡•á!'
                }, 
                points: 25 
              },
              { 
                id: 'story', 
                text: { 
                  en: 'Tell an Inspiring Story', 
                  hi: '‡§è‡§ï ‡§™‡•ç‡§∞‡•á‡§∞‡§£‡§æ‡§¶‡§æ‡§Ø‡§ï ‡§ï‡§π‡§æ‡§®‡•Ä ‡§∏‡•Å‡§®‡§æ‡§è‡§Ç',
                  mr: '‡§è‡§ï ‡§™‡•ç‡§∞‡•á‡§∞‡§£‡§æ‡§¶‡§æ‡§Ø‡§ï ‡§ï‡§•‡§æ ‡§∏‡§æ‡§Ç‡§ó‡§æ'
                }, 
                emoji: 'üìñ', 
                response: { 
                  en: 'Stories have power! Let\'s unleash yours!', 
                  hi: '‡§ï‡§π‡§æ‡§®‡§ø‡§Ø‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§∂‡§ï‡•ç‡§§‡§ø ‡§π‡•ã‡§§‡•Ä ‡§π‡•à! ‡§Ü‡§á‡§è ‡§Ü‡§™‡§ï‡•Ä ‡§∂‡§ï‡•ç‡§§‡§ø ‡§ï‡•ã ‡§â‡§ú‡§æ‡§ó‡§∞ ‡§ï‡§∞‡•á‡§Ç!',
                  mr: '‡§ï‡§•‡§æ‡§Ç‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§∂‡§ï‡•ç‡§§‡•Ä ‡§Ö‡§∏‡§§‡•á! ‡§ö‡§≤‡§æ ‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§∂‡§ï‡•ç‡§§‡•Ä ‡§â‡§ú‡§æ‡§ó‡§∞ ‡§ï‡§∞‡•Ç‡§Ø‡§æ!'
                }, 
                points: 35 
              },
              { 
                id: 'debate', 
                text: { 
                  en: 'Argue Your Point', 
                  hi: '‡§Ö‡§™‡§®‡•Ä ‡§¨‡§æ‡§§ ‡§ï‡§æ ‡§§‡§∞‡•ç‡§ï ‡§¶‡•á‡§Ç',
                  mr: '‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§Æ‡•Å‡§¶‡•ç‡§¶‡•ç‡§Ø‡§æ‡§ö‡§æ ‡§Ø‡•Å‡§ï‡•ç‡§§‡§ø‡§µ‡§æ‡§¶ ‡§ï‡§∞‡§æ'
                }, 
                emoji: '‚öñÔ∏è', 
                response: { 
                  en: 'Excellent! Let\'s build your persuasive power!', 
                  hi: '‡§â‡§§‡•ç‡§ï‡•É‡§∑‡•ç‡§ü! ‡§Ü‡§á‡§è ‡§Ü‡§™‡§ï‡•Ä ‡§™‡•ç‡§∞‡•á‡§∞‡§ï ‡§∂‡§ï‡•ç‡§§‡§ø ‡§ï‡§æ ‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§£ ‡§ï‡§∞‡•á‡§Ç!',
                  mr: '‡§â‡§§‡•ç‡§ï‡•É‡§∑‡•ç‡§ü! ‡§ö‡§≤‡§æ ‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§™‡•ç‡§∞‡•á‡§∞‡§ï ‡§∂‡§ï‡•ç‡§§‡•Ä ‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§£ ‡§ï‡§∞‡•Ç‡§Ø‡§æ!'
                }, 
                points: 40 
              }
            ],
            feedback: {
              positive: {
                en: ['Your choice shows real courage!'],
                hi: ['‡§Ü‡§™‡§ï‡•Ä ‡§™‡§∏‡§Ç‡§¶ ‡§µ‡§æ‡§∏‡•ç‡§§‡§µ‡§ø‡§ï ‡§∏‡§æ‡§π‡§∏ ‡§¶‡§ø‡§ñ‡§æ‡§§‡•Ä ‡§π‡•à!'],
                mr: ['‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§®‡§ø‡§µ‡§° ‡§ñ‡§∞‡•á ‡§ß‡•à‡§∞‡•ç‡§Ø ‡§¶‡§æ‡§ñ‡§µ‡§§‡•á!']
              },
              encouraging: {
                en: ['This challenge will unlock new levels of confidence!'],
                hi: ['‡§Ø‡§π ‡§ö‡•Å‡§®‡•å‡§§‡•Ä ‡§Ü‡§§‡•ç‡§Æ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§ï‡•á ‡§®‡§è ‡§∏‡•ç‡§§‡§∞‡•ã‡§Ç ‡§ï‡•ã ‡§ñ‡•ã‡§≤‡•á‡§ó‡•Ä!'],
                mr: ['‡§π‡•á ‡§Ü‡§µ‡•ç‡§π‡§æ‡§® ‡§Ü‡§§‡•ç‡§Æ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏‡§æ‡§ö‡•á ‡§®‡§µ‡•Ä‡§® ‡§∏‡•ç‡§§‡§∞ ‡§â‡§ò‡§°‡•á‡§≤!']
              },
              guidance: {
                en: ['Remember, growth happens outside your comfort zone!'],
                hi: ['‡§Ø‡§æ‡§¶ ‡§∞‡§ñ‡•á‡§Ç, ‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§Ü‡§™‡§ï‡•á ‡§Ü‡§∞‡§æ‡§Æ ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ ‡§ï‡•á ‡§¨‡§æ‡§π‡§∞ ‡§π‡•ã‡§§‡§æ ‡§π‡•à!'],
                mr: ['‡§≤‡§ï‡•ç‡§∑‡§æ‡§§ ‡§†‡•á‡§µ‡§æ, ‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§Ü‡§∞‡§æ‡§Æ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞‡§æ‡§ö‡•ç‡§Ø‡§æ ‡§¨‡§æ‡§π‡•á‡§∞ ‡§π‡•ã‡§§‡•ã!']
              }
            },
            points: 10
          }
        ]
      }
    ]
  },
  {
    id: 'anxiety-warrior',
    title: 'Anxiety Warrior',
    subtitle: 'Conquer your fears',
    description: 'Battle anxiety with interactive voice techniques and real-time feedback',
    benefits: ['Reduces anxiety attacks', 'Builds coping skills', 'Increases resilience'],
    difficulty: 'beginner',
    type: 'interactive',
    icon: 'üõ°Ô∏è',
    color: 'from-blue-500 to-purple-600',
    preview: 'Transform anxiety into your superpower!',
    isUserControlled: true,
    scenarios: [
      {
        id: 'calm-warrior',
        title: 'Become the Calm Warrior',
        description: 'Learn to face anxiety with strength and grace',
        steps: [
          {
            id: 'anxiety-level',
            type: 'choice',
            title: {
              en: 'What\'s your anxiety level right now?',
              hi: '‡§Ö‡§≠‡•Ä ‡§Ü‡§™‡§ï‡•Ä ‡§ö‡§ø‡§Ç‡§§‡§æ ‡§ï‡§æ ‡§∏‡•ç‡§§‡§∞ ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?',
              mr: '‡§Ü‡§§‡§æ ‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§ö‡§ø‡§Ç‡§§‡•á‡§ö‡•Ä ‡§™‡§æ‡§§‡§≥‡•Ä ‡§ï‡§æ‡§Ø ‡§Ü‡§π‡•á?'
            },
            instruction: {
              en: 'Be honest about how you\'re feeling',
              hi: '‡§Ö‡§™‡§®‡•Ä ‡§≠‡§æ‡§µ‡§®‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§à‡§Æ‡§æ‡§®‡§¶‡§æ‡§∞ ‡§∞‡§π‡•á‡§Ç',
              mr: '‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§≠‡§æ‡§µ‡§®‡§æ‡§Ç‡§¨‡§¶‡•ç‡§¶‡§≤ ‡§™‡•ç‡§∞‡§æ‡§Æ‡§æ‡§£‡§ø‡§ï ‡§∞‡§æ‡§π‡§æ'
            },
            voiceGuide: {
              en: 'First, let\'s acknowledge where you are right now. What\'s your anxiety level?',
              hi: '‡§™‡§π‡§≤‡•á, ‡§Ü‡§á‡§è ‡§∏‡•ç‡§µ‡•Ä‡§ï‡§æ‡§∞ ‡§ï‡§∞‡•á‡§Ç ‡§ï‡§ø ‡§Ü‡§™ ‡§Ö‡§≠‡•Ä ‡§ï‡§π‡§æ‡§Å ‡§π‡•à‡§Ç‡•§ ‡§Ü‡§™‡§ï‡•Ä ‡§ö‡§ø‡§Ç‡§§‡§æ ‡§ï‡§æ ‡§∏‡•ç‡§§‡§∞ ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?',
              mr: '‡§™‡•ç‡§∞‡§•‡§Æ, ‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä ‡§Ü‡§§‡§æ ‡§ï‡•Å‡§†‡•á ‡§Ü‡§π‡§æ‡§§ ‡§π‡•á ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§ï‡§∞‡•Ç‡§Ø‡§æ. ‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§ö‡§ø‡§Ç‡§§‡•á‡§ö‡•Ä ‡§™‡§æ‡§§‡§≥‡•Ä ‡§ï‡§æ‡§Ø ‡§Ü‡§π‡•á?'
            },
            choices: [
              { 
                id: 'low', 
                text: { 
                  en: 'Pretty Calm', 
                  hi: '‡§ï‡§æ‡§´‡•Ä ‡§∂‡§æ‡§Ç‡§§',
                  mr: '‡§¨‡§±‡•ç‡§Ø‡§æ‡§™‡•à‡§ï‡•Ä ‡§∂‡§æ‡§Ç‡§§'
                }, 
                emoji: 'üòå', 
                response: { 
                  en: 'Great! Let\'s build on that calm energy!', 
                  hi: '‡§¨‡§π‡•Å‡§§ ‡§¨‡§¢‡§º‡§ø‡§Ø‡§æ! ‡§Ü‡§á‡§è ‡§â‡§∏ ‡§∂‡§æ‡§Ç‡§§ ‡§ä‡§∞‡•ç‡§ú‡§æ ‡§™‡§∞ ‡§Ü‡§ó‡•á ‡§¨‡§¢‡§º‡§§‡•á ‡§π‡•à‡§Ç!',
                  mr: '‡§õ‡§æ‡§®! ‡§ö‡§≤‡§æ ‡§§‡•ç‡§Ø‡§æ ‡§∂‡§æ‡§Ç‡§§ ‡§ä‡§∞‡•ç‡§ú‡•á‡§µ‡§∞ ‡§™‡•Å‡§¢‡•á ‡§¨‡§æ‡§Ç‡§ß‡•Ç‡§Ø‡§æ!'
                }, 
                points: 10 
              },
              { 
                id: 'medium', 
                text: { 
                  en: 'Somewhat Anxious', 
                  hi: '‡§ï‡•Å‡§õ ‡§π‡§¶ ‡§§‡§ï ‡§ö‡§ø‡§Ç‡§§‡§ø‡§§',
                  mr: '‡§ï‡§æ‡§π‡•Ä‡§∏‡•á ‡§ö‡§ø‡§Ç‡§§‡§ø‡§§'
                }, 
                emoji: 'üòü', 
                response: { 
                  en: 'That\'s normal! We\'ll work through this together!', 
                  hi: '‡§Ø‡§π ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§π‡•à! ‡§π‡§Æ ‡§á‡§∏‡•á ‡§Æ‡§ø‡§≤‡§ï‡§∞ ‡§π‡§≤ ‡§ï‡§∞‡•á‡§Ç‡§ó‡•á!',
                  mr: '‡§π‡•á ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§Ü‡§π‡•á! ‡§Ü‡§Æ‡•ç‡§π‡•Ä ‡§π‡•á ‡§è‡§ï‡§§‡•ç‡§∞ ‡§∏‡•ã‡§°‡§µ‡•Ç!'
                }, 
                points: 15 
              },
              { 
                id: 'high', 
                text: { 
                  en: 'Very Anxious', 
                  hi: '‡§¨‡§π‡•Å‡§§ ‡§ö‡§ø‡§Ç‡§§‡§ø‡§§',
                  mr: '‡§ñ‡•Ç‡§™ ‡§ö‡§ø‡§Ç‡§§‡§ø‡§§'
                }, 
                emoji: 'üò∞', 
                response: { 
                  en: 'I\'m proud of you for being here. You\'re already being brave!', 
                  hi: '‡§Æ‡•Å‡§ù‡•á ‡§ó‡§∞‡•ç‡§µ ‡§π‡•à ‡§ï‡§ø ‡§Ü‡§™ ‡§Ø‡§π‡§æ‡§Å ‡§π‡•à‡§Ç‡•§ ‡§Ü‡§™ ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§π‡•Ä ‡§¨‡§π‡§æ‡§¶‡•Å‡§∞ ‡§π‡•à‡§Ç!',
                  mr: '‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä ‡§á‡§•‡•á ‡§Ü‡§π‡§æ‡§§ ‡§Ø‡§æ‡§ö‡§æ ‡§Æ‡§≤‡§æ ‡§Ö‡§≠‡§ø‡§Æ‡§æ‡§® ‡§Ü‡§π‡•á. ‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä ‡§Ü‡§ß‡•Ä‡§ö ‡§ß‡§æ‡§°‡§∏‡•Ä ‡§Ü‡§π‡§æ‡§§!'
                }, 
                points: 25 
              },
              { 
                id: 'panic', 
                text: { 
                  en: 'Feeling Panicky', 
                  hi: '‡§ò‡§¨‡§∞‡§æ‡§π‡§ü ‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§ï‡§∞ ‡§∞‡§π‡§æ',
                  mr: '‡§ò‡§æ‡§¨‡§∞‡§ü ‡§µ‡§æ‡§ü‡§§ ‡§Ü‡§π‡•á'
                }, 
                emoji: 'üò±', 
                response: { 
                  en: 'You\'re safe here. Let\'s take this one breath at a time.', 
                  hi: '‡§Ü‡§™ ‡§Ø‡§π‡§æ‡§Å ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§π‡•à‡§Ç‡•§ ‡§Ü‡§á‡§è ‡§è‡§ï-‡§è‡§ï ‡§∏‡§æ‡§Ç‡§∏ ‡§≤‡•á‡§ï‡§∞ ‡§Ü‡§ó‡•á ‡§¨‡§¢‡§º‡§§‡•á ‡§π‡•à‡§Ç‡•§',
                  mr: '‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä ‡§á‡§•‡•á ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§Ü‡§π‡§æ‡§§. ‡§ö‡§≤‡§æ ‡§è‡§ï-‡§è‡§ï ‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§ò‡•á‡§ä‡§® ‡§™‡•Å‡§¢‡•á ‡§ú‡§æ‡§ä‡§Ø‡§æ.'
                }, 
                points: 30 
              }
            ],
            feedback: {
              positive: {
                en: ['Acknowledging your feelings takes courage!'],
                hi: ['‡§Ö‡§™‡§®‡•Ä ‡§≠‡§æ‡§µ‡§®‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§∏‡•ç‡§µ‡•Ä‡§ï‡§æ‡§∞ ‡§ï‡§∞‡§®‡§æ ‡§∏‡§æ‡§π‡§∏ ‡§ö‡§æ‡§π‡§ø‡§è!'],
                mr: ['‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§≠‡§æ‡§µ‡§®‡§æ ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§ï‡§∞‡§£‡•á ‡§ß‡•à‡§∞‡•ç‡§Ø ‡§≤‡§æ‡§ó‡§§‡•á!']
              },
              encouraging: {
                en: ['You\'re not alone in this journey!'],
                hi: ['‡§á‡§∏ ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§Æ‡•á‡§Ç ‡§Ü‡§™ ‡§Ö‡§ï‡•á‡§≤‡•á ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡§Ç!'],
                mr: ['‡§Ø‡§æ ‡§™‡•ç‡§∞‡§µ‡§æ‡§∏‡§æ‡§§ ‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä ‡§è‡§ï‡§ü‡•á ‡§®‡§æ‡§π‡•Ä ‡§Ü‡§π‡§æ‡§§!']
              },
              guidance: {
                en: ['Every warrior starts by knowing their battlefield!'],
                hi: ['‡§π‡§∞ ‡§Ø‡•ã‡§¶‡•ç‡§ß‡§æ ‡§Ö‡§™‡§®‡•á ‡§Ø‡•Å‡§¶‡•ç‡§ß‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ ‡§ï‡•ã ‡§ú‡§æ‡§®‡§ï‡§∞ ‡§∂‡•Å‡§∞‡•Å‡§Ü‡§§ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à!'],
                mr: ['‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï ‡§Ø‡•ã‡§¶‡•ç‡§ß‡§æ ‡§§‡•ç‡§Ø‡§æ‡§ö‡•á ‡§Ø‡•Å‡§¶‡•ç‡§ß‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ ‡§ú‡§æ‡§£‡•Ç‡§® ‡§ò‡•á‡§ä‡§® ‡§∏‡•Å‡§∞‡•Å‡§µ‡§æ‡§§ ‡§ï‡§∞‡§§‡•ã!']
              }
            },
            points: 5
          },
          {
            id: 'warrior-breath',
            type: 'breathing',
            title: {
              en: 'Warrior\'s Breath',
              hi: '‡§Ø‡•ã‡§¶‡•ç‡§ß‡§æ ‡§ï‡•Ä ‡§∏‡§æ‡§Ç‡§∏',
              mr: '‡§Ø‡•ã‡§¶‡•ç‡§ß‡•ç‡§Ø‡§æ‡§ö‡§æ ‡§∂‡•ç‡§µ‡§æ‡§∏'
            },
            instruction: {
              en: 'Breathe like a warrior - strong and steady',
              hi: '‡§è‡§ï ‡§Ø‡•ã‡§¶‡•ç‡§ß‡§æ ‡§ï‡•Ä ‡§§‡§∞‡§π ‡§∏‡§æ‡§Ç‡§∏ ‡§≤‡•á‡§Ç - ‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§î‡§∞ ‡§∏‡•ç‡§•‡§ø‡§∞',
              mr: '‡§è‡§ï‡§æ ‡§Ø‡•ã‡§¶‡•ç‡§ß‡•ç‡§Ø‡§æ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡•á ‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§ò‡•ç‡§Ø‡§æ - ‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§Ü‡§£‡§ø ‡§∏‡•ç‡§•‡§ø‡§∞'
            },
            voiceGuide: {
              en: 'Now, let\'s breathe like a warrior. Strong, steady, unshakeable. Breathe in strength for 4 counts, hold your power for 4, release fear for 6. Ready?',
              hi: '‡§Ö‡§¨, ‡§Ü‡§á‡§è ‡§è‡§ï ‡§Ø‡•ã‡§¶‡•ç‡§ß‡§æ ‡§ï‡•Ä ‡§§‡§∞‡§π ‡§∏‡§æ‡§Ç‡§∏ ‡§≤‡•á‡§Ç‡•§ ‡§Æ‡§ú‡§¨‡•Ç‡§§, ‡§∏‡•ç‡§•‡§ø‡§∞, ‡§Ö‡§ü‡§≤‡•§ 4 ‡§ó‡§ø‡§®‡§§‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∂‡§ï‡•ç‡§§‡§ø ‡§Æ‡•á‡§Ç ‡§∏‡§æ‡§Ç‡§∏ ‡§≤‡•á‡§Ç, 4 ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§™‡§®‡•Ä ‡§∂‡§ï‡•ç‡§§‡§ø ‡§ï‡•ã ‡§∞‡•ã‡§ï‡•á‡§Ç, 6 ‡§ï‡•á ‡§≤‡§ø‡§è ‡§°‡§∞ ‡§ï‡•ã ‡§õ‡•ã‡§°‡§º‡•á‡§Ç‡•§ ‡§§‡•à‡§Ø‡§æ‡§∞?',
              mr: '‡§Ü‡§§‡§æ, ‡§ö‡§≤‡§æ ‡§è‡§ï‡§æ ‡§Ø‡•ã‡§¶‡•ç‡§ß‡•ç‡§Ø‡§æ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡•á ‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§ò‡•á‡§ä‡§Ø‡§æ. ‡§Æ‡§ú‡§¨‡•Ç‡§§, ‡§∏‡•ç‡§•‡§ø‡§∞, ‡§Ö‡§ü‡§≤. 4 ‡§Æ‡•ã‡§ú‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§∂‡§ï‡•ç‡§§‡•Ä‡§§ ‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§ò‡•ç‡§Ø‡§æ, 4 ‡§∏‡§æ‡§†‡•Ä ‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§∂‡§ï‡•ç‡§§‡•Ä ‡§ß‡§∞‡§æ, 6 ‡§∏‡§æ‡§†‡•Ä ‡§≠‡•Ä‡§§‡•Ä ‡§∏‡•ã‡§°‡§æ. ‡§§‡§Ø‡§æ‡§∞?'
            },
            feedback: {
              positive: {
                en: ['Your breathing is getting stronger!', 'I can hear the warrior in you!', 'That\'s the breath of someone who won\'t give up!'],
                hi: ['‡§Ü‡§™‡§ï‡•Ä ‡§∏‡§æ‡§Ç‡§∏ ‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à!', '‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§Æ‡•á‡§Ç ‡§Ø‡•ã‡§¶‡•ç‡§ß‡§æ ‡§ï‡•ã ‡§∏‡•Å‡§® ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Å!', '‡§Ø‡§π ‡§ï‡§ø‡§∏‡•Ä ‡§ê‡§∏‡•á ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø ‡§ï‡•Ä ‡§∏‡§æ‡§Ç‡§∏ ‡§π‡•à ‡§ú‡•ã ‡§π‡§æ‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§æ‡§®‡•á‡§ó‡§æ!'],
                mr: ['‡§§‡•Å‡§Æ‡§ö‡§æ ‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§π‡•ã‡§§ ‡§Ü‡§π‡•á!', '‡§Æ‡•Ä ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ‡§§ ‡§Ø‡•ã‡§¶‡•ç‡§ß‡§æ ‡§ê‡§ï‡•Ç ‡§∂‡§ï‡§§‡•ã!', '‡§π‡§æ ‡§Ö‡§∂‡§æ ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡•Ä‡§ö‡§æ ‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§Ü‡§π‡•á ‡§ú‡•ã ‡§π‡§æ‡§∞ ‡§Æ‡§æ‡§®‡§£‡§æ‡§∞ ‡§®‡§æ‡§π‡•Ä!']
              },
              encouraging: {
                en: ['Keep going, you\'re building strength with each breath!', 'Every breath is making you more powerful!'],
                hi: ['‡§ö‡§≤‡§§‡•á ‡§∞‡§π‡•á‡§Ç, ‡§Ü‡§™ ‡§π‡§∞ ‡§∏‡§æ‡§Ç‡§∏ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§§‡§æ‡§ï‡§§ ‡§¨‡§®‡§æ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç!', '‡§π‡§∞ ‡§∏‡§æ‡§Ç‡§∏ ‡§Ü‡§™‡§ï‡•ã ‡§î‡§∞ ‡§∂‡§ï‡•ç‡§§‡§ø‡§∂‡§æ‡§≤‡•Ä ‡§¨‡§®‡§æ ‡§∞‡§π‡•Ä ‡§π‡•à!'],
                mr: ['‡§ö‡§æ‡§≤‡•Ç ‡§†‡•á‡§µ‡§æ, ‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä ‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï ‡§∂‡•ç‡§µ‡§æ‡§∏‡§æ‡§®‡•á ‡§∂‡§ï‡•ç‡§§‡•Ä ‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§£ ‡§ï‡§∞‡§§ ‡§Ü‡§π‡§æ‡§§!', '‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï ‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§≤‡§æ ‡§Ö‡§ß‡§ø‡§ï ‡§∂‡§ï‡•ç‡§§‡§ø‡§∂‡§æ‡§≤‡•Ä ‡§¨‡§®‡§µ‡§§ ‡§Ü‡§π‡•á!']
              },
              guidance: {
                en: ['Feel your feet on the ground', 'Imagine breathing in courage', 'Let each exhale release the tension'],
                hi: ['‡§ú‡§Æ‡•Ä‡§® ‡§™‡§∞ ‡§Ö‡§™‡§®‡•á ‡§™‡•à‡§∞‡•ã‡§Ç ‡§ï‡•ã ‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§ï‡§∞‡•á‡§Ç', '‡§∏‡§æ‡§π‡§∏ ‡§Æ‡•á‡§Ç ‡§∏‡§æ‡§Ç‡§∏ ‡§≤‡•á‡§®‡•á ‡§ï‡•Ä ‡§ï‡§≤‡•ç‡§™‡§®‡§æ ‡§ï‡§∞‡•á‡§Ç', '‡§π‡§∞ ‡§∏‡§æ‡§Ç‡§∏ ‡§õ‡•ã‡§°‡§º‡§®‡•á ‡§™‡§∞ ‡§§‡§®‡§æ‡§µ ‡§ï‡•ã ‡§Æ‡•Å‡§ï‡•ç‡§§ ‡§π‡•ã‡§®‡•á ‡§¶‡•á‡§Ç'],
                mr: ['‡§ú‡§Æ‡§ø‡§®‡•Ä‡§µ‡§∞ ‡§§‡•Å‡§Æ‡§ö‡•á ‡§™‡§æ‡§Ø ‡§ú‡§æ‡§£‡§µ‡§æ', '‡§ß‡•à‡§∞‡•ç‡§Ø‡§æ‡§§ ‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§ò‡•á‡§£‡•ç‡§Ø‡§æ‡§ö‡•Ä ‡§ï‡§≤‡•ç‡§™‡§®‡§æ ‡§ï‡§∞‡§æ', '‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï ‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§∏‡•ã‡§°‡§§‡§æ‡§®‡§æ ‡§§‡§£‡§æ‡§µ ‡§Æ‡•Å‡§ï‡•ç‡§§ ‡§π‡•ã‡§ä ‡§¶‡•ç‡§Ø‡§æ']
              }
            },
            duration: 60000,
            points: 20
          },
          {
            id: 'fear-challenge',
            type: 'voice',
            title: {
              en: 'Challenge Your Fear',
              hi: '‡§Ö‡§™‡§®‡•á ‡§°‡§∞ ‡§ï‡•ã ‡§ö‡•Å‡§®‡•å‡§§‡•Ä ‡§¶‡•á‡§Ç',
              mr: '‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§≠‡•Ä‡§§‡•Ä‡§≤‡§æ ‡§Ü‡§µ‡•ç‡§π‡§æ‡§® ‡§¶‡•ç‡§Ø‡§æ'
            },
            instruction: {
              en: 'Say "I am stronger than my anxiety" with power',
              hi: '‡§∂‡§ï‡•ç‡§§‡§ø ‡§ï‡•á ‡§∏‡§æ‡§• ‡§ï‡§π‡•á‡§Ç "‡§Æ‡•à‡§Ç ‡§Ö‡§™‡§®‡•Ä ‡§ö‡§ø‡§Ç‡§§‡§æ ‡§∏‡•á ‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§π‡•Ç‡§Å"',
              mr: '‡§∂‡§ï‡•ç‡§§‡•Ä‡§®‡•á ‡§Æ‡•ç‡§π‡§£‡§æ "‡§Æ‡•Ä ‡§Æ‡§æ‡§ù‡•ç‡§Ø‡§æ ‡§ö‡§ø‡§Ç‡§§‡•á‡§™‡•á‡§ï‡•ç‡§∑‡§æ ‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§Ü‡§π‡•á"'
            },
            voiceGuide: {
              en: 'Now, look your anxiety in the eye and declare: "I am stronger than my anxiety!" Say it like you mean it!',
              hi: '‡§Ö‡§¨, ‡§Ö‡§™‡§®‡•Ä ‡§ö‡§ø‡§Ç‡§§‡§æ ‡§ï‡•ã ‡§Ü‡§Ç‡§ñ‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§¶‡•á‡§ñ‡•á‡§Ç ‡§î‡§∞ ‡§ò‡•ã‡§∑‡§£‡§æ ‡§ï‡§∞‡•á‡§Ç: "‡§Æ‡•à‡§Ç ‡§Ö‡§™‡§®‡•Ä ‡§ö‡§ø‡§Ç‡§§‡§æ ‡§∏‡•á ‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§π‡•Ç‡§Å!" ‡§á‡§∏‡•á ‡§µ‡•à‡§∏‡•á ‡§ï‡§π‡•á‡§Ç ‡§ú‡•à‡§∏‡•á ‡§Ü‡§™‡§ï‡§æ ‡§Æ‡§§‡§≤‡§¨ ‡§π‡•à!',
              mr: '‡§Ü‡§§‡§æ, ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§ö‡§ø‡§Ç‡§§‡•á‡§≤‡§æ ‡§°‡•ã‡§≥‡•ç‡§Ø‡§æ‡§§ ‡§™‡§æ‡§π‡§æ ‡§Ü‡§£‡§ø ‡§ò‡•ã‡§∑‡§£‡§æ ‡§ï‡§∞‡§æ: "‡§Æ‡•Ä ‡§Æ‡§æ‡§ù‡•ç‡§Ø‡§æ ‡§ö‡§ø‡§Ç‡§§‡•á‡§™‡•á‡§ï‡•ç‡§∑‡§æ ‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§Ü‡§π‡•á!" ‡§Ö‡§∏‡•á ‡§Æ‡•ç‡§π‡§£‡§æ ‡§ú‡§∏‡•á ‡§§‡•Å‡§Æ‡§ö‡§æ ‡§Ö‡§∞‡•ç‡§• ‡§Ü‡§π‡•á!'
            },
            expectedResponse: {
              en: 'I am stronger than my anxiety',
              hi: '‡§Æ‡•à‡§Ç ‡§Ö‡§™‡§®‡•Ä ‡§ö‡§ø‡§Ç‡§§‡§æ ‡§∏‡•á ‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§π‡•Ç‡§Å',
              mr: '‡§Æ‡•Ä ‡§Æ‡§æ‡§ù‡•ç‡§Ø‡§æ ‡§ö‡§ø‡§Ç‡§§‡•á‡§™‡•á‡§ï‡•ç‡§∑‡§æ ‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§Ü‡§π‡•á'
            },
            feedback: {
              positive: {
                en: ['YES! That\'s the voice of a true warrior!', 'Incredible! Your anxiety just heard your strength!', 'Amazing! You just declared war on fear!'],
                hi: ['‡§π‡§æ‡§Å! ‡§Ø‡§π ‡§è‡§ï ‡§∏‡§ö‡•ç‡§ö‡•á ‡§Ø‡•ã‡§¶‡•ç‡§ß‡§æ ‡§ï‡•Ä ‡§Ü‡§µ‡§æ‡§ú‡§º ‡§π‡•à!', '‡§Ö‡§µ‡§ø‡§∂‡•ç‡§µ‡§∏‡§®‡•Ä‡§Ø! ‡§Ü‡§™‡§ï‡•Ä ‡§ö‡§ø‡§Ç‡§§‡§æ ‡§®‡•á ‡§Ö‡§≠‡•Ä ‡§Ü‡§™‡§ï‡•Ä ‡§§‡§æ‡§ï‡§§ ‡§∏‡•Å‡§®‡•Ä!', '‡§Ö‡§¶‡•ç‡§≠‡•Å‡§§! ‡§Ü‡§™‡§®‡•á ‡§Ö‡§≠‡•Ä ‡§°‡§∞ ‡§ï‡•á ‡§ñ‡§ø‡§≤‡§æ‡§´ ‡§Ø‡•Å‡§¶‡•ç‡§ß ‡§ï‡•Ä ‡§ò‡•ã‡§∑‡§£‡§æ ‡§ï‡•Ä!'],
                mr: ['‡§π‡•ã‡§Ø! ‡§π‡§æ ‡§ñ‡§±‡•ç‡§Ø‡§æ ‡§Ø‡•ã‡§¶‡•ç‡§ß‡•ç‡§Ø‡§æ‡§ö‡§æ ‡§Ü‡§µ‡§æ‡§ú ‡§Ü‡§π‡•á!', '‡§Ö‡§µ‡§ø‡§∂‡•ç‡§µ‡§∏‡§®‡•Ä‡§Ø! ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§ö‡§ø‡§Ç‡§§‡•á‡§®‡•á ‡§Ü‡§§‡•ç‡§§‡§æ‡§ö ‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§§‡§æ‡§ï‡§¶ ‡§ê‡§ï‡§≤‡•Ä!', '‡§Ö‡§™‡•ç‡§∞‡§§‡§ø‡§Æ! ‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä ‡§Ü‡§§‡•ç‡§§‡§æ‡§ö ‡§≠‡•Ä‡§§‡•Ä‡§µ‡§ø‡§∞‡•Å‡§¶‡•ç‡§ß ‡§Ø‡•Å‡§¶‡•ç‡§ß‡§æ‡§ö‡•Ä ‡§ò‡•ã‡§∑‡§£‡§æ ‡§ï‡•á‡§≤‡•Ä!']
              },
              encouraging: {
                en: ['Good! Now let\'s make that voice even more powerful!', 'I can hear your strength growing!', 'That\'s it! Keep claiming your power!'],
                hi: ['‡§Ö‡§ö‡•ç‡§õ‡§æ! ‡§Ö‡§¨ ‡§Ü‡§á‡§è ‡§â‡§∏ ‡§Ü‡§µ‡§æ‡§ú‡§º ‡§ï‡•ã ‡§î‡§∞ ‡§≠‡•Ä ‡§∂‡§ï‡•ç‡§§‡§ø‡§∂‡§æ‡§≤‡•Ä ‡§¨‡§®‡§æ‡§§‡•á ‡§π‡•à‡§Ç!', '‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§¨‡§¢‡§º‡§§‡•Ä ‡§§‡§æ‡§ï‡§§ ‡§∏‡•Å‡§® ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Å!', '‡§¨‡§∏ ‡§Ø‡§π‡•Ä! ‡§Ö‡§™‡§®‡•Ä ‡§∂‡§ï‡•ç‡§§‡§ø ‡§ï‡§æ ‡§¶‡§æ‡§µ‡§æ ‡§ï‡§∞‡§§‡•á ‡§∞‡§π‡•á‡§Ç!'],
                mr: ['‡§ö‡§æ‡§Ç‡§ó‡§≤‡•á! ‡§Ü‡§§‡§æ ‡§§‡•ç‡§Ø‡§æ ‡§Ü‡§µ‡§æ‡§ú‡§æ‡§≤‡§æ ‡§Ü‡§£‡§ñ‡•Ä ‡§∂‡§ï‡•ç‡§§‡§ø‡§∂‡§æ‡§≤‡•Ä ‡§¨‡§®‡§µ‡•Ç‡§Ø‡§æ!', '‡§Æ‡•Ä ‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§µ‡§æ‡§¢‡§§‡•Ä ‡§§‡§æ‡§ï‡§¶ ‡§ê‡§ï‡•Ç ‡§∂‡§ï‡§§‡•ã!', '‡§§‡•á‡§ö! ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§∂‡§ï‡•ç‡§§‡•Ä‡§ö‡§æ ‡§¶‡§æ‡§µ‡§æ ‡§ï‡§∞‡§§ ‡§∞‡§æ‡§π‡§æ!']
              },
              guidance: {
                en: ['Speak from your core, not your throat', 'Imagine your anxiety shrinking as you speak', 'Feel the truth of those words in your body'],
                hi: ['‡§Ö‡§™‡§®‡•á ‡§ó‡§≤‡•á ‡§∏‡•á ‡§®‡§π‡•Ä‡§Ç, ‡§Ö‡§™‡§®‡•á ‡§Æ‡•Ç‡§≤ ‡§∏‡•á ‡§¨‡•ã‡§≤‡•á‡§Ç', '‡§ï‡§≤‡•ç‡§™‡§®‡§æ ‡§ï‡§∞‡•á‡§Ç ‡§ï‡§ø ‡§ú‡•à‡§∏‡•á ‡§Ü‡§™ ‡§¨‡•ã‡§≤‡§§‡•á ‡§π‡•à‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§ö‡§ø‡§Ç‡§§‡§æ ‡§∏‡§ø‡§ï‡•Å‡§°‡§º ‡§∞‡§π‡•Ä ‡§π‡•à', '‡§â‡§® ‡§∂‡§¨‡•ç‡§¶‡•ã‡§Ç ‡§ï‡•Ä ‡§∏‡§ö‡•ç‡§ö‡§æ‡§à ‡§ï‡•ã ‡§Ö‡§™‡§®‡•á ‡§∂‡§∞‡•Ä‡§∞ ‡§Æ‡•á‡§Ç ‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§ï‡§∞‡•á‡§Ç'],
                mr: ['‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§ó‡§≥‡•ç‡§Ø‡§æ‡§§‡•Ç‡§® ‡§®‡§æ‡§π‡•Ä, ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§Æ‡•Ç‡§≥‡§æ‡§§‡•Ç‡§® ‡§¨‡•ã‡§≤‡§æ', '‡§ï‡§≤‡•ç‡§™‡§®‡§æ ‡§ï‡§∞‡§æ ‡§ï‡•Ä ‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä ‡§¨‡•ã‡§≤‡§§‡§æ ‡§§‡§∏‡•á ‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§ö‡§ø‡§Ç‡§§‡§æ ‡§Ü‡§ï‡•Å‡§Ç‡§ö‡§® ‡§™‡§æ‡§µ‡§§ ‡§Ü‡§π‡•á', '‡§§‡•ç‡§Ø‡§æ ‡§∂‡§¨‡•ç‡§¶‡§æ‡§Ç‡§ö‡•á ‡§∏‡§§‡•ç‡§Ø ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§∂‡§∞‡•Ä‡§∞‡§æ‡§§ ‡§Ö‡§®‡•Å‡§≠‡§µ‡§æ']
              }
            },
            points: 35
          }
        ]
      }
    ]
  },
  {
    id: 'emotion-explorer',
    title: 'Emotion Explorer',
    subtitle: 'Navigate your inner world',
    description: 'Interactive journey through your emotions with personalized guidance',
    benefits: ['Emotional intelligence', 'Self-awareness', 'Better relationships'],
    difficulty: 'intermediate',
    type: 'interactive',
    icon: 'üß≠',
    color: 'from-pink-400 to-rose-500',
    preview: 'Discover the wisdom in every emotion!',
    isUserControlled: true,
    scenarios: [
      {
        id: 'emotion-map',
        title: 'Map Your Emotional Landscape',
        description: 'Explore and understand your current emotional state',
        steps: [
          {
            id: 'emotion-wheel',
            type: 'choice',
            title: {
              en: 'What emotion is strongest right now?',
              hi: '‡§Ö‡§≠‡•Ä ‡§ï‡•å‡§® ‡§∏‡•Ä ‡§≠‡§æ‡§µ‡§®‡§æ ‡§∏‡§¨‡§∏‡•á ‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§π‡•à?',
              mr: '‡§Ü‡§§‡§æ ‡§ï‡•ã‡§£‡§§‡•Ä ‡§≠‡§æ‡§µ‡§®‡§æ ‡§∏‡§∞‡•ç‡§µ‡§æ‡§§ ‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§Ü‡§π‡•á?'
            },
            instruction: {
              en: 'Choose the emotion that feels most present',
              hi: '‡§â‡§∏ ‡§≠‡§æ‡§µ‡§®‡§æ ‡§ï‡•ã ‡§ö‡•Å‡§®‡•á‡§Ç ‡§ú‡•ã ‡§∏‡§¨‡§∏‡•á ‡§Ö‡§ß‡§ø‡§ï ‡§â‡§™‡§∏‡•ç‡§•‡§ø‡§§ ‡§≤‡§ó‡§§‡•Ä ‡§π‡•à',
              mr: '‡§∏‡§∞‡•ç‡§µ‡§æ‡§§ ‡§ú‡§æ‡§∏‡•ç‡§§ ‡§â‡§™‡§∏‡•ç‡§•‡§ø‡§§ ‡§µ‡§æ‡§ü‡§£‡§æ‡§∞‡•Ä ‡§≠‡§æ‡§µ‡§®‡§æ ‡§®‡§ø‡§µ‡§°‡§æ'
            },
            voiceGuide: {
              en: 'Let\'s explore your emotional landscape. What emotion feels strongest in your body right now?',
              hi: '‡§Ü‡§á‡§è ‡§Ö‡§™‡§®‡•á ‡§≠‡§æ‡§µ‡§®‡§æ‡§§‡•ç‡§Æ‡§ï ‡§™‡§∞‡§ø‡§¶‡•É‡§∂‡•ç‡§Ø ‡§ï‡§æ ‡§Ö‡§®‡•ç‡§µ‡•á‡§∑‡§£ ‡§ï‡§∞‡•á‡§Ç‡•§ ‡§Ö‡§≠‡•Ä ‡§Ü‡§™‡§ï‡•á ‡§∂‡§∞‡•Ä‡§∞ ‡§Æ‡•á‡§Ç ‡§ï‡•å‡§® ‡§∏‡•Ä ‡§≠‡§æ‡§µ‡§®‡§æ ‡§∏‡§¨‡§∏‡•á ‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§≤‡§ó‡§§‡•Ä ‡§π‡•à?',
              mr: '‡§ö‡§≤‡§æ ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§≠‡§æ‡§µ‡§®‡§ø‡§ï ‡§™‡§∞‡§ø‡§¶‡•É‡§∂‡•ç‡§Ø‡§æ‡§ö‡§æ ‡§∂‡•ã‡§ß ‡§ò‡•á‡§ä‡§Ø‡§æ. ‡§Ü‡§§‡§æ ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§∂‡§∞‡•Ä‡§∞‡§æ‡§§ ‡§ï‡•ã‡§£‡§§‡•Ä ‡§≠‡§æ‡§µ‡§®‡§æ ‡§∏‡§∞‡•ç‡§µ‡§æ‡§§ ‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§µ‡§æ‡§ü‡§§‡•á?'
            },
            choices: [
              { 
                id: 'joy', 
                text: { 
                  en: 'Joy & Happiness', 
                  hi: '‡§ñ‡•Å‡§∂‡•Ä ‡§î‡§∞ ‡§™‡•ç‡§∞‡§∏‡§®‡•ç‡§®‡§§‡§æ',
                  mr: '‡§Ü‡§®‡§Ç‡§¶ ‡§Ü‡§£‡§ø ‡§ñ‡•Å‡§∂‡•Ä'
                }, 
                emoji: 'üòä', 
                response: { 
                  en: 'Beautiful! Let\'s amplify that joy!', 
                  hi: '‡§∏‡•Å‡§Ç‡§¶‡§∞! ‡§Ü‡§á‡§è ‡§â‡§∏ ‡§ñ‡•Å‡§∂‡•Ä ‡§ï‡•ã ‡§¨‡§¢‡§º‡§æ‡§§‡•á ‡§π‡•à‡§Ç!',
                  mr: '‡§∏‡•Å‡§Ç‡§¶‡§∞! ‡§ö‡§≤‡§æ ‡§§‡•ã ‡§Ü‡§®‡§Ç‡§¶ ‡§µ‡§æ‡§¢‡§µ‡•Ç‡§Ø‡§æ!'
                }, 
                points: 15 
              },
              { 
                id: 'sadness', 
                text: { 
                  en: 'Sadness & Grief', 
                  hi: '‡§â‡§¶‡§æ‡§∏‡•Ä ‡§î‡§∞ ‡§¶‡•Å‡§É‡§ñ',
                  mr: '‡§¶‡•Å‡§É‡§ñ ‡§Ü‡§£‡§ø ‡§∂‡•ã‡§ï'
                }, 
                emoji: 'üò¢', 
                response: { 
                  en: 'Your sadness is valid and important. Let\'s honor it.', 
                  hi: '‡§Ü‡§™‡§ï‡•Ä ‡§â‡§¶‡§æ‡§∏‡•Ä ‡§µ‡•à‡§ß ‡§î‡§∞ ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§π‡•à‡•§ ‡§Ü‡§á‡§è ‡§á‡§∏‡§ï‡§æ ‡§∏‡§Æ‡•ç‡§Æ‡§æ‡§® ‡§ï‡§∞‡•á‡§Ç‡•§',
                  mr: '‡§§‡•Å‡§Æ‡§ö‡•á ‡§¶‡•Å‡§É‡§ñ ‡§µ‡•à‡§ß ‡§Ü‡§£‡§ø ‡§Æ‡§π‡§§‡•ç‡§§‡•ç‡§µ‡§æ‡§ö‡•á ‡§Ü‡§π‡•á. ‡§ö‡§≤‡§æ ‡§§‡•ç‡§Ø‡§æ‡§ö‡§æ ‡§∏‡§®‡•ç‡§Æ‡§æ‡§® ‡§ï‡§∞‡•Ç‡§Ø‡§æ.'
                }, 
                points: 20 
              },
              { 
                id: 'anger', 
                text: { 
                  en: 'Anger & Frustration', 
                  hi: '‡§ó‡•Å‡§∏‡•ç‡§∏‡§æ ‡§î‡§∞ ‡§®‡§ø‡§∞‡§æ‡§∂‡§æ',
                  mr: '‡§∞‡§æ‡§ó ‡§Ü‡§£‡§ø ‡§®‡§ø‡§∞‡§æ‡§∂‡§æ'
                }, 
                emoji: 'üò†', 
                response: { 
                  en: 'Anger often protects something precious. Let\'s explore it.', 
                  hi: '‡§ó‡•Å‡§∏‡•ç‡§∏‡§æ ‡§Ö‡§ï‡•ç‡§∏‡§∞ ‡§ï‡§ø‡§∏‡•Ä ‡§ï‡•Ä‡§Æ‡§§‡•Ä ‡§ö‡•Ä‡§ú‡§º ‡§ï‡•Ä ‡§∞‡§ï‡•ç‡§∑‡§æ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§ ‡§Ü‡§á‡§è ‡§á‡§∏‡§ï‡§æ ‡§Ö‡§®‡•ç‡§µ‡•á‡§∑‡§£ ‡§ï‡§∞‡•á‡§Ç‡•§',
                  mr: '‡§∞‡§æ‡§ó ‡§Ö‡§®‡•á‡§ï‡§¶‡§æ ‡§ï‡§æ‡§π‡•Ä‡§§‡§∞‡•Ä ‡§Æ‡•å‡§≤‡•ç‡§Ø‡§µ‡§æ‡§® ‡§ó‡•ã‡§∑‡•ç‡§ü‡•Ä‡§ö‡•á ‡§∏‡§Ç‡§∞‡§ï‡•ç‡§∑‡§£ ‡§ï‡§∞‡§§‡•ã. ‡§ö‡§≤‡§æ ‡§§‡•ç‡§Ø‡§æ‡§ö‡§æ ‡§∂‡•ã‡§ß ‡§ò‡•á‡§ä‡§Ø‡§æ.'
                }, 
                points: 25 
              },
              { 
                id: 'fear', 
                text: { 
                  en: 'Fear & Worry', 
                  hi: '‡§°‡§∞ ‡§î‡§∞ ‡§ö‡§ø‡§Ç‡§§‡§æ',
                  mr: '‡§≠‡•Ä‡§§‡•Ä ‡§Ü‡§£‡§ø ‡§ö‡§ø‡§Ç‡§§‡§æ'
                }, 
                emoji: 'üò®', 
                response: { 
                  en: 'Fear is trying to keep you safe. Let\'s understand its message.', 
                  hi: '‡§°‡§∞ ‡§Ü‡§™‡§ï‡•ã ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§∞‡§ñ‡§®‡•á ‡§ï‡•Ä ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞ ‡§∞‡§π‡§æ ‡§π‡•à‡•§ ‡§Ü‡§á‡§è ‡§á‡§∏‡§ï‡•á ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§ï‡•ã ‡§∏‡§Æ‡§ù‡•á‡§Ç‡•§',
                  mr: '‡§≠‡•Ä‡§§‡•Ä ‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§≤‡§æ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§†‡•á‡§µ‡§£‡•ç‡§Ø‡§æ‡§ö‡§æ ‡§™‡•ç‡§∞‡§Ø‡§§‡•ç‡§® ‡§ï‡§∞‡§§ ‡§Ü‡§π‡•á. ‡§ö‡§≤‡§æ ‡§§‡•ç‡§Ø‡§æ‡§ö‡§æ ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§∏‡§Æ‡§ú‡•Ç‡§® ‡§ò‡•á‡§ä‡§Ø‡§æ.'
                }, 
                points: 20 
              },
              { 
                id: 'mixed', 
                text: { 
                  en: 'Mixed Emotions', 
                  hi: '‡§Æ‡§ø‡§∂‡•ç‡§∞‡§ø‡§§ ‡§≠‡§æ‡§µ‡§®‡§æ‡§è‡§Ç',
                  mr: '‡§Æ‡§ø‡§∂‡•ç‡§∞‡§ø‡§§ ‡§≠‡§æ‡§µ‡§®‡§æ'
                }, 
                emoji: 'üåà', 
                response: { 
                  en: 'Complex emotions show your depth. Let\'s untangle them together.', 
                  hi: '‡§ú‡§ü‡§ø‡§≤ ‡§≠‡§æ‡§µ‡§®‡§æ‡§è‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§ó‡§π‡§∞‡§æ‡§à ‡§¶‡§ø‡§ñ‡§æ‡§§‡•Ä ‡§π‡•à‡§Ç‡•§ ‡§Ü‡§á‡§è ‡§â‡§®‡•ç‡§π‡•á‡§Ç ‡§Æ‡§ø‡§≤‡§ï‡§∞ ‡§∏‡•Å‡§≤‡§ù‡§æ‡§§‡•á ‡§π‡•à‡§Ç‡•§',
                  mr: '‡§ú‡§ü‡§ø‡§≤ ‡§≠‡§æ‡§µ‡§®‡§æ ‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§ñ‡•ã‡§≤‡•Ä ‡§¶‡§æ‡§ñ‡§µ‡§§‡§æ‡§§. ‡§ö‡§≤‡§æ ‡§§‡•ç‡§Ø‡§æ‡§Ç‡§®‡§æ ‡§è‡§ï‡§§‡•ç‡§∞ ‡§∏‡•Å‡§ü‡§µ‡•Ç‡§Ø‡§æ.'
                }, 
                points: 30 
              }
            ],
            feedback: {
              positive: {
                en: ['Your emotional awareness is impressive!'],
                hi: ['‡§Ü‡§™‡§ï‡•Ä ‡§≠‡§æ‡§µ‡§®‡§æ‡§§‡•ç‡§Æ‡§ï ‡§ú‡§æ‡§ó‡§∞‡•Ç‡§ï‡§§‡§æ ‡§™‡•ç‡§∞‡§≠‡§æ‡§µ‡§∂‡§æ‡§≤‡•Ä ‡§π‡•à!'],
                mr: ['‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§≠‡§æ‡§µ‡§®‡§ø‡§ï ‡§ú‡§æ‡§ó‡§∞‡•Ç‡§ï‡§§‡§æ ‡§™‡•ç‡§∞‡§≠‡§æ‡§µ‡•Ä ‡§Ü‡§π‡•á!']
              },
              encouraging: {
                en: ['Every emotion has wisdom to offer!'],
                hi: ['‡§π‡§∞ ‡§≠‡§æ‡§µ‡§®‡§æ ‡§Æ‡•á‡§Ç ‡§¨‡•Å‡§¶‡•ç‡§ß‡§ø‡§Æ‡§§‡•ç‡§§‡§æ ‡§π‡•ã‡§§‡•Ä ‡§π‡•à!'],
                mr: ['‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï ‡§≠‡§æ‡§µ‡§®‡•á‡§§ ‡§∂‡§π‡§æ‡§£‡§™‡§£ ‡§Ö‡§∏‡§§‡•á!']
              },
              guidance: {
                en: ['Let\'s dive deeper into what this emotion is telling you!'],
                hi: ['‡§Ü‡§á‡§è ‡§ó‡§π‡§∞‡§æ‡§à ‡§∏‡•á ‡§ú‡§æ‡§®‡•á‡§Ç ‡§ï‡§ø ‡§Ø‡§π ‡§≠‡§æ‡§µ‡§®‡§æ ‡§Ü‡§™‡§ï‡•ã ‡§ï‡•ç‡§Ø‡§æ ‡§¨‡§§‡§æ ‡§∞‡§π‡•Ä ‡§π‡•à!'],
                mr: ['‡§π‡•Ä ‡§≠‡§æ‡§µ‡§®‡§æ ‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§≤‡§æ ‡§ï‡§æ‡§Ø ‡§∏‡§æ‡§Ç‡§ó‡§§ ‡§Ü‡§π‡•á ‡§Ø‡§æ‡§ö‡§æ ‡§∏‡§ñ‡•ã‡§≤ ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•Ç‡§Ø‡§æ!']
              }
            },
            points: 10
          },
          {
            id: 'emotion-story',
            type: 'voice',
            title: {
              en: 'Tell Your Emotion\'s Story',
              hi: '‡§Ö‡§™‡§®‡•Ä ‡§≠‡§æ‡§µ‡§®‡§æ ‡§ï‡•Ä ‡§ï‡§π‡§æ‡§®‡•Ä ‡§¨‡§§‡§æ‡§è‡§Ç',
              mr: '‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§≠‡§æ‡§µ‡§®‡•á‡§ö‡•Ä ‡§ï‡§•‡§æ ‡§∏‡§æ‡§Ç‡§ó‡§æ'
            },
            instruction: {
              en: 'Describe what this emotion feels like in your body',
              hi: '‡§µ‡§∞‡•ç‡§£‡§® ‡§ï‡§∞‡•á‡§Ç ‡§ï‡§ø ‡§Ø‡§π ‡§≠‡§æ‡§µ‡§®‡§æ ‡§Ü‡§™‡§ï‡•á ‡§∂‡§∞‡•Ä‡§∞ ‡§Æ‡•á‡§Ç ‡§ï‡•à‡§∏‡•Ä ‡§≤‡§ó‡§§‡•Ä ‡§π‡•à',
              mr: '‡§π‡•Ä ‡§≠‡§æ‡§µ‡§®‡§æ ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§∂‡§∞‡•Ä‡§∞‡§æ‡§§ ‡§ï‡§∂‡•Ä ‡§µ‡§æ‡§ü‡§§‡•á ‡§Ø‡§æ‡§ö‡•á ‡§µ‡§∞‡•ç‡§£‡§® ‡§ï‡§∞‡§æ'
            },
            voiceGuide: {
              en: 'Now, I want you to describe this emotion. Where do you feel it in your body? What does it want you to know? Speak freely.',
              hi: '‡§Ö‡§¨, ‡§Æ‡•à‡§Ç ‡§ö‡§æ‡§π‡§§‡§æ ‡§π‡•Ç‡§Ç ‡§ï‡§ø ‡§Ü‡§™ ‡§á‡§∏ ‡§≠‡§æ‡§µ‡§®‡§æ ‡§ï‡§æ ‡§µ‡§∞‡•ç‡§£‡§® ‡§ï‡§∞‡•á‡§Ç‡•§ ‡§Ü‡§™ ‡§á‡§∏‡•á ‡§Ö‡§™‡§®‡•á ‡§∂‡§∞‡•Ä‡§∞ ‡§Æ‡•á‡§Ç ‡§ï‡§π‡§æ‡§Ç ‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç? ‡§Ø‡§π ‡§Ü‡§™‡§ï‡•ã ‡§ï‡•ç‡§Ø‡§æ ‡§ú‡§æ‡§®‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•Ä ‡§π‡•à? ‡§∏‡•ç‡§µ‡§§‡§Ç‡§§‡•ç‡§∞ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§¨‡•ã‡§≤‡•á‡§Ç‡•§',
              mr: '‡§Ü‡§§‡§æ, ‡§Æ‡•Ä ‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§≤‡§æ ‡§Ø‡§æ ‡§≠‡§æ‡§µ‡§®‡•á‡§ö‡•á ‡§µ‡§∞‡•ç‡§£‡§® ‡§ï‡§∞‡§æ‡§Ø‡§≤‡§æ ‡§∏‡§æ‡§Ç‡§ó‡§§‡•ã. ‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä ‡§§‡•Ä ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§∂‡§∞‡•Ä‡§∞‡§æ‡§§ ‡§ï‡•Å‡§†‡•á ‡§Ö‡§®‡•Å‡§≠‡§µ‡§§‡§æ? ‡§§‡•Ä ‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§≤‡§æ ‡§ï‡§æ‡§Ø ‡§ú‡§æ‡§£‡•Ç‡§® ‡§ò‡•ç‡§Ø‡§æ‡§Ø‡§ö‡•á ‡§Ü‡§π‡•á? ‡§Æ‡•Å‡§ï‡•ç‡§§‡§™‡§£‡•á ‡§¨‡•ã‡§≤‡§æ.'
            },
            feedback: {
              positive: {
                en: ['Your emotional vocabulary is growing!', 'That\'s such insightful self-awareness!', 'You\'re becoming an emotion expert!'],
                hi: ['‡§Ü‡§™‡§ï‡•Ä ‡§≠‡§æ‡§µ‡§®‡§æ‡§§‡•ç‡§Æ‡§ï ‡§∂‡§¨‡•ç‡§¶‡§æ‡§µ‡§≤‡•Ä ‡§¨‡§¢‡§º ‡§∞‡§π‡•Ä ‡§π‡•à!', '‡§Ø‡§π ‡§á‡§§‡§®‡•Ä ‡§Ö‡§Ç‡§§‡§∞‡•ç‡§¶‡•É‡§∑‡•ç‡§ü‡§ø‡§™‡•Ç‡§∞‡•ç‡§£ ‡§Ü‡§§‡•ç‡§Æ-‡§ú‡§æ‡§ó‡§∞‡•Ç‡§ï‡§§‡§æ ‡§π‡•à!', '‡§Ü‡§™ ‡§è‡§ï ‡§≠‡§æ‡§µ‡§®‡§æ ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û ‡§¨‡§® ‡§∞‡§π‡•á ‡§π‡•à‡§Ç!'],
                mr: ['‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§≠‡§æ‡§µ‡§®‡§ø‡§ï ‡§∂‡§¨‡•ç‡§¶‡§∏‡§Ç‡§ó‡•ç‡§∞‡§π ‡§µ‡§æ‡§¢‡§§ ‡§Ü‡§π‡•á!', '‡§π‡•Ä ‡§á‡§§‡§ï‡•Ä ‡§Ö‡§Ç‡§§‡§∞‡•ç‡§¶‡•É‡§∑‡•ç‡§ü‡•Ä‡§™‡•Ç‡§∞‡•ç‡§£ ‡§Ü‡§§‡•ç‡§Æ-‡§ú‡§æ‡§ó‡§∞‡•Ç‡§ï‡§§‡§æ ‡§Ü‡§π‡•á!', '‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä ‡§≠‡§æ‡§µ‡§®‡§æ ‡§§‡§ú‡•ç‡§û ‡§¨‡§®‡§§ ‡§Ü‡§π‡§æ‡§§!']
              },
              encouraging: {
                en: ['Keep exploring, you\'re doing great!', 'Every word helps you understand yourself better!', 'Your emotions are lucky to have such a thoughtful observer!'],
                hi: ['‡§ñ‡•ã‡§ú‡§§‡•á ‡§∞‡§π‡•á‡§Ç, ‡§Ü‡§™ ‡§¨‡§π‡•Å‡§§ ‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç!', '‡§π‡§∞ ‡§∂‡§¨‡•ç‡§¶ ‡§Ü‡§™‡§ï‡•ã ‡§Ö‡§™‡§®‡•á ‡§Ü‡§™ ‡§ï‡•ã ‡§¨‡•á‡§π‡§§‡§∞ ‡§∏‡§Æ‡§ù‡§®‡•á ‡§Æ‡•á‡§Ç ‡§Æ‡§¶‡§¶ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à!', '‡§Ü‡§™‡§ï‡•Ä ‡§≠‡§æ‡§µ‡§®‡§æ‡§è‡§Ç ‡§≠‡§æ‡§ó‡•ç‡§Ø‡§∂‡§æ‡§≤‡•Ä ‡§π‡•à‡§Ç ‡§ï‡§ø ‡§â‡§®‡§ï‡•á ‡§™‡§æ‡§∏ ‡§á‡§§‡§®‡§æ ‡§µ‡§ø‡§ö‡§æ‡§∞‡§∂‡•Ä‡§≤ ‡§™‡§∞‡•ç‡§Ø‡§µ‡•á‡§ï‡•ç‡§∑‡§ï ‡§π‡•à!'],
                mr: ['‡§∂‡•ã‡§ß‡§§ ‡§∞‡§æ‡§π‡§æ, ‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä ‡§ñ‡•Ç‡§™ ‡§ö‡§æ‡§Ç‡§ó‡§≤‡•á ‡§ï‡§∞‡§§ ‡§Ü‡§π‡§æ‡§§!', '‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï ‡§∂‡§¨‡•ç‡§¶ ‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§≤‡§æ ‡§∏‡•ç‡§µ‡§§‡§É‡§≤‡§æ ‡§ö‡§æ‡§Ç‡§ó‡§≤‡•á ‡§∏‡§Æ‡§ú‡•Ç‡§® ‡§ò‡•á‡§£‡•ç‡§Ø‡§æ‡§∏ ‡§Æ‡§¶‡§§ ‡§ï‡§∞‡§§‡•ã!', '‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§≠‡§æ‡§µ‡§®‡§æ ‡§≠‡§æ‡§ó‡•ç‡§Ø‡§µ‡§æ‡§® ‡§Ü‡§π‡•á‡§§ ‡§ï‡•Ä ‡§§‡•ç‡§Ø‡§æ‡§Ç‡§ö‡•ç‡§Ø‡§æ‡§ï‡§°‡•á ‡§á‡§§‡§ï‡§æ ‡§µ‡§ø‡§ö‡§æ‡§∞‡§∂‡•Ä‡§≤ ‡§®‡§ø‡§∞‡•Ä‡§ï‡•ç‡§∑‡§ï ‡§Ü‡§π‡•á!']
              },
              guidance: {
                en: ['Try to feel the emotion in your body as you speak', 'What would this emotion say if it could talk?', 'Notice any images or memories that come up'],
                hi: ['‡§¨‡•ã‡§≤‡§§‡•á ‡§∏‡§Æ‡§Ø ‡§≠‡§æ‡§µ‡§®‡§æ ‡§ï‡•ã ‡§Ö‡§™‡§®‡•á ‡§∂‡§∞‡•Ä‡§∞ ‡§Æ‡•á‡§Ç ‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞‡•á‡§Ç', '‡§Ø‡§¶‡§ø ‡§Ø‡§π ‡§≠‡§æ‡§µ‡§®‡§æ ‡§¨‡•ã‡§≤ ‡§∏‡§ï‡§§‡•Ä ‡§§‡•ã ‡§ï‡•ç‡§Ø‡§æ ‡§ï‡§π‡§§‡•Ä?', '‡§ï‡•ã‡§à ‡§≠‡•Ä ‡§õ‡§µ‡§ø ‡§Ø‡§æ ‡§Ø‡§æ‡§¶‡•á‡§Ç ‡§ú‡•ã ‡§Ü‡§§‡•Ä ‡§π‡•à‡§Ç ‡§â‡§® ‡§™‡§∞ ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§¶‡•á‡§Ç'],
                mr: ['‡§¨‡•ã‡§≤‡§§‡§æ‡§®‡§æ ‡§≠‡§æ‡§µ‡§®‡§æ ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§∂‡§∞‡•Ä‡§∞‡§æ‡§§ ‡§Ö‡§®‡•Å‡§≠‡§µ‡§£‡•ç‡§Ø‡§æ‡§ö‡§æ ‡§™‡•ç‡§∞‡§Ø‡§§‡•ç‡§® ‡§ï‡§∞‡§æ', '‡§ú‡§∞ ‡§π‡•Ä ‡§≠‡§æ‡§µ‡§®‡§æ ‡§¨‡•ã‡§≤‡•Ç ‡§∂‡§ï‡§≤‡•Ä ‡§§‡§∞ ‡§ï‡§æ‡§Ø ‡§Æ‡•ç‡§π‡§£‡§æ‡§≤‡•Ä ‡§Ö‡§∏‡§§‡•Ä?', '‡§Ø‡•á‡§£‡§æ‡§±‡•ç‡§Ø‡§æ ‡§ï‡•ã‡§£‡§§‡•ç‡§Ø‡§æ‡§π‡•Ä ‡§™‡•ç‡§∞‡§§‡§ø‡§Æ‡§æ ‡§ï‡§ø‡§Ç‡§µ‡§æ ‡§Ü‡§†‡§µ‡§£‡•Ä‡§Ç‡§ï‡§°‡•á ‡§≤‡§ï‡•ç‡§∑ ‡§¶‡•ç‡§Ø‡§æ']
              }
            },
            points: 30
          }
        ]
      }
    ]
  },
  {
    id: 'stress-buster',
    title: 'Stress Buster',
    subtitle: 'Demolish stress with your voice',
    description: 'High-energy interactive session to blast away stress and tension',
    benefits: ['Instant stress relief', 'Energy boost', 'Mental clarity'],
    difficulty: 'beginner',
    type: 'interactive',
    icon: 'üí•',
    color: 'from-red-400 to-pink-500',
    preview: 'Unleash your voice to shatter stress!',
    isUserControlled: true,
    scenarios: [
      {
        id: 'stress-destroyer',
        title: 'Become a Stress Destroyer',
        description: 'Use your voice as a powerful stress-busting tool',
        steps: [
          {
            id: 'stress-meter',
            type: 'choice',
            title: {
              en: 'How stressed are you feeling?',
              hi: '‡§Ü‡§™ ‡§ï‡§ø‡§§‡§®‡§æ ‡§§‡§®‡§æ‡§µ ‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç?',
              mr: '‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§≤‡§æ ‡§ï‡§ø‡§§‡•Ä ‡§§‡§£‡§æ‡§µ ‡§µ‡§æ‡§ü‡§§ ‡§Ü‡§π‡•á?'
            },
            instruction: {
              en: 'Rate your current stress level',
              hi: '‡§Ö‡§™‡§®‡•á ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§§‡§®‡§æ‡§µ ‡§∏‡•ç‡§§‡§∞ ‡§ï‡•ã ‡§∞‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç',
              mr: '‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§∏‡§¶‡•ç‡§Ø ‡§§‡§£‡§æ‡§µ‡§æ‡§ö‡•Ä ‡§™‡§æ‡§§‡§≥‡•Ä ‡§∞‡•á‡§ü ‡§ï‡§∞‡§æ'
            },
            voiceGuide: {
              en: 'Let\'s check your stress meter! How wound up are you feeling right now?',
              hi: '‡§Ü‡§á‡§è ‡§Ö‡§™‡§®‡§æ ‡§§‡§®‡§æ‡§µ ‡§Æ‡•Ä‡§ü‡§∞ ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç! ‡§Ü‡§™ ‡§Ö‡§≠‡•Ä ‡§ï‡§ø‡§§‡§®‡§æ ‡§™‡§∞‡•á‡§∂‡§æ‡§® ‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç?',
              mr: '‡§ö‡§≤‡§æ ‡§§‡•Å‡§Æ‡§ö‡•á ‡§§‡§£‡§æ‡§µ ‡§Æ‡•Ä‡§ü‡§∞ ‡§§‡§™‡§æ‡§∏‡•Ç‡§Ø‡§æ! ‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§≤‡§æ ‡§Ü‡§§‡§æ ‡§ï‡§ø‡§§‡•Ä ‡§Ö‡§∏‡•ç‡§µ‡§∏‡•ç‡§• ‡§µ‡§æ‡§ü‡§§ ‡§Ü‡§π‡•á?'
            },
            choices: [
              { 
                id: 'chill', 
                text: { 
                  en: 'Pretty Relaxed', 
                  hi: '‡§ï‡§æ‡§´‡•Ä ‡§Ü‡§∞‡§æ‡§Æ ‡§∏‡•á',
                  mr: '‡§¨‡§±‡•ç‡§Ø‡§æ‡§™‡•à‡§ï‡•Ä ‡§Ü‡§∞‡§æ‡§Æ‡§∂‡•Ä‡§∞'
                }, 
                emoji: 'üòé', 
                response: { 
                  en: 'Nice! Let\'s keep you in that zen zone!', 
                  hi: '‡§¨‡§¢‡§º‡§ø‡§Ø‡§æ! ‡§Ü‡§á‡§è ‡§Ü‡§™‡§ï‡•ã ‡§â‡§∏ ‡§∂‡§æ‡§Ç‡§§ ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ ‡§Æ‡•á‡§Ç ‡§∞‡§ñ‡•á‡§Ç!',
                  mr: '‡§õ‡§æ‡§®! ‡§ö‡§≤‡§æ ‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§≤‡§æ ‡§§‡•ç‡§Ø‡§æ ‡§∂‡§æ‡§Ç‡§§ ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞‡§æ‡§§ ‡§†‡•á‡§µ‡•Ç‡§Ø‡§æ!'
                }, 
                points: 10 
              },
              { 
                id: 'medium', 
                text: { 
                  en: 'Moderately Stressed', 
                  hi: '‡§Æ‡§ß‡•ç‡§Ø‡§Æ ‡§§‡§®‡§æ‡§µ',
                  mr: '‡§Æ‡§ß‡•ç‡§Ø‡§Æ ‡§§‡§£‡§æ‡§µ'
                }, 
                emoji: 'üò§', 
                response: { 
                  en: 'Time to release that tension! Let\'s do this!', 
                  hi: '‡§â‡§∏ ‡§§‡§®‡§æ‡§µ ‡§ï‡•ã ‡§õ‡•ã‡§°‡§º‡§®‡•á ‡§ï‡§æ ‡§∏‡§Æ‡§Ø! ‡§Ü‡§á‡§è ‡§Ø‡§π ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç!',
                  mr: '‡§§‡•ã ‡§§‡§£‡§æ‡§µ ‡§∏‡•ã‡§°‡§£‡•ç‡§Ø‡§æ‡§ö‡•Ä ‡§µ‡•á‡§≥! ‡§ö‡§≤‡§æ ‡§π‡•á ‡§ï‡§∞‡•Ç‡§Ø‡§æ!'
                }, 
                points: 15 
              },
              { 
                id: 'high', 
                text: { 
                  en: 'Very Stressed', 
                  hi: '‡§¨‡§π‡•Å‡§§ ‡§§‡§®‡§æ‡§µ‡§ó‡•ç‡§∞‡§∏‡•ç‡§§',
                  mr: '‡§ñ‡•Ç‡§™ ‡§§‡§£‡§æ‡§µ‡§ó‡•ç‡§∞‡§∏‡•ç‡§§'
                }, 
                emoji: 'ü§Ø', 
                response: { 
                  en: 'Perfect! We\'re about to blast that stress away!', 
                  hi: '‡§¨‡§ø‡§≤‡•ç‡§ï‡•Å‡§≤ ‡§∏‡§π‡•Ä! ‡§π‡§Æ ‡§â‡§∏ ‡§§‡§®‡§æ‡§µ ‡§ï‡•ã ‡§â‡§°‡§º‡§æ‡§®‡•á ‡§µ‡§æ‡§≤‡•á ‡§π‡•à‡§Ç!',
                  mr: '‡§™‡§∞‡§´‡•á‡§ï‡•ç‡§ü! ‡§Ü‡§Æ‡•ç‡§π‡•Ä ‡§§‡•ã ‡§§‡§£‡§æ‡§µ ‡§â‡§°‡§µ‡•Ç‡§® ‡§¶‡•á‡§£‡§æ‡§∞ ‡§Ü‡§π‡•ã‡§§!'
                }, 
                points: 20 
              },
              { 
                id: 'overwhelmed', 
                text: { 
                  en: 'Completely Overwhelmed', 
                  hi: '‡§™‡•Ç‡§∞‡•Ä ‡§§‡§∞‡§π ‡§∏‡•á ‡§Ö‡§≠‡§ø‡§≠‡•Ç‡§§',
                  mr: '‡§™‡•Ç‡§∞‡•ç‡§£‡§™‡§£‡•á ‡§≠‡§æ‡§∞‡§æ‡§µ‡•Ç‡§® ‡§ó‡•á‡§≤‡•á‡§≤‡§æ'
                }, 
                emoji: 'üòµ', 
                response: { 
                  en: 'You came to the right place! Let\'s demolish that stress!', 
                  hi: '‡§Ü‡§™ ‡§∏‡§π‡•Ä ‡§ú‡§ó‡§π ‡§Ü‡§è ‡§π‡•à‡§Ç! ‡§Ü‡§á‡§è ‡§â‡§∏ ‡§§‡§®‡§æ‡§µ ‡§ï‡•ã ‡§ß‡•ç‡§µ‡§∏‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç!',
                  mr: '‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä ‡§Ø‡•ã‡§ó‡•ç‡§Ø ‡§†‡§ø‡§ï‡§æ‡§£‡•Ä ‡§Ü‡§≤‡§æ ‡§Ü‡§π‡§æ‡§§! ‡§ö‡§≤‡§æ ‡§§‡•ã ‡§§‡§£‡§æ‡§µ ‡§®‡§∑‡•ç‡§ü ‡§ï‡§∞‡•Ç‡§Ø‡§æ!'
                }, 
                points: 25 
              }
            ],
            feedback: {
              positive: {
                en: ['Great awareness of your stress levels!'],
                hi: ['‡§Ü‡§™‡§ï‡•á ‡§§‡§®‡§æ‡§µ ‡§∏‡•ç‡§§‡§∞ ‡§ï‡•Ä ‡§¨‡•á‡§π‡§§‡§∞‡•Ä‡§® ‡§ú‡§æ‡§ó‡§∞‡•Ç‡§ï‡§§‡§æ!'],
                mr: ['‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§§‡§£‡§æ‡§µ‡§æ‡§ö‡•ç‡§Ø‡§æ ‡§™‡§æ‡§§‡§≥‡•Ä‡§ö‡•Ä ‡§â‡§§‡•ç‡§ï‡•É‡§∑‡•ç‡§ü ‡§ú‡§æ‡§ó‡§∞‡•Ç‡§ï‡§§‡§æ!']
              },
              encouraging: {
                en: ['We\'re about to turn that stress into strength!'],
                hi: ['‡§π‡§Æ ‡§â‡§∏ ‡§§‡§®‡§æ‡§µ ‡§ï‡•ã ‡§§‡§æ‡§ï‡§§ ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤‡§®‡•á ‡§µ‡§æ‡§≤‡•á ‡§π‡•à‡§Ç!'],
                mr: ['‡§Ü‡§Æ‡•ç‡§π‡•Ä ‡§§‡•ã ‡§§‡§£‡§æ‡§µ ‡§∂‡§ï‡•ç‡§§‡•Ä‡§§ ‡§¨‡§¶‡§≤‡§£‡§æ‡§∞ ‡§Ü‡§π‡•ã‡§§!']
              },
              guidance: {
                en: ['Get ready to feel amazing!'],
                hi: ['‡§Ö‡§¶‡•ç‡§≠‡•Å‡§§ ‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§π‡•ã ‡§ú‡§æ‡§á‡§è!'],
                mr: ['‡§Ö‡§™‡•ç‡§∞‡§§‡§ø‡§Æ ‡§µ‡§æ‡§ü‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§§‡§Ø‡§æ‡§∞ ‡§µ‡•ç‡§π‡§æ!']
              }
            },
            points: 5
          },
          {
            id: 'stress-shout',
            type: 'voice',
            title: {
              en: 'Stress Release Shout',
              hi: '‡§§‡§®‡§æ‡§µ ‡§Æ‡•Å‡§ï‡•ç‡§§‡§ø ‡§ö‡§ø‡§≤‡•ç‡§≤‡§æ‡§π‡§ü',
              mr: '‡§§‡§£‡§æ‡§µ ‡§Æ‡•Å‡§ï‡•ç‡§§‡•Ä ‡§ì‡§∞‡§°'
            },
            instruction: {
              en: 'Shout "STRESS BE GONE!" as loud as you can',
              hi: '‡§ú‡§ø‡§§‡§®‡•Ä ‡§ú‡•ã‡§∞ ‡§∏‡•á ‡§π‡•ã ‡§∏‡§ï‡•á "‡§§‡§®‡§æ‡§µ ‡§ö‡§≤‡§æ ‡§ú‡§æ!" ‡§ö‡§ø‡§≤‡•ç‡§≤‡§æ‡§è‡§Ç',
              mr: '‡§ú‡§ø‡§§‡§ï‡•ç‡§Ø‡§æ ‡§ú‡•ã‡§∞‡§æ‡§§ ‡§π‡•ã‡§à‡§≤ ‡§§‡§ø‡§§‡§ï‡•ç‡§Ø‡§æ ‡§ú‡•ã‡§∞‡§æ‡§§ "‡§§‡§£‡§æ‡§µ ‡§®‡§ø‡§ò‡•Ç‡§® ‡§ú‡§æ!" ‡§ì‡§∞‡§°‡§æ'
            },
            voiceGuide: {
              en: 'Now, we\'re going to blast that stress away! I want you to shout "STRESS BE GONE!" as loud as you can. Ready? Let it RIP!',
              hi: '‡§Ö‡§¨, ‡§π‡§Æ ‡§â‡§∏ ‡§§‡§®‡§æ‡§µ ‡§ï‡•ã ‡§â‡§°‡§º‡§æ‡§®‡•á ‡§ú‡§æ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç! ‡§Æ‡•à‡§Ç ‡§ö‡§æ‡§π‡§§‡§æ ‡§π‡•Ç‡§Ç ‡§ï‡§ø ‡§Ü‡§™ ‡§ú‡§ø‡§§‡§®‡•Ä ‡§ú‡•ã‡§∞ ‡§∏‡•á ‡§π‡•ã ‡§∏‡§ï‡•á "‡§§‡§®‡§æ‡§µ ‡§ö‡§≤‡§æ ‡§ú‡§æ!" ‡§ö‡§ø‡§≤‡•ç‡§≤‡§æ‡§è‡§Ç‡•§ ‡§§‡•à‡§Ø‡§æ‡§∞? ‡§á‡§∏‡•á ‡§´‡§æ‡§°‡§º ‡§¶‡•ã!',
              mr: '‡§Ü‡§§‡§æ, ‡§Ü‡§Æ‡•ç‡§π‡•Ä ‡§§‡•ã ‡§§‡§£‡§æ‡§µ ‡§â‡§°‡§µ‡•Ç‡§® ‡§¶‡•á‡§£‡§æ‡§∞ ‡§Ü‡§π‡•ã‡§§! ‡§Æ‡•Ä ‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§≤‡§æ ‡§ú‡§ø‡§§‡§ï‡•ç‡§Ø‡§æ ‡§ú‡•ã‡§∞‡§æ‡§§ ‡§π‡•ã‡§à‡§≤ ‡§§‡§ø‡§§‡§ï‡•ç‡§Ø‡§æ ‡§ú‡•ã‡§∞‡§æ‡§§ "‡§§‡§£‡§æ‡§µ ‡§®‡§ø‡§ò‡•Ç‡§® ‡§ú‡§æ!" ‡§ì‡§∞‡§°‡§æ‡§Ø‡§≤‡§æ ‡§∏‡§æ‡§Ç‡§ó‡§§‡•ã. ‡§§‡§Ø‡§æ‡§∞? ‡§´‡§æ‡§°‡•Ç‡§® ‡§ü‡§æ‡§ï‡§æ!'
            },
            expectedResponse: {
              en: 'STRESS BE GONE',
              hi: '‡§§‡§®‡§æ‡§µ ‡§ö‡§≤‡§æ ‡§ú‡§æ',
              mr: '‡§§‡§£‡§æ‡§µ ‡§®‡§ø‡§ò‡•Ç‡§® ‡§ú‡§æ'
            },
            feedback: {
              positive: {
                en: ['YESSS! That was POWERFUL!', 'WOW! I felt that energy from here!', 'INCREDIBLE! Your stress just ran away scared!'],
                hi: ['‡§π‡§æ‡§Å! ‡§Ø‡§π ‡§∂‡§ï‡•ç‡§§‡§ø‡§∂‡§æ‡§≤‡•Ä ‡§•‡§æ!', '‡§µ‡§æ‡§π! ‡§Æ‡•à‡§Ç‡§®‡•á ‡§Ø‡§π‡§æ‡§Å ‡§∏‡•á ‡§â‡§∏ ‡§ä‡§∞‡•ç‡§ú‡§æ ‡§ï‡•ã ‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§ï‡§ø‡§Ø‡§æ!', '‡§Ö‡§µ‡§ø‡§∂‡•ç‡§µ‡§∏‡§®‡•Ä‡§Ø! ‡§Ü‡§™‡§ï‡§æ ‡§§‡§®‡§æ‡§µ ‡§°‡§∞‡§ï‡§∞ ‡§≠‡§æ‡§ó ‡§ó‡§Ø‡§æ!'],
                mr: ['‡§π‡•ã‡§Ø! ‡§§‡•á ‡§∂‡§ï‡•ç‡§§‡§ø‡§∂‡§æ‡§≤‡•Ä ‡§π‡•ã‡§§‡•á!', '‡§µ‡§æ‡§π! ‡§Æ‡•Ä ‡§á‡§•‡•Ç‡§® ‡§§‡•Ä ‡§ä‡§∞‡•ç‡§ú‡§æ ‡§Ö‡§®‡•Å‡§≠‡§µ‡§≤‡•Ä!', '‡§Ö‡§µ‡§ø‡§∂‡•ç‡§µ‡§∏‡§®‡•Ä‡§Ø! ‡§§‡•Å‡§Æ‡§ö‡§æ ‡§§‡§£‡§æ‡§µ ‡§ò‡§æ‡§¨‡§∞‡•Ç‡§® ‡§™‡§≥‡•Ç‡§® ‡§ó‡•á‡§≤‡§æ!']
              },
              encouraging: {
                en: ['Good! Now let\'s make it even LOUDER!', 'I can feel your power building!', 'That\'s it! Let it all out!'],
                hi: ['‡§Ö‡§ö‡•ç‡§õ‡§æ! ‡§Ö‡§¨ ‡§Ü‡§á‡§è ‡§á‡§∏‡•á ‡§î‡§∞ ‡§≠‡•Ä ‡§ú‡•ã‡§∞ ‡§∏‡•á ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç!', '‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§∂‡§ï‡•ç‡§§‡§ø ‡§¨‡§¢‡§º‡§§‡•á ‡§π‡•Å‡§è ‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Ç!', '‡§¨‡§∏ ‡§Ø‡§π‡•Ä! ‡§∏‡§¨ ‡§ï‡•Å‡§õ ‡§¨‡§æ‡§π‡§∞ ‡§®‡§ø‡§ï‡§æ‡§≤‡•á‡§Ç!'],
                mr: ['‡§ö‡§æ‡§Ç‡§ó‡§≤‡•á! ‡§Ü‡§§‡§æ ‡§§‡•á ‡§Ü‡§£‡§ñ‡•Ä ‡§ú‡•ã‡§∞‡§æ‡§§ ‡§ï‡§∞‡•Ç‡§Ø‡§æ!', '‡§Æ‡•Ä ‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§∂‡§ï‡•ç‡§§‡•Ä ‡§µ‡§æ‡§¢‡§§‡§æ‡§®‡§æ ‡§Ö‡§®‡•Å‡§≠‡§µ‡•Ç ‡§∂‡§ï‡§§‡•ã!', '‡§§‡•á‡§ö! ‡§∏‡§ó‡§≥‡•á ‡§¨‡§æ‡§π‡•á‡§∞ ‡§ï‡§æ‡§¢‡§æ!']
              },
              guidance: {
                en: ['Shout from your belly, not your throat!', 'Imagine blasting the stress out of your body!', 'Feel the release with every word!'],
                hi: ['‡§Ö‡§™‡§®‡•á ‡§ó‡§≤‡•á ‡§∏‡•á ‡§®‡§π‡•Ä‡§Ç, ‡§™‡•á‡§ü ‡§∏‡•á ‡§ö‡§ø‡§≤‡•ç‡§≤‡§æ‡§è‡§Ç!', '‡§ï‡§≤‡•ç‡§™‡§®‡§æ ‡§ï‡§∞‡•á‡§Ç ‡§ï‡§ø ‡§§‡§®‡§æ‡§µ ‡§ï‡•ã ‡§Ö‡§™‡§®‡•á ‡§∂‡§∞‡•Ä‡§∞ ‡§∏‡•á ‡§¨‡§æ‡§π‡§∞ ‡§®‡§ø‡§ï‡§æ‡§≤ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç!', '‡§π‡§∞ ‡§∂‡§¨‡•ç‡§¶ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§Æ‡•Å‡§ï‡•ç‡§§‡§ø ‡§ï‡•ã ‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§ï‡§∞‡•á‡§Ç!'],
                mr: ['‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§ó‡§≥‡•ç‡§Ø‡§æ‡§§‡•Ç‡§® ‡§®‡§æ‡§π‡•Ä, ‡§™‡•ã‡§ü‡§æ‡§§‡•Ç‡§® ‡§ì‡§∞‡§°‡§æ!', '‡§§‡§£‡§æ‡§µ ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§∂‡§∞‡•Ä‡§∞‡§æ‡§§‡•Ç‡§® ‡§¨‡§æ‡§π‡•á‡§∞ ‡§ï‡§æ‡§¢‡§§ ‡§Ü‡§π‡§æ‡§§ ‡§Ø‡§æ‡§ö‡•Ä ‡§ï‡§≤‡•ç‡§™‡§®‡§æ ‡§ï‡§∞‡§æ!', '‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï ‡§∂‡§¨‡•ç‡§¶‡§æ‡§®‡•á ‡§Æ‡•Å‡§ï‡•ç‡§§‡•Ä ‡§Ö‡§®‡•Å‡§≠‡§µ‡§æ!']
              }
            },
            points: 40
          }
        ]
      }
    ]
  }
];

// Chat functionality removed - use /companion route for AI chat

export default function VoiceTherapy() {
  const { userProfile, currentUser } = useAuth(); // Get user profile for language preferences

  // Language Helper Function
  const getLangKey = (voice: VoiceOption): string => {
    const lang = voice.language.split('-')[0] || 'en'; // 'hi-IN' -> 'hi', 'en-GB' -> 'en'
    return lang; // Returns 'en', 'hi', 'mr', 'bn', etc.
  };

  const [currentSession, setCurrentSession] = useState<VoiceSession | null>(null);
  const [selectedScenario, setSelectedScenario] = useState<TherapyScenario | null>(null);
  const [isActive, setIsActive] = useState(false);
  const [isListening, setIsListening] = useState(false);
  const [isPlaying, setIsPlaying] = useState(false);
  const [sessionTime, setSessionTime] = useState(0);
  const [stepProgress, setStepProgress] = useState(0);
  const [voiceAnalysisResults, setVoiceAnalysisResults] = useState<VoiceAnalysisResult[]>([]);
  const [showCompletion, setShowCompletion] = useState(false);
  const [userFeedback, setUserFeedback] = useState<string>('');
  const [currentFeedback, setCurrentFeedback] = useState<string>('');
  const [showChoices, setShowChoices] = useState(false);
  const [waitingForVoice, setWaitingForVoice] = useState(false);
  const [celebrationMode, setCelebrationMode] = useState(false);
  // Initialize selectedVoice from user preferences or default
  const [selectedVoice, setSelectedVoice] = useState<VoiceOption>(() => {
    const savedVoiceURI = userProfile?.preferences?.selectedVoice;
    if (savedVoiceURI) {
      const savedVoice = AVAILABLE_VOICES.find(v => v.voiceURI === savedVoiceURI || v.name === savedVoiceURI);
      if (savedVoice) return savedVoice;
    }
    return AVAILABLE_VOICES[0]!;
  });
  const [showVoiceSelector, setShowVoiceSelector] = useState(false);
  const [showSettings, setShowSettings] = useState(false);
  const [isPaused, setIsPaused] = useState(false);
  const [autoPlayVoice, setAutoPlayVoice] = useState(true);
  const [inputValue, setInputValue] = useState<string>('');

  const stepTimerRef = useRef<NodeJS.Timeout | null>(null);
  const progressTimerRef = useRef<NodeJS.Timeout | null>(null);
  const sessionTimerRef = useRef<NodeJS.Timeout | null>(null);
  const mediaRecorderRef = useRef<MediaRecorder | null>(null);
  const audioChunksRef = useRef<Blob[]>([]);
  const audioContextRef = useRef<AudioContext | null>(null);
  const audioSourceRef = useRef<AudioBufferSourceNode | null>(null);

  // Voice therapy session initialization

  // Save voice preference to user profile
  const saveVoicePreference = async (voice: VoiceOption) => {
    if (!currentUser) return;

    try {
      await firebaseService.updateUserProfile(currentUser.uid, {
        preferences: {
          language: userProfile?.preferences?.language || 'mixed',
          culturalBackground: userProfile?.preferences?.culturalBackground || '',
          communicationStyle: userProfile?.preferences?.communicationStyle || 'casual',
          interests: userProfile?.preferences?.interests || [],
          comfortEnvironment: userProfile?.preferences?.comfortEnvironment || '',
          avatarStyle: userProfile?.preferences?.avatarStyle || '',
          notificationsEnabled: userProfile?.preferences?.notificationsEnabled || true,
          ...userProfile?.preferences,
          selectedVoice: voice.voiceURI || voice.name
        }
      });
      console.log('Voice preference saved:', voice.name);
    } catch (error) {
      console.error('Failed to save voice preference:', error);
      toast.error('Failed to save voice preference');
    }
  };

  // Utility functions
  const formatTime = (seconds: number) => {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins}:${secs.toString().padStart(2, '0')}`;
  };

  const getDifficultyColor = (difficulty: string) => {
    switch (difficulty) {
      case 'beginner': return 'text-green-600 bg-green-100';
      case 'intermediate': return 'text-yellow-600 bg-yellow-100';
      case 'advanced': return 'text-red-600 bg-red-100';
      default: return 'text-gray-600 bg-gray-100';
    }
  };

  const getNextRecommendedExercise = () => {
    if (!currentSession) return 'Confidence Builder';

    const currentId = currentSession.exercise.id;
    const recommendations = {
      'confidence-builder': 'Anxiety Warrior',
      'anxiety-warrior': 'Emotion Explorer',
      'emotion-explorer': 'Stress Buster',
      'stress-buster': 'Confidence Builder'
    };

    return recommendations[currentId as keyof typeof recommendations] || 'Confidence Builder';
  };

  const getPersonalizedStrength = () => {
    if (!currentSession) return 'Great participation';

    if (currentSession.points >= 150) {
      return 'Exceptional voice confidence and engagement';
    } else if (currentSession.points >= 100) {
      return 'Strong voice presence and good participation';
    } else if (currentSession.voiceAnalysis.length >= 2) {
      return 'Willingness to use your voice courageously';
    } else {
      return 'Commitment to personal growth and self-improvement';
    }
  };

  // Session timer
  useEffect(() => {
    if (isActive && currentSession) {
      sessionTimerRef.current = setInterval(() => {
        setSessionTime(prev => prev + 1);
      }, 1000);
    } else {
      if (sessionTimerRef.current) {
        clearInterval(sessionTimerRef.current);
        sessionTimerRef.current = null;
      }
    }

    return () => {
      if (sessionTimerRef.current) {
        clearInterval(sessionTimerRef.current);
      }
    };
  }, [isActive, currentSession]);

  // Cleanup on unmount
  useEffect(() => {
    return () => {
      if (stepTimerRef.current) clearInterval(stepTimerRef.current);
      if (progressTimerRef.current) clearInterval(progressTimerRef.current);
      if (sessionTimerRef.current) clearInterval(sessionTimerRef.current);
      // Cleanup MediaRecorder if active
      if (mediaRecorderRef.current && mediaRecorderRef.current.state === "recording") {
        mediaRecorderRef.current.stop();
      }
      // Stop any playing audio
      if (audioSourceRef.current) {
        audioSourceRef.current.stop();
      }
    };
  }, []);

  const startSession = async (exercise: TherapyExercise, scenario: TherapyScenario) => {
    const session: VoiceSession = {
      id: Date.now().toString(),
      startTime: new Date(),
      exercise,
      scenario,
      currentStep: 0,
      progress: 0,
      voiceAnalysis: [],
      userChoices: [],
      points: 0,
      achievements: [],
      completed: false,
      mood: 'excited',
      selectedVoice,
      isUserControlled: exercise.isUserControlled
    };


    setCurrentSession(session);
    setSelectedScenario(scenario);
    setIsActive(true);
    setSessionTime(0);
    setStepProgress(0);
    setShowCompletion(false);
    setUserFeedback('');
    setCurrentFeedback('');
    setShowChoices(false);
    setWaitingForVoice(false);
    setCelebrationMode(false);

    // --- NEW: Log session start activity ---
    if (currentUser) {
      try {
        await firebaseService.logUserActivity(
          currentUser.uid,
          'started_voice_session',
          { 
            exercise: exercise.title,
            exerciseType: exercise.type,
            scenario: scenario.title,
            difficulty: exercise.difficulty
          }
        );
      } catch (error) {
        console.warn('Failed to log session start activity:', error);
      }
    }
    // --- END NEW ---

    // Start with an exciting intro
    setTimeout(() => {
      executeStep(session, 0);
    }, 1000);
  };

  const executeStep = async (session: VoiceSession, stepIndex: number) => {
    if (stepIndex >= session.scenario.steps.length) {
      completeSession();
      return;
    }

    const step = session.scenario.steps[stepIndex];
    if (!step) return;

    console.log(`Executing step ${stepIndex + 1}: ${step.title} (${step.type})`);

    setStepProgress(0);
    setCurrentFeedback('');
    setShowChoices(false);
    setWaitingForVoice(false);
    setCelebrationMode(false);

    // Always speak the voice guide first if auto-play is enabled
    if (autoPlayVoice && !isPaused) {
      try {
        const langKey = getLangKey(selectedVoice); // e.g., 'hi'
        const guideText = step.voiceGuide[langKey] || step.voiceGuide['en']; // Get Hindi text, or fall back to English
        await speakText(guideText, selectedVoice); // Speak the correct language
      } catch (error) {
        console.warn('Voice guide failed:', error);
      }
    }

    // Handle different step types - USER CONTROLLED
    if (step.type === 'choice') {
      setShowChoices(true);
      // Show a helpful message
      setCurrentFeedback("Choose one of the options below to continue:");
    } else if (step.type === 'voice') {
      setWaitingForVoice(true);
      setCurrentFeedback("Click 'Start Speaking' when you're ready to use your voice:");
    } else if (step.type === 'breathing') {
      setCurrentFeedback("Take your time with this breathing exercise. Click 'Start' when ready:");
      // Don't auto-start breathing, let user control it
    } else {
      setCurrentFeedback("Read the instruction above and click 'Continue' when you're ready:");
    }
  };





  const handleVoiceResponse = async (result: VoiceAnalysisResult) => {
    if (!currentSession || !selectedScenario) return;

    const currentStep = selectedScenario.steps[currentSession.currentStep];
    if (!currentStep) return;

    console.log('Voice response received:', result.transcript);

    // Clear any existing timers
    if (progressTimerRef.current) {
      clearInterval(progressTimerRef.current);
      progressTimerRef.current = null;
    }

    setVoiceAnalysisResults(prev => [...prev, result]);

    // Stop listening
    stopListening();
    setWaitingForVoice(false);

    // Analyze the response and give feedback
    const feedback = analyzeVoiceResponse(result, currentStep);
    setCurrentFeedback(feedback.message);

    // Add points
    const updatedSession = {
      ...currentSession,
      points: currentSession.points + feedback.points
    };
    setCurrentSession(updatedSession);

    // Speak feedback
    try {
      await speakText(feedback.message, selectedVoice);
    } catch (error) {
      console.warn('Feedback voice failed:', error);
    }

    setCelebrationMode(true);

    // Continue after feedback
    setTimeout(() => {
      setCelebrationMode(false);
      setCurrentFeedback('');
      nextStep();
    }, 4000);
  };

  const analyzeVoiceResponse = (result: VoiceAnalysisResult, step: InteractiveStep) => {
    const transcript = result.transcript.toLowerCase();
    const confidence = result.confidence;
    const intensity = result.emotionalIndicators.intensity;
    const langKey = getLangKey(selectedVoice);

    console.log(`üîç VOICE ANALYSIS DEBUG:`);
    console.log(`üîç Language Key: ${langKey}`);
    console.log(`üîç Transcript: "${transcript}"`);
    console.log(`üîç Confidence: ${confidence}`);
    console.log(`üîç Intensity: ${intensity}`);

    let points = 10;
    let message = '';

    if (step.expectedResponse) {
      // Get the expected response in the current language
      const expectedText = step.expectedResponse[langKey] || step.expectedResponse['en'];
      const expected = expectedText.toLowerCase();
      console.log(`üîç Expected Text (${langKey}): "${expectedText}"`);
      console.log(`üîç Expected (lowercase): "${expected}"`);
      
      const similarity = transcript.includes(expected.split(' ')[0] || '') ? 0.8 : 0.3;
      console.log(`üîç Similarity Score: ${similarity}`);

      if (similarity > 0.7 && intensity > 0.6) {
        const messages = step.feedback.positive[langKey] || step.feedback.positive['en']; // Get Hindi array, or fallback to English
        message = messages[Math.floor(Math.random() * messages.length)] || 'Great job!'; // Select a random translated message
        points = 30;
      } else if (similarity > 0.5 || intensity > 0.4) {
        const messages = step.feedback.encouraging[langKey] || step.feedback.encouraging['en'];
        message = messages[Math.floor(Math.random() * messages.length)] || 'Keep going!';
        points = 20;
      } else {
        const messages = step.feedback.guidance[langKey] || step.feedback.guidance['en'];
        message = messages[Math.floor(Math.random() * messages.length)] || 'Try again!';
        points = 15;
      }
    } else {
      // General voice analysis with multilingual support
      if (confidence > 0.8 && intensity > 0.6) {
        const generalPositive = {
          en: "Incredible! Your voice is full of power and conviction!",
          hi: "‡§Ö‡§µ‡§ø‡§∂‡•ç‡§µ‡§∏‡§®‡•Ä‡§Ø! ‡§Ü‡§™‡§ï‡•Ä ‡§Ü‡§µ‡§æ‡§ú‡§º ‡§∂‡§ï‡•ç‡§§‡§ø ‡§î‡§∞ ‡§¶‡•É‡§¢‡§º ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§∏‡•á ‡§≠‡§∞‡•Ä ‡§π‡•à!",
          mr: "‡§Ö‡§µ‡§ø‡§∂‡•ç‡§µ‡§∏‡§®‡•Ä‡§Ø! ‡§§‡•Å‡§Æ‡§ö‡§æ ‡§Ü‡§µ‡§æ‡§ú ‡§∂‡§ï‡•ç‡§§‡•Ä ‡§Ü‡§£‡§ø ‡§¶‡•É‡§¢ ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏‡§æ‡§®‡•á ‡§≠‡§∞‡§≤‡•á‡§≤‡§æ ‡§Ü‡§π‡•á!"
        };
        message = generalPositive[langKey] || generalPositive['en'];
        points = 25;
      } else if (confidence > 0.6) {
        const generalEncouraging = {
          en: "Great job! I can hear your strength growing!",
          hi: "‡§¨‡§π‡•Å‡§§ ‡§¨‡§¢‡§º‡§ø‡§Ø‡§æ! ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§¨‡§¢‡§º‡§§‡•Ä ‡§§‡§æ‡§ï‡§§ ‡§∏‡•Å‡§® ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Å!",
          mr: "‡§ñ‡•Ç‡§™ ‡§õ‡§æ‡§®! ‡§Æ‡•Ä ‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§µ‡§æ‡§¢‡§§‡•Ä ‡§§‡§æ‡§ï‡§¶ ‡§ê‡§ï‡•Ç ‡§∂‡§ï‡§§‡•ã!"
        };
        message = generalEncouraging[langKey] || generalEncouraging['en'];
        points = 20;
      } else {
        const generalGuidance = {
          en: "Good effort! Keep practicing and your voice will get stronger!",
          hi: "‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏! ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡§§‡•á ‡§∞‡§π‡•á‡§Ç ‡§î‡§∞ ‡§Ü‡§™‡§ï‡•Ä ‡§Ü‡§µ‡§æ‡§ú‡§º ‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§π‡•ã‡§§‡•Ä ‡§ú‡§æ‡§è‡§ó‡•Ä!",
          mr: "‡§ö‡§æ‡§Ç‡§ó‡§≤‡§æ ‡§™‡•ç‡§∞‡§Ø‡§§‡•ç‡§®! ‡§∏‡§∞‡§æ‡§µ ‡§ï‡§∞‡§§ ‡§∞‡§æ‡§π‡§æ ‡§Ü‡§£‡§ø ‡§§‡•Å‡§Æ‡§ö‡§æ ‡§Ü‡§µ‡§æ‡§ú ‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§π‡•ã‡§§ ‡§ú‡§æ‡§à‡§≤!"
        };
        message = generalGuidance[langKey] || generalGuidance['en'];
        points = 15;
      }
    }

    return { message, points };
  };



  const nextStep = () => {
    if (!currentSession || !selectedScenario) {
      console.log('Cannot proceed: missing session or scenario');
      return;
    }

    console.log(`Moving to next step. Current: ${currentSession.currentStep}, Total: ${selectedScenario.steps.length}`);

    // Clear all timers
    if (progressTimerRef.current) {
      clearInterval(progressTimerRef.current);
      progressTimerRef.current = null;
    }

    stopListening();

    const nextStepIndex = currentSession.currentStep + 1;

    // Check if we've completed all steps
    if (nextStepIndex >= selectedScenario.steps.length) {
      console.log('All steps completed, finishing session');
      completeSession();
      return;
    }

    const updatedSession = {
      ...currentSession,
      currentStep: nextStepIndex,
      progress: (nextStepIndex / selectedScenario.steps.length) * 100
    };

    console.log('Updating session to step:', nextStepIndex);
    setCurrentSession(updatedSession);

    // Reset UI state
    setShowChoices(false);
    setWaitingForVoice(false);
    setCelebrationMode(false);
    setCurrentFeedback('');

    // Small delay before next step for smooth transition
    setTimeout(() => {
      executeStep(updatedSession, nextStepIndex);
    }, 500);
  };

  const completeSession = async () => {
    console.log('Completing session');

    // Clear all timers
    if (progressTimerRef.current) {
      clearInterval(progressTimerRef.current);
      progressTimerRef.current = null;
    }

    setIsActive(false);
    stopListening();

    if (currentSession) {
      // Calculate achievements based on performance
      const achievements: string[] = [];
      if (currentSession.points >= 100) achievements.push('üèÜ Point Master');
      if (currentSession.points >= 150) achievements.push('‚≠ê Superstar');
      if (currentSession.voiceAnalysis.length >= 2) achievements.push('üé§ Voice Champion');
      if (currentSession.userChoices.length >= 2) achievements.push('üéØ Decision Maker');
      if (sessionTime >= 300) achievements.push('‚è∞ Dedicated Practitioner');
      achievements.push('‚ú® Session Complete');

      const completedSession = {
        ...currentSession,
        completed: true,
        progress: 100,
        achievements
      };
      setCurrentSession(completedSession);

      // Save session to Firestore
      if (currentUser) {
        try {
          const sessionData = {
            userId: currentUser.uid,
            startTime: new Date(Date.now() - sessionTime * 1000), // Calculate start time
            endTime: new Date(),
            duration: sessionTime,
            sessionType: 'voice' as const,
            progressMetrics: {
              emotionalRegulation: Math.min(100, currentSession.points / 2) / 100,
              selfAwareness: Math.min(100, currentSession.voiceAnalysis.length * 25) / 100,
              copingSkillsUsage: Math.min(100, currentSession.userChoices.length * 30) / 100,
              therapeuticAlliance: 0.8, // Default good alliance for voice therapy
              engagementLevel: Math.min(100, sessionTime / 180) / 100 // Based on time spent
            },
            outcomes: {
              overallMood: currentSession.points >= 100 ? 'improved' as const : 'stable' as const,
              goalsAddressed: [currentSession.exercise.title],
              skillsPracticed: [currentSession.exercise.type],
              insightsGained: achievements
            }
          };

          await firebaseService.saveSession(sessionData);
          toast.success('Session saved successfully!');
          console.log('Voice therapy session saved to Firestore');

          // --- NEW: Log this activity ---
          await firebaseService.logUserActivity(
            currentUser.uid,
            'completed_voice_session',
            { 
              exercise: completedSession.exercise.title, 
              points: completedSession.points,
              duration: sessionTime,
              exerciseType: completedSession.exercise.type
            }
          );
          // --- END NEW ---
        } catch (error) {
          console.error('Error saving session:', error);
          toast.error('Failed to save session data');
        }
      }
    }

    // Show completion message
    setShowCompletion(true);
    setCelebrationMode(true);

    try {
      await speakText(
        `Wonderful! You've completed your ${currentSession?.exercise.title} session and earned ${currentSession?.points} points! You took control of your journey and that's amazing!`,
        selectedVoice
      );
    } catch (error) {
      console.warn('Completion voice failed:', error);
    }
  };

  const resetSession = () => {
    // Clear all timers
    if (stepTimerRef.current) clearInterval(stepTimerRef.current);
    if (progressTimerRef.current) clearInterval(progressTimerRef.current);
    if (sessionTimerRef.current) clearInterval(sessionTimerRef.current);

    // Stop any ongoing voice activities
    if (mediaRecorderRef.current && mediaRecorderRef.current.state === "recording") {
      mediaRecorderRef.current.stop();
    }

    // Reset all state
    setCurrentSession(null);
    setSelectedScenario(null);
    setIsActive(false);
    setIsListening(false);
    setIsPlaying(false);
    setSessionTime(0);
    setStepProgress(0);
    setVoiceAnalysisResults([]);
    setShowCompletion(false);
    setUserFeedback('');
    setCurrentFeedback('');
    setShowChoices(false);
    setWaitingForVoice(false);
    setCelebrationMode(false);
    setShowSettings(false);
  };









  // Helper function to convert blob to base64
  const blobToBase64 = (blob: Blob): Promise<string> => {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = () => {
        const result = reader.result as string;
        // Remove the data URL prefix to get just the base64 string
        const base64 = result.split(',')[1];
        resolve(base64 || '');
      };
      reader.onerror = reject;
      reader.readAsDataURL(blob);
    });
  };

  // Initialize Firebase functions
  const functions = getFunctions();
  const transcribeAudio = httpsCallable(functions, 'transcribeAudio');
  const synthesizeSpeech = httpsCallable<{ text: string; languageCode?: string; voiceName?: string; speakingRate?: number; pitch?: number; }, { audioBase64: string }>(functions, 'synthesizeSpeech');

  // --- Function to play Base64 Audio using Web Audio API ---
  const playBase64Audio = async (base64String: string) => {
    try {
      // Ensure AudioContext is available
      if (!audioContextRef.current) {
        audioContextRef.current = new (window.AudioContext || (window as any).webkitAudioContext)();
      }
      const audioContext = audioContextRef.current;

      // Resume AudioContext if suspended (required by some browsers)
      if (audioContext.state === 'suspended') {
        await audioContext.resume();
      }

      // Stop any currently playing audio
      if (audioSourceRef.current) {
        audioSourceRef.current.stop();
      }

      // Decode the Base64 string to ArrayBuffer
      const binaryString = window.atob(base64String);
      const len = binaryString.length;
      const bytes = new Uint8Array(len);
      for (let i = 0; i < len; i++) {
        bytes[i] = binaryString.charCodeAt(i);
      }
      const audioBuffer = await audioContext.decodeAudioData(bytes.buffer);

      // Create an AudioBufferSourceNode
      const source = audioContext.createBufferSource();
      source.buffer = audioBuffer;
      source.connect(audioContext.destination);

      // Play the audio
      setIsPlaying(true);
      source.start(0);
      audioSourceRef.current = source;

      // Handle end of playback
      source.onended = () => {
        setIsPlaying(false);
        audioSourceRef.current = null;
        console.log("Audio playback finished.");
      };
    } catch (error) {
      console.error("Error playing base64 audio:", error);
      toast.error("Failed to play AI voice response.");
      setIsPlaying(false); // Ensure state resets on error
    }
  };

  // --- Stop voice response function ---
  const stopVoiceResponse = () => {
    try {
      if (audioSourceRef.current) {
        audioSourceRef.current.stop(); // Stop Web Audio playback
        console.log("Audio playback stopped by user.");
      }
      setIsPlaying(false); // Force state update
    } catch (error) {
      console.error("Error stopping audio:", error);
      setIsPlaying(false);
    }
  };

  // --- Unified TTS function (FIXED) ---
  const speakText = async (text: string, voiceOption?: VoiceOption) => {
    if (!text.trim()) return;

    try {
      setIsPlaying(true);

      const voice = voiceOption || selectedVoice;
      const languageCode = voice.language || 'en-IN';
      const voiceName = voice.voiceURI || voice.name;

      // --- ADD THESE LINES ---
      const speakingRate = voice.rate || 1.0;
      const pitch = voice.pitch || 0;
      // --- END ADDED LINES ---

      console.log(`Calling synthesizeSpeech with voice: ${voiceName}, lang: ${languageCode}, rate: ${speakingRate}, pitch: ${pitch}`);

      const result = await synthesizeSpeech({
        text: text,
        languageCode: languageCode,
        voiceName: voiceName,
        // --- PASS THE NEW VALUES HERE ---
        speakingRate: speakingRate,
        pitch: pitch
        // --- END PASSING VALUES ---
      });

      const audioBase64 = result.data.audioBase64;
      if (audioBase64) {
        console.log("Received synthesized audio, attempting playback...");
        await playBase64Audio(audioBase64);
      } else {
        console.warn("Synthesize speech returned no audio data.");
        toast.error("Could not generate audio for this message.");
        setIsPlaying(false);
      }
    } catch (error: any) {
      console.error("Error during TTS call or playback:", error);
      toast.error(`AI Voice failed: ${error.message || 'Could not synthesize speech'}`);
      setIsPlaying(false);
    }
  };

  const requestMicrophonePermission = async (): Promise<boolean> => {
    try {
      // Explicit microphone permission request
      const stream = await navigator.mediaDevices.getUserMedia({
        audio: {
          echoCancellation: true,
          noiseSuppression: true,
          autoGainControl: true
        }
      });

      // Stop the stream immediately - we just needed to check permissions
      stream.getTracks().forEach(track => track.stop());
      return true;
    } catch (error) {
      console.error('Microphone permission denied:', error);

      // Show user-friendly error message
      if (error instanceof Error) {
        if (error.name === 'NotAllowedError') {
          alert('üé§ Microphone access is required for voice therapy. Please enable microphone permissions in your browser settings and try again.');
        } else if (error.name === 'NotFoundError') {
          alert('üé§ No microphone found. Please connect a microphone and try again.');
        } else {
          alert('üé§ Unable to access microphone. Please check your device settings.');
        }
      }
      return false;
    }
  };

  // Chat functionality removed - use /companion route for AI chat

  const startListening = async () => {
    // First, explicitly request microphone permission
    const hasPermission = await requestMicrophonePermission();
    if (!hasPermission) {
      return;
    }

    // *** Determine Language Codes from the SELECTED VOICE ***
    const sessionLanguage = selectedVoice.language || 'en-IN'; // e.g., 'hi-IN', 'bn-IN', 'en-IN'
    let languageCode = sessionLanguage;
    let alternativeLanguageCodes: string[] = [];

    // Set a logical alternative language.
    // If the selected voice isn't English, add English as a backup.
    // If the selected voice IS English, add Hindi as a backup.
    if (languageCode.startsWith('en')) {
      alternativeLanguageCodes = ['hi-IN'];
    } else {
      alternativeLanguageCodes = ['en-IN'];
    }

    console.log(`STT Language Setup - Selected Voice: ${selectedVoice.name}, Primary: ${languageCode}, Alternatives: [${alternativeLanguageCodes.join(', ')}]`);

    try {
      setIsListening(true);
      setInputValue("Listening...");

      const stream = await navigator.mediaDevices.getUserMedia({
        audio: {
          echoCancellation: true,
          noiseSuppression: true,
          autoGainControl: true
        }
      });

      const mimeType = 'audio/webm;codecs=opus';
      mediaRecorderRef.current = new MediaRecorder(stream, { mimeType });
      audioChunksRef.current = [];

      mediaRecorderRef.current.ondataavailable = (event) => {
        if (event.data.size > 0) audioChunksRef.current.push(event.data);
      };

      mediaRecorderRef.current.onstop = async () => {
        console.log('Recording stopped, processing audio for STT...');
        const audioBlob = new Blob(audioChunksRef.current, { type: mimeType });
        stream.getTracks().forEach(track => track.stop()); // Stop mic

        if (audioBlob.size === 0) {
          setIsListening(false);
          setInputValue("");
          return;
        }

        try {
          setInputValue("Processing voice..."); // Indicate processing
          const audioBase64 = await blobToBase64(audioBlob);

          console.log(`üé§ STT DEBUG: Calling transcribeAudio`);
          console.log(`üé§ Selected Voice: ${selectedVoice.name} (${selectedVoice.language})`);
          console.log(`üé§ Primary Language: ${languageCode}`);
          console.log(`üé§ Alternative Languages: [${alternativeLanguageCodes.join(', ')}]`);
          
          const result = await transcribeAudio({
            audioBytes: audioBase64,
            languageCode: languageCode,
            alternativeLanguageCodes: alternativeLanguageCodes,
            sampleRateHertz: 48000
          });

          const resultData = result.data as { transcription: string; confidence: number };
          const transcript = resultData.transcription;
          
          console.log(`üé§ STT RESULT: "${transcript}" (confidence: ${resultData.confidence})`);
          console.log(`üé§ Expected language: ${languageCode}`);

          if (transcript) {
            // Handle therapy mode - create VoiceAnalysisResult for therapy processing
            const voiceResult: VoiceAnalysisResult = {
              transcript: transcript,
              confidence: resultData.confidence || 0.8,
              language: languageCode.includes('hi') ? 'hindi' : 
                       languageCode.includes('mr') ? 'marathi' :
                       languageCode.includes('bn') ? 'bengali' :
                       languageCode.includes('ta') ? 'tamil' :
                       languageCode.includes('te') ? 'telugu' :
                       languageCode.includes('gu') ? 'gujarati' :
                       languageCode.includes('kn') ? 'kannada' :
                       languageCode.includes('ml') ? 'malayalam' : 'english',
              emotionalIndicators: {
                tone: 'neutral',
                intensity: 0.5,
                valence: 0,
                arousal: 0.5,
                speechRate: 'normal',
                volume: 'normal',
                pitch: 'normal'
              },
              linguisticFeatures: {
                wordCount: transcript.split(' ').length,
                sentimentScore: 0,
                complexityScore: 0,
                hesitationMarkers: 0,
                fillerWords: 0,
                emotionalWords: [],
                culturalExpressions: []
              },
              mentalHealthIndicators: {
                stressLevel: 0.3,
                depressionIndicators: [],
                anxietyIndicators: [],
                cognitiveLoad: 0.4,
                emotionalRegulation: 0.8
              },
              culturalContext: {
                languageMixing: 0,
                culturalReferences: [],
                formalityLevel: 0.5,
                respectMarkers: []
              },
              recommendations: {
                immediate: ['Great job using your voice!'],
                therapeutic: [],
                communication: []
              }
            };

            handleVoiceResponse(voiceResult);
            setInputValue(transcript);
          } else {
            toast.info("Could not understand audio.");
            setInputValue("");
          }
        } catch (sttError: any) {
          console.error("STT Error:", sttError);
          toast.error(`Transcription failed: ${sttError.message || 'Unknown STT error'}`);
          setInputValue("");
        } finally {
          setIsListening(false);
        }
      };

      mediaRecorderRef.current.start();
      setIsListening(true);
      setInputValue("Listening...");
    } catch (error) {
      console.warn('Voice listening failed:', error);
      setIsListening(false);
      setInputValue("");
      alert('üé§ Voice analysis failed. Please try again or check your microphone settings.');
    }
  };

  const stopListening = () => {
    if (isListening && mediaRecorderRef.current && mediaRecorderRef.current.state === "recording") {
      mediaRecorderRef.current.stop(); // Trigger the onstop handler for transcription
      // The onstop handler will set isListening = false after processing
    } else if (isListening) {
      // Reset listening state if no active recording
      setIsListening(false);
    }
  };



  return (
    <div className="min-h-screen bg-green-100 relative overflow-hidden">
      {/* Mint Green Background */}
      <div className="absolute inset-0 opacity-70">
        <div className="absolute top-10 left-10 w-72 h-72 bg-green-200 rounded-full mix-blend-multiply filter blur-xl animate-pulse"></div>
        <div className="absolute top-40 right-10 w-72 h-72 bg-green-300 rounded-full mix-blend-multiply filter blur-xl animate-pulse animation-delay-2000"></div>
        <div className="absolute bottom-10 left-1/2 w-72 h-72 bg-green-200 rounded-full mix-blend-multiply filter blur-xl animate-pulse animation-delay-4000"></div>
      </div>

      {!currentSession ? (
        // Exercise Selection Screen
        <div className="p-4 md:p-6 max-w-6xl mx-auto">
          {/* Header */}
          <div className="text-center mb-8 md:mb-12">
            <div className="inline-flex items-center justify-center w-16 h-16 md:w-20 md:h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full mb-4 md:mb-6">
              <Mic className="w-8 h-8 md:w-10 md:h-10 text-white" />
            </div>
            <h1 className="text-2xl md:text-4xl font-bold text-gray-900 mb-3 md:mb-4">Voice Therapy</h1>
            <p className="text-base md:text-xl text-gray-600 max-w-2xl mx-auto px-4">
              Choose a guided voice exercise to improve your emotional well-being and self-expression
            </p>
          </div>

          {/* WORKING VOICE SELECTION */}
          <div style={{
            marginBottom: '24px',
            maxWidth: '1024px',
            margin: '0 auto 24px auto'
          }}>
            <div style={{
              position: 'relative',
              zIndex: 1000,
              padding: '16px',
              backgroundColor: 'rgba(255, 255, 255, 0.9)',
              backdropFilter: 'blur(8px)',
              border: '2px solid #c084fc',
              borderRadius: '10px'
            }}
            className="md:p-6"
            >
              <div className="flex items-center justify-between mb-4">
                <h3 className="text-lg font-semibold text-gray-800">Choose Your AI Companion Voice</h3>
                <button
                  style={{
                    padding: '8px 12px',
                    backgroundColor: '#fff',
                    color: '#6c757d',
                    border: '1px solid #dee2e6',
                    borderRadius: '4px',
                    cursor: 'pointer',
                    fontSize: '14px'
                  }}
                  onClick={() => setShowVoiceSelector(!showVoiceSelector)}
                >
                  {showVoiceSelector ? 'Hide' : 'Show'} Voices
                </button>
              </div>

              <div className="flex items-center gap-4 mb-4">
                <div className="flex items-center gap-3">
                  <div className="w-12 h-12 bg-gradient-to-br from-purple-400 to-pink-500 rounded-full flex items-center justify-center">
                    <span className="text-white font-bold">{selectedVoice.name[0]}</span>
                  </div>
                  <div>
                    <p className="font-medium text-gray-800">{selectedVoice.name}</p>
                    <p className="text-sm text-gray-600">{selectedVoice.description}</p>
                  </div>
                </div>
                <button
                  style={{
                    padding: '8px 12px',
                    backgroundColor: '#fff',
                    color: '#6c757d',
                    border: '1px solid #dee2e6',
                    borderRadius: '4px',
                    cursor: 'pointer',
                    fontSize: '14px',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '4px'
                  }}
                  onClick={() => {
                    const langKey = getLangKey(selectedVoice);
                    const testMessages = {
                      en: "Hello! I'm your AI companion. I'm here to guide you through your voice therapy journey.",
                      hi: "‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡§æ AI ‡§∏‡§æ‡§•‡•Ä ‡§π‡•Ç‡§Å‡•§ ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§Ü‡§µ‡§æ‡§ú‡§º ‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§æ ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡§æ ‡§Æ‡§æ‡§∞‡•ç‡§ó‡§¶‡§∞‡•ç‡§∂‡§® ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ø‡§π‡§æ‡§Å ‡§π‡•Ç‡§Å‡•§",
                      mr: "‡§®‡§Æ‡§∏‡•ç‡§ï‡§æ‡§∞! ‡§Æ‡•Ä ‡§§‡•Å‡§Æ‡§ö‡§æ AI ‡§∏‡§æ‡§•‡•Ä ‡§Ü‡§π‡•á. ‡§Æ‡•Ä ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§Ü‡§µ‡§æ‡§ú ‡§•‡•á‡§∞‡§™‡•Ä ‡§™‡•ç‡§∞‡§µ‡§æ‡§∏‡§æ‡§§ ‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§≤‡§æ ‡§Æ‡§æ‡§∞‡•ç‡§ó‡§¶‡§∞‡•ç‡§∂‡§® ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§á‡§•‡•á ‡§Ü‡§π‡•á.",
                      bn: "‡¶π‡ßç‡¶Ø‡¶æ‡¶≤‡ßã! ‡¶Ü‡¶Æ‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ AI ‡¶∏‡¶ô‡ßç‡¶ó‡ßÄ‡•§ ‡¶Ü‡¶Æ‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶≠‡¶Ø‡¶º‡ßá‡¶∏ ‡¶•‡ßá‡¶∞‡¶æ‡¶™‡¶ø ‡¶Ø‡¶æ‡¶§‡ßç‡¶∞‡¶æ‡¶Ø‡¶º ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶ó‡¶æ‡¶á‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶õ‡¶ø‡•§",
                      ta: "‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç! ‡Æ®‡Ææ‡Æ©‡Øç ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç AI ‡Æ§‡ØÅ‡Æ£‡Øà. ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æï‡ØÅ‡Æ∞‡Æ≤‡Øç ‡Æö‡Æø‡Æï‡Æø‡Æö‡Øç‡Æö‡Øà ‡Æ™‡ÆØ‡Æ£‡Æ§‡Øç‡Æ§‡Æø‡Æ≤‡Øç ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡Æµ‡Æ¥‡Æø‡Æï‡Ææ‡Æü‡Øç‡Æü ‡Æ®‡Ææ‡Æ©‡Øç ‡Æá‡Æô‡Øç‡Æï‡Øá ‡Æá‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡Æø‡Æ±‡Øá‡Æ©‡Øç.",
                      te: "‡∞π‡∞≤‡±ã! ‡∞®‡±á‡∞®‡±Å ‡∞Æ‡±Ä AI ‡∞∏‡∞π‡∞ö‡∞∞‡±Å‡∞°‡∞ø‡∞®‡∞ø. ‡∞Æ‡±Ä ‡∞µ‡∞æ‡∞Ø‡∞ø‡∞∏‡±ç ‡∞•‡±Ü‡∞∞‡∞™‡±Ä ‡∞™‡±ç‡∞∞‡∞Ø‡∞æ‡∞£‡∞Ç‡∞≤‡±ã ‡∞Æ‡±Ä‡∞ï‡±Å ‡∞Æ‡∞æ‡∞∞‡±ç‡∞ó‡∞¶‡∞∞‡±ç‡∞∂‡∞®‡∞Ç ‡∞ö‡±á‡∞Ø‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞®‡±á‡∞®‡±Å ‡∞á‡∞ï‡±ç‡∞ï‡∞° ‡∞â‡∞®‡±ç‡∞®‡∞æ‡∞®‡±Å.",
                      gu: "‡™π‡´á‡™≤‡´ã! ‡™π‡´Å‡™Ç ‡™§‡™Æ‡™æ‡™∞‡´ã AI ‡™∏‡™æ‡™•‡´Ä ‡™õ‡´Å‡™Ç. ‡™π‡´Å‡™Ç ‡™§‡™Æ‡™æ‡™∞‡´Ä ‡™µ‡´â‡™á‡™∏ ‡™•‡´á‡™∞‡™æ‡™™‡´Ä ‡™ú‡™∞‡´ç‡™®‡´Ä‡™Æ‡™æ‡™Ç ‡™§‡™Æ‡™®‡´á ‡™Æ‡™æ‡™∞‡´ç‡™ó‡™¶‡™∞‡´ç‡™∂‡™® ‡™Ü‡™™‡™µ‡™æ ‡™Æ‡™æ‡™ü‡´á ‡™Ö‡™π‡´Ä‡™Ç ‡™õ‡´Å‡™Ç.",
                      kn: "‡≤π‡≤≤‡≥ã! ‡≤®‡≤æ‡≤®‡≥Å ‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ AI ‡≤∏‡≤π‡≤ö‡≤∞. ‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤ß‡≥ç‡≤µ‡≤®‡≤ø ‡≤ö‡≤ø‡≤ï‡≤ø‡≤§‡≥ç‡≤∏‡≥Ü‡≤Ø ‡≤™‡≥ç‡≤∞‡≤Ø‡≤æ‡≤£‡≤¶‡≤≤‡≥ç‡≤≤‡≤ø ‡≤®‡≤ø‡≤Æ‡≤ó‡≥Ü ‡≤Æ‡≤æ‡≤∞‡≥ç‡≤ó‡≤¶‡≤∞‡≥ç‡≤∂‡≤® ‡≤®‡≥Ä‡≤°‡≤≤‡≥Å ‡≤®‡≤æ‡≤®‡≥Å ‡≤á‡≤≤‡≥ç‡≤≤‡≤ø‡≤¶‡≥ç‡≤¶‡≥á‡≤®‡≥Ü.",
                      ml: "‡¥π‡¥≤‡µã! ‡¥û‡¥æ‡µª ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ AI ‡¥ï‡µÇ‡¥ü‡µç‡¥ü‡¥æ‡¥≥‡¥ø‡¥Ø‡¥æ‡¥£‡µç. ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥µ‡µã‡¥Ø‡µç‚Äå‡¥∏‡µç ‡¥§‡µÜ‡¥±‡¥æ‡¥™‡µç‡¥™‡¥ø ‡¥Ø‡¥æ‡¥§‡µç‡¥∞‡¥Ø‡¥ø‡µΩ ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÜ ‡¥®‡¥Ø‡¥ø‡¥ï‡µç‡¥ï‡¥æ‡µª ‡¥û‡¥æ‡µª ‡¥á‡¥µ‡¥ø‡¥ü‡µÜ‡¥Ø‡µÅ‡¥£‡µç‡¥ü‡µç."
                    };
                    const testMessage = testMessages[langKey] || testMessages['en'];
                    speakText(testMessage, selectedVoice);
                  }}
                >
                  <Play className="w-4 h-4" />
                  Test Voice
                </button>
              </div>

              {showVoiceSelector && (
                <div style={{
                  display: 'grid',
                  gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))',
                  gap: '16px',
                  position: 'relative',
                  zIndex: 1000
                }}>
                  {AVAILABLE_VOICES.map((voice) => (
                    <button
                      key={voice.id}
                      style={{
                        padding: '16px',
                        backgroundColor: selectedVoice.id === voice.id ? '#f3e8ff' : '#fff',
                        border: selectedVoice.id === voice.id ? '2px solid #8b5cf6' : '1px solid #e5e7eb',
                        borderRadius: '8px',
                        cursor: 'pointer',
                        textAlign: 'left',
                        transition: 'all 0.2s',
                        position: 'relative',
                        zIndex: 1001
                      }}
                      onMouseEnter={(e) => {
                        if (selectedVoice.id !== voice.id) {
                          e.currentTarget.style.backgroundColor = '#f9fafb';
                          e.currentTarget.style.boxShadow = '0 4px 6px -1px rgba(0, 0, 0, 0.1)';
                        }
                      }}
                      onMouseLeave={(e) => {
                        if (selectedVoice.id !== voice.id) {
                          e.currentTarget.style.backgroundColor = '#fff';
                          e.currentTarget.style.boxShadow = 'none';
                        }
                      }}
                      onClick={async () => {
                        console.log('Voice selected:', voice.name);
                        setSelectedVoice(voice);

                        await saveVoicePreference(voice);
                      }}
                    >
                      <div style={{
                        display: 'flex',
                        alignItems: 'center',
                        gap: '12px',
                        marginBottom: '8px'
                      }}>
                        <div style={{
                          width: '32px',
                          height: '32px',
                          borderRadius: '50%',
                          display: 'flex',
                          alignItems: 'center',
                          justifyContent: 'center',
                          color: 'white',
                          fontSize: '14px',
                          fontWeight: 'bold',
                          backgroundColor: voice.gender === 'female' ? '#ec4899' : voice.gender === 'male' ? '#3b82f6' : '#6b7280'
                        }}>
                          {voice.name[0]}
                        </div>
                        <div>
                          <p style={{
                            fontWeight: '500',
                            fontSize: '14px',
                            margin: '0',
                            color: '#111827'
                          }}>{voice.name}</p>
                          <p style={{
                            fontSize: '12px',
                            color: '#6b7280',
                            margin: '0'
                          }}>{voice.accent} ‚Ä¢ {voice.personality}</p>
                        </div>
                      </div>
                      <p style={{
                        fontSize: '12px',
                        color: '#4b5563',
                        margin: '0'
                      }}>{voice.description}</p>
                    </button>
                  ))}
                </div>
              )}
            </div>
          </div>

          {/* WORKING EXERCISE CARDS */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
            {THERAPY_EXERCISES.map((exercise) => (
              <div
                key={exercise.id}
                style={{
                  position: 'relative',
                  zIndex: 1000,
                  cursor: 'pointer',
                  borderRadius: '12px',
                  overflow: 'hidden',
                  backgroundColor: '#fff',
                  boxShadow: '0 10px 15px -3px rgba(0, 0, 0, 0.1)',
                  transition: 'all 0.3s ease',
                  transform: 'translateY(0)'
                }}
                onMouseEnter={(e) => {
                  e.currentTarget.style.transform = 'translateY(-8px)';
                  e.currentTarget.style.boxShadow = '0 25px 50px -12px rgba(0, 0, 0, 0.25)';
                }}
                onMouseLeave={(e) => {
                  e.currentTarget.style.transform = 'translateY(0)';
                  e.currentTarget.style.boxShadow = '0 10px 15px -3px rgba(0, 0, 0, 0.1)';
                }}
                onClick={async () => {
                  console.log('Exercise selected:', exercise.title);
                  if (exercise.scenarios[0]) {
                    await startSession(exercise, exercise.scenarios[0]);
                  }
                }}
              >
                <div className={`h-2 bg-gradient-to-r ${exercise.color}`}></div>
                <div className="p-8">
                  <div className="flex items-start justify-between mb-6">
                    <div className="flex-1">
                      <div className="flex items-center gap-3 mb-3">
                        <span className="text-3xl">{exercise.icon}</span>
                        <div>
                          <h3 className="text-2xl font-bold text-gray-900">{exercise.title}</h3>
                          <p className="text-sm text-gray-500 font-medium">{exercise.subtitle}</p>
                        </div>
                      </div>
                      <p className="text-gray-600 mb-4 leading-relaxed">{exercise.description}</p>

                      {/* Benefits */}
                      <div className="mb-4">
                        <h4 className="text-sm font-semibold text-gray-700 mb-2">Benefits:</h4>
                        <div className="flex flex-wrap gap-2">
                          {exercise.benefits.map((benefit, index) => (
                            <span key={index} className="text-xs px-3 py-1 bg-gray-100 text-gray-700 rounded-full">
                              {benefit}
                            </span>
                          ))}
                        </div>
                      </div>

                      {/* Meta info */}
                      <div className="flex items-center gap-4 text-sm text-gray-500">
                        <span className="flex items-center gap-1">
                          <span>üéØ</span>
                          User-Controlled Pace
                        </span>
                        <span className={`px-2 py-1 rounded-full text-xs font-medium ${getDifficultyColor(exercise.difficulty)}`}>
                          {exercise.difficulty}
                        </span>
                        <span className="flex items-center gap-1">
                          <span>üé§</span>
                          Interactive
                        </span>
                      </div>
                    </div>
                  </div>

                  <button
                    style={{
                      width: '100%',
                      padding: '12px 20px',
                      background: `linear-gradient(to right, ${exercise.color.includes('yellow') ? '#fbbf24, #f59e0b' : exercise.color.includes('blue') ? '#3b82f6, #8b5cf6' : exercise.color.includes('pink') ? '#ec4899, #f43f5e' : exercise.color.includes('red') ? '#ef4444, #ec4899' : '#3b82f6, #8b5cf6'})`,
                      color: 'white',
                      border: 'none',
                      borderRadius: '6px',
                      cursor: 'pointer',
                      fontSize: '16px',
                      fontWeight: '500',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      gap: '8px',
                      transition: 'opacity 0.2s'
                    }}
                    onMouseEnter={(e) => e.currentTarget.style.opacity = '0.9'}
                    onMouseLeave={(e) => e.currentTarget.style.opacity = '1'}
                    onClick={async () => {
                      if (exercise.scenarios[0]) {
                        await startSession(exercise, exercise.scenarios[0]);
                      }
                    }}
                  >
                    <Play className="w-4 h-4" />
                    Start Session
                  </button>
                </div>
              </div>
            ))}
          </div>
        </div>
      ) : showCompletion ? (
        // Enhanced Completion Screen with Results & Suggestions
        <div style={{
          position: 'relative',
          zIndex: 10,
          padding: '24px',
          maxWidth: '1024px',
          margin: '0 auto',
          minHeight: '100vh',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center'
        }}>
          <div style={{
            position: 'relative',
            zIndex: 1000,
            padding: '48px',
            textAlign: 'center',
            backgroundColor: 'rgba(255, 255, 255, 0.95)',
            backdropFilter: 'blur(8px)',
            borderRadius: '15px',
            boxShadow: '0 25px 50px -12px rgba(0, 0, 0, 0.25)'
          }}>
            {/* Celebration Header */}
            <div className="mb-8">
              <div className="inline-flex items-center justify-center w-32 h-32 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full mb-6 animate-bounce">
                <CheckCircle className="w-16 h-16 text-white" />
              </div>
              <h2 className="text-4xl font-bold text-gray-900 mb-2">üéâ Amazing Work!</h2>
              <p className="text-xl text-gray-600">
                You've completed your <span className="font-semibold text-purple-600">{currentSession.exercise.title}</span> session!
              </p>
            </div>

            {/* Achievements */}
            {currentSession.achievements && currentSession.achievements.length > 0 && (
              <div className="mb-8">
                <h3 className="text-lg font-semibold text-gray-900 mb-4">üèÜ Achievements Unlocked</h3>
                <div className="flex flex-wrap justify-center gap-3">
                  {currentSession.achievements.map((achievement, index) => (
                    <span key={index} className="px-4 py-2 bg-yellow-100 text-yellow-800 rounded-full text-sm font-medium border-2 border-yellow-300">
                      {achievement}
                    </span>
                  ))}
                </div>
              </div>
            )}

            {/* Detailed Results */}
            <div className="grid grid-cols-2 md:grid-cols-4 gap-6 mb-8 p-6 bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl">
              <div className="text-center">
                <div className="text-3xl font-bold text-blue-600">{formatTime(sessionTime)}</div>
                <div className="text-sm text-gray-500">Time Invested</div>
              </div>
              <div className="text-center">
                <div className="text-3xl font-bold text-green-600">{currentSession.points}</div>
                <div className="text-sm text-gray-500">Points Earned</div>
              </div>
              <div className="text-center">
                <div className="text-3xl font-bold text-purple-600">{voiceAnalysisResults.length}</div>
                <div className="text-sm text-gray-500">Voice Samples</div>
              </div>
              <div className="text-center">
                <div className="text-3xl font-bold text-orange-600">{currentSession.scenario.steps.length}</div>
                <div className="text-sm text-gray-500">Steps Mastered</div>
              </div>
            </div>

            {/* Personalized Suggestions */}
            <div className="mb-8 text-left">
              <h3 className="text-xl font-semibold text-gray-900 mb-4 text-center">üí° Your Personalized Suggestions</h3>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div className="p-4 bg-blue-50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-blue-800 mb-2">üéØ Next Steps</h4>
                  <ul className="text-sm text-blue-700 space-y-1">
                    <li>‚Ä¢ Practice this exercise daily for best results</li>
                    <li>‚Ä¢ Try the {getNextRecommendedExercise()} exercise next</li>
                    <li>‚Ä¢ Set a reminder for your next voice therapy session</li>
                  </ul>
                </div>
                <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                  <h4 className="font-semibold text-green-800 mb-2">üåü Your Strengths</h4>
                  <ul className="text-sm text-green-700 space-y-1">
                    <li>‚Ä¢ {getPersonalizedStrength()}</li>
                    <li>‚Ä¢ Completed {currentSession.scenario.steps.length} challenging steps</li>
                    <li>‚Ä¢ Showed courage by using your voice</li>
                  </ul>
                </div>
              </div>
            </div>

            {/* Quick Reflection */}
            <div className="mb-8">
              <h3 className="text-lg font-semibold text-gray-900 mb-4">‚ú® Quick Reflection</h3>
              <div className="grid grid-cols-3 gap-4">
                <button
                  style={{
                    padding: '16px',
                    backgroundColor: '#fff',
                    border: '1px solid #dee2e6',
                    borderRadius: '8px',
                    cursor: 'pointer',
                    display: 'flex',
                    flexDirection: 'column',
                    alignItems: 'center',
                    gap: '8px',
                    minHeight: 'auto',
                    transition: 'all 0.2s'
                  }}
                  onMouseEnter={(e) => {
                    e.currentTarget.style.backgroundColor = '#f0f9ff';
                    e.currentTarget.style.borderColor = '#22c55e';
                  }}
                  onMouseLeave={(e) => {
                    e.currentTarget.style.backgroundColor = '#fff';
                    e.currentTarget.style.borderColor = '#dee2e6';
                  }}
                  onClick={() => setUserFeedback('I feel more confident and empowered!')}
                >
                  <span style={{ fontSize: '32px' }}>üòä</span>
                  <span style={{ fontSize: '14px' }}>Feel Great!</span>
                </button>
                <button
                  style={{
                    padding: '16px',
                    backgroundColor: '#fff',
                    border: '1px solid #dee2e6',
                    borderRadius: '8px',
                    cursor: 'pointer',
                    display: 'flex',
                    flexDirection: 'column',
                    alignItems: 'center',
                    gap: '8px',
                    minHeight: 'auto',
                    transition: 'all 0.2s'
                  }}
                  onMouseEnter={(e) => {
                    e.currentTarget.style.backgroundColor = '#eff6ff';
                    e.currentTarget.style.borderColor = '#3b82f6';
                  }}
                  onMouseLeave={(e) => {
                    e.currentTarget.style.backgroundColor = '#fff';
                    e.currentTarget.style.borderColor = '#dee2e6';
                  }}
                  onClick={() => setUserFeedback('I feel calmer and more centered.')}
                >
                  <span style={{ fontSize: '32px' }}>üòå</span>
                  <span style={{ fontSize: '14px' }}>Feel Calm</span>
                </button>
                <button
                  style={{
                    padding: '16px',
                    backgroundColor: '#fff',
                    border: '1px solid #dee2e6',
                    borderRadius: '8px',
                    cursor: 'pointer',
                    display: 'flex',
                    flexDirection: 'column',
                    alignItems: 'center',
                    gap: '8px',
                    minHeight: 'auto',
                    transition: 'all 0.2s'
                  }}
                  onMouseEnter={(e) => {
                    e.currentTarget.style.backgroundColor = '#faf5ff';
                    e.currentTarget.style.borderColor = '#8b5cf6';
                  }}
                  onMouseLeave={(e) => {
                    e.currentTarget.style.backgroundColor = '#fff';
                    e.currentTarget.style.borderColor = '#dee2e6';
                  }}
                  onClick={() => setUserFeedback('I learned something new about myself.')}
                >
                  <span style={{ fontSize: '32px' }}>ü§î</span>
                  <span style={{ fontSize: '14px' }}>Learned</span>
                </button>
              </div>
              {userFeedback && (
                <div className="mt-4 p-4 bg-gray-50 rounded-lg">
                  <p className="text-gray-700 italic">"{userFeedback}"</p>
                </div>
              )}
            </div>

            <div className="flex gap-4 justify-center">
              <button
                style={{
                  padding: '12px 24px',
                  backgroundColor: '#fff',
                  color: '#6c757d',
                  border: '1px solid #dee2e6',
                  borderRadius: '6px',
                  cursor: 'pointer',
                  fontSize: '16px',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '8px'
                }}
                onClick={resetSession}
              >
                <RotateCcw className="w-4 h-4" />
                Try Another Exercise
              </button>
              <button
                style={{
                  padding: '12px 24px',
                  background: 'linear-gradient(to right, #3b82f6, #8b5cf6)',
                  color: 'white',
                  border: 'none',
                  borderRadius: '6px',
                  cursor: 'pointer',
                  fontSize: '16px',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '8px'
                }}
                onClick={resetSession}
              >
                <Home className="w-4 h-4" />
                Back to Home
              </button>
            </div>
          </div>
        </div>
      ) : (
        // Active Session Screen
        <div className="p-6 max-w-4xl mx-auto min-h-screen">

          {/* BASIC REACT TEST */}
          <div style={{
            backgroundColor: 'lime',
            padding: '20px',
            margin: '20px 0',
            textAlign: 'center',
            border: '3px solid black'
          }}>
            <h2 style={{ margin: '0 0 10px 0' }}>REACT EVENT TEST</h2>
            <button
              style={{
                padding: '15px 30px',
                backgroundColor: 'blue',
                color: 'white',
                border: 'none',
                borderRadius: '5px',
                cursor: 'pointer',
                fontSize: '18px',
                marginRight: '10px'
              }}
              onClick={() => {
                console.log('BASIC REACT BUTTON CLICKED!');
                alert('React events are working!');
              }}
            >
              BASIC TEST
            </button>

            <button
              style={{
                padding: '15px 30px',
                backgroundColor: 'orange',
                color: 'white',
                border: 'none',
                borderRadius: '5px',
                cursor: 'pointer',
                fontSize: '18px'
              }}
              onClick={() => {
                console.log('STATE UPDATE TEST - isPaused was:', isPaused);
                setIsPaused(!isPaused);
                console.log('STATE UPDATE TEST - isPaused now:', !isPaused);
              }}
            >
              STATE TEST (isPaused: {isPaused.toString()})
            </button>
          </div>
          {/* Emergency test section removed - was interfering with UI */}

          {/* Session Header */}
          <div className="mb-8">
            <div className="flex items-center justify-between mb-6">
              <div className="flex items-center gap-4">
                <div className={`w-16 h-16 rounded-full bg-gradient-to-br ${currentSession.exercise.color} flex items-center justify-center`}>
                  <span className="text-2xl">{currentSession.exercise.icon}</span>
                </div>
                <div>
                  <h1 className="text-3xl font-bold text-gray-900">{currentSession.exercise.title}</h1>
                  <p className="text-gray-600">{currentSession.exercise.subtitle}</p>
                </div>
              </div>
              <div className="flex items-center gap-3">
                <button
                  style={{
                    padding: '10px 16px',
                    backgroundColor: '#fff',
                    color: '#6c757d',
                    border: '1px solid #dee2e6',
                    borderRadius: '6px',
                    cursor: 'pointer',
                    fontSize: '14px',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '8px'
                  }}
                  onClick={() => setShowSettings(!showSettings)}
                >
                  <span>‚öôÔ∏è</span>
                  Settings
                </button>
                <button
                  style={{
                    padding: '10px 16px',
                    backgroundColor: '#28a745',
                    color: 'white',
                    border: 'none',
                    borderRadius: '6px',
                    cursor: 'pointer',
                    fontSize: '14px',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '8px'
                  }}
                  onMouseEnter={(e) => e.currentTarget.style.backgroundColor = '#218838'}
                  onMouseLeave={(e) => e.currentTarget.style.backgroundColor = '#28a745'}
                  onClick={() => completeSession()}
                >
                  <CheckCircle className="w-4 h-4" />
                  Finish & See Results
                </button>
                <button
                  style={{
                    padding: '10px 16px',
                    backgroundColor: '#fff',
                    color: '#6c757d',
                    border: '1px solid #dee2e6',
                    borderRadius: '6px',
                    cursor: 'pointer',
                    fontSize: '14px',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '8px'
                  }}
                  onClick={resetSession}
                >
                  <Home className="w-4 h-4" />
                  Exit Session
                </button>
              </div>
            </div>

            {/* WORKING SETTINGS PANEL */}
            {showSettings && (
              <div style={{
                position: 'relative',
                zIndex: 1000,
                padding: '24px',
                marginBottom: '24px',
                backgroundColor: '#f8f9fa',
                border: '2px solid #e9ecef',
                borderRadius: '10px'
              }}>
                <h3 style={{
                  fontSize: '18px',
                  fontWeight: '600',
                  marginBottom: '16px',
                  color: '#333'
                }}>Session Settings</h3>
                <div style={{
                  display: 'grid',
                  gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))',
                  gap: '24px'
                }}>
                  {/* WORKING Voice Selection */}
                  <div>
                    <label style={{
                      display: 'block',
                      fontSize: '14px',
                      fontWeight: '500',
                      color: '#374151',
                      marginBottom: '8px'
                    }}>AI Voice</label>
                    <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                      {AVAILABLE_VOICES.map((voice) => (
                        <button
                          key={voice.id}
                          style={{
                            padding: '12px',
                            backgroundColor: selectedVoice.id === voice.id ? '#dbeafe' : '#fff',
                            border: selectedVoice.id === voice.id ? '2px solid #3b82f6' : '1px solid #d1d5db',
                            borderRadius: '8px',
                            cursor: 'pointer',
                            textAlign: 'left',
                            transition: 'all 0.2s',
                            position: 'relative',
                            zIndex: 1001
                          }}
                          onMouseEnter={(e) => {
                            if (selectedVoice.id !== voice.id) {
                              e.currentTarget.style.backgroundColor = '#f9fafb';
                            }
                          }}
                          onMouseLeave={(e) => {
                            if (selectedVoice.id !== voice.id) {
                              e.currentTarget.style.backgroundColor = '#fff';
                            }
                          }}
                          onClick={async () => {
                            console.log('Voice selected in settings:', voice.name);
                            setSelectedVoice(voice);

                            await saveVoicePreference(voice);
                          }}
                        >
                          <div style={{
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'space-between'
                          }}>
                            <div style={{
                              display: 'flex',
                              alignItems: 'center',
                              gap: '8px'
                            }}>
                              <div style={{
                                width: '24px',
                                height: '24px',
                                borderRadius: '50%',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: 'white',
                                fontSize: '12px',
                                fontWeight: 'bold',
                                backgroundColor: voice.gender === 'female' ? '#ec4899' : voice.gender === 'male' ? '#3b82f6' : '#6b7280'
                              }}>
                                {voice.name[0]}
                              </div>
                              <div>
                                <p style={{
                                  fontSize: '14px',
                                  fontWeight: '500',
                                  margin: '0',
                                  color: '#111827'
                                }}>{voice.name}</p>
                                <p style={{
                                  fontSize: '12px',
                                  color: '#6b7280',
                                  margin: '0'
                                }}>{voice.personality}</p>
                              </div>
                            </div>
                            <button
                              style={{
                                padding: '6px 12px',
                                backgroundColor: '#fff',
                                color: '#6c757d',
                                border: '1px solid #dee2e6',
                                borderRadius: '4px',
                                cursor: 'pointer',
                                fontSize: '12px',
                                position: 'relative',
                                zIndex: 1002
                              }}
                              onClick={(e) => {
                                e.stopPropagation();
                                console.log('Testing voice:', voice.name);
                                const langKey = voice.language.split('-')[0] || 'en';
                                const testMessages = {
                                  en: "Hello! This is how I sound.",
                                  hi: "‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§Æ‡•à‡§Ç ‡§á‡§∏ ‡§§‡§∞‡§π ‡§¨‡•ã‡§≤‡§§‡§æ ‡§π‡•Ç‡§Å‡•§",
                                  mr: "‡§®‡§Æ‡§∏‡•ç‡§ï‡§æ‡§∞! ‡§Æ‡•Ä ‡§Ö‡§∏‡§æ ‡§¨‡•ã‡§≤‡§§‡•ã.",
                                  bn: "‡¶π‡ßç‡¶Ø‡¶æ‡¶≤‡ßã! ‡¶Ü‡¶Æ‡¶ø ‡¶è‡¶≠‡¶æ‡¶¨‡ßá ‡¶ï‡¶•‡¶æ ‡¶¨‡¶≤‡¶ø‡•§",
                                  ta: "‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç! ‡Æ®‡Ææ‡Æ©‡Øç ‡Æá‡Æ™‡Øç‡Æ™‡Æü‡Æø‡Æ§‡Øç‡Æ§‡Ææ‡Æ©‡Øç ‡Æ™‡Øá‡Æö‡ØÅ‡Æï‡Æø‡Æ±‡Øá‡Æ©‡Øç.",
                                  te: "‡∞π‡∞≤‡±ã! ‡∞®‡±á‡∞®‡±Å ‡∞á‡∞≤‡∞æ ‡∞Æ‡∞æ‡∞ü‡±ç‡∞≤‡∞æ‡∞°‡∞§‡∞æ‡∞®‡±Å.",
                                  gu: "‡™π‡´á‡™≤‡´ã! ‡™π‡´Å‡™Ç ‡™Ü ‡™∞‡´Ä‡™§‡´á ‡™¨‡´ã‡™≤‡´Å‡™Ç ‡™õ‡´Å‡™Ç.",
                                  kn: "‡≤π‡≤≤‡≥ã! ‡≤®‡≤æ‡≤®‡≥Å ‡≤à ‡≤∞‡≥Ä‡≤§‡≤ø ‡≤Æ‡≤æ‡≤§‡≤®‡≤æ‡≤°‡≥Å‡≤§‡≥ç‡≤§‡≥á‡≤®‡≥Ü.",
                                  ml: "‡¥π‡¥≤‡µã! ‡¥û‡¥æ‡µª ‡¥á‡¥ô‡µç‡¥ô‡¥®‡µÜ‡¥Ø‡¥æ‡¥£‡µç ‡¥∏‡¥Ç‡¥∏‡¥æ‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡¥§‡µç."
                                };
                                const testMessage = testMessages[langKey] || testMessages['en'];
                                speakText(testMessage, voice);
                              }}
                            >
                              Test
                            </button>
                          </div>
                        </button>
                      ))}
                    </div>
                  </div>

                  {/* Session Controls */}
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">Session Controls</label>
                    <div className="space-y-3">
                      <div className="p-3 bg-white rounded-lg border">
                        <p className="text-sm text-gray-600">Current Voice: <span className="font-medium">{selectedVoice.name}</span></p>
                        <p className="text-sm text-gray-600">Session Time: <span className="font-medium">{formatTime(sessionTime)}</span></p>
                        <p className="text-sm text-gray-600">Points Earned: <span className="font-medium text-green-600">{currentSession.points}</span></p>
                      </div>

                      {/* Voice Controls */}
                      <div className="p-3 bg-purple-50 rounded-lg border border-purple-200">
                        <p className="text-sm text-purple-800 font-medium mb-2">üé§ Voice Controls</p>
                        <div className="flex items-center gap-2 mb-2">
                          <input
                            type="checkbox"
                            id="autoPlay"
                            checked={autoPlayVoice}
                            onChange={(e) => setAutoPlayVoice(e.target.checked)}
                            className="rounded"
                          />
                          <label htmlFor="autoPlay" className="text-xs text-purple-700">Auto-play AI responses</label>
                        </div>
                        <div className="flex gap-2">
                          <button
                            style={{
                              padding: '6px 12px',
                              backgroundColor: isPaused ? '#007bff' : '#fff',
                              color: isPaused ? 'white' : '#6c757d',
                              border: '1px solid #dee2e6',
                              borderRadius: '4px',
                              cursor: 'pointer',
                              fontSize: '12px'
                            }}
                            onClick={() => setIsPaused(!isPaused)}
                          >
                            {isPaused ? '‚ñ∂Ô∏è Resume' : '‚è∏Ô∏è Pause'}
                          </button>
                          <button
                            style={{
                              padding: '6px 12px',
                              backgroundColor: '#fff',
                              color: '#6c757d',
                              border: '1px solid #dee2e6',
                              borderRadius: '4px',
                              cursor: 'pointer',
                              fontSize: '12px'
                            }}
                            onClick={() => {
                              const currentStep = selectedScenario?.steps[currentSession.currentStep];
                              if (currentStep?.voiceGuide) {
                                const langKey = getLangKey(selectedVoice);
                                const guideText = currentStep.voiceGuide[langKey] || currentStep.voiceGuide['en'];
                                speakText(guideText, selectedVoice);
                              }
                            }}
                          >
                            üîÑ Repeat
                          </button>
                        </div>
                      </div>

                      <div className="p-3 bg-blue-50 rounded-lg border border-blue-200">
                        <p className="text-sm text-blue-800 font-medium">üí° Interactive Session</p>
                        <p className="text-xs text-blue-600">Click options to respond, use voice controls, and move at your own pace. The AI will guide you through each step!</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            )}

            {/* Progress */}
            <div className="mb-6">
              <div className="flex justify-between items-center mb-2">
                <span className="text-sm font-medium text-gray-700">
                  Step {currentSession.currentStep + 1} of {currentSession.scenario.steps.length}
                </span>
                <div className="flex items-center gap-4">
                  <span className="text-sm text-gray-500">{formatTime(sessionTime)}</span>
                  <span className="text-sm font-medium text-green-600">{currentSession.points} points</span>
                </div>
              </div>
              <div className="w-full bg-gray-200 rounded-full h-3">
                <div
                  className={`h-3 rounded-full bg-gradient-to-r ${currentSession.exercise.color} transition-all duration-500`}
                  style={{ width: `${currentSession.progress}%` }}
                ></div>
              </div>
            </div>

            {/* WORKING SESSION CONTROLS */}
            <div style={{
              position: 'relative',
              zIndex: 1000,
              padding: '20px',
              margin: '20px 0',
              backgroundColor: '#f8f9fa',
              border: '2px solid #dee2e6',
              borderRadius: '10px'
            }}>
              <h3 style={{ margin: '0 0 15px 0', color: '#333', fontSize: '18px' }}>Session Controls</h3>

              <div style={{ display: 'flex', gap: '15px', flexWrap: 'wrap', alignItems: 'center' }}>
                <button
                  style={{
                    padding: '12px 20px',
                    backgroundColor: '#dc3545',
                    color: 'white',
                    border: 'none',
                    borderRadius: '6px',
                    cursor: 'pointer',
                    fontSize: '14px',
                    fontWeight: '500'
                  }}
                  onClick={() => {
                    alert('All buttons are now working!');
                    console.log('Test button clicked - SUCCESS!');
                  }}
                >
                  üß™ Test Button
                </button>

                <button
                  style={{
                    padding: '12px 20px',
                    backgroundColor: isPaused ? '#28a745' : '#007bff',
                    color: 'white',
                    border: 'none',
                    borderRadius: '6px',
                    cursor: 'pointer',
                    fontSize: '14px',
                    fontWeight: '500'
                  }}
                  onClick={() => {
                    console.log('Pause button clicked, current state:', isPaused);
                    setIsPaused(!isPaused);
                    console.log('isPaused set to:', !isPaused);
                  }}
                >
                  {isPaused ? '‚ñ∂Ô∏è Resume Session' : '‚è∏Ô∏è Pause Session'}
                </button>

                {/* Chat button removed - use /companion route for AI chat */}

                <button
                  style={{
                    padding: '12px 20px',
                    backgroundColor: '#17a2b8',
                    color: 'white',
                    border: 'none',
                    borderRadius: '6px',
                    cursor: 'pointer',
                    fontSize: '14px',
                    fontWeight: '500'
                  }}
                  onClick={() => {
                    console.log('Repeat instructions clicked');
                    const currentStep = selectedScenario?.steps[currentSession.currentStep];
                    if (currentStep?.voiceGuide) {
                      const langKey = getLangKey(selectedVoice);
                      const guideText = currentStep.voiceGuide[langKey] || currentStep.voiceGuide['en'];
                      setIsPlaying(true);
                      speakText(guideText, selectedVoice)
                        .finally(() => setIsPlaying(false));
                    }
                  }}
                  disabled={isPlaying}
                >
                  üîÑ Repeat Instructions
                </button>

                <label style={{
                  display: 'flex',
                  alignItems: 'center',
                  gap: '8px',
                  fontSize: '14px',
                  backgroundColor: 'white',
                  padding: '8px 12px',
                  borderRadius: '6px',
                  border: '1px solid #dee2e6'
                }}>
                  <input
                    type="checkbox"
                    checked={autoPlayVoice}
                    onChange={(e) => {
                      console.log('Auto-play toggled:', e.target.checked);
                      setAutoPlayVoice(e.target.checked);
                    }}
                    style={{ cursor: 'pointer' }}
                  />
                  Auto-play AI
                </label>

                <div style={{
                  display: 'flex',
                  alignItems: 'center',
                  gap: '8px',
                  padding: '8px 12px',
                  borderRadius: '6px',
                  fontSize: '12px',
                  backgroundColor: isPaused ? '#fff3cd' : '#d4edda',
                  color: isPaused ? '#856404' : '#155724'
                }}>
                  <div style={{
                    width: '8px',
                    height: '8px',
                    borderRadius: '50%',
                    backgroundColor: isPaused ? '#ffc107' : '#28a745'
                  }}></div>
                  {isPaused ? 'Paused' : 'Active'}
                </div>
              </div>

              <div style={{ marginTop: '15px', fontSize: '12px', color: '#6c757d' }}>
                Status: isPaused={isPaused.toString()}, autoPlayVoice={autoPlayVoice.toString()}
              </div>
            </div>

            {/* Chat functionality removed - use /companion route for AI chat */}
          </div>

          {/* WORKING CURRENT STEP */}
          <div style={{
            position: 'relative',
            zIndex: 1000,
            padding: '32px',
            marginBottom: '24px',
            backgroundColor: '#fff',
            border: '2px solid #e5e7eb',
            borderRadius: '10px',
            boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1)'
          }}>
            <div className="text-center">
              <h2 className="text-2xl font-semibold text-gray-900 mb-6">
                {(() => {
                  const step = currentSession.scenario.steps[currentSession.currentStep];
                  if (!step) return '';
                  const langKey = getLangKey(selectedVoice);
                  return step.instruction[langKey] || step.instruction['en'];
                })()}
              </h2>

              {/* Step Progress Circle */}
              <div className="relative w-32 h-32 mx-auto mb-8">
                <svg className="w-32 h-32 transform -rotate-90" viewBox="0 0 100 100">
                  <circle
                    cx="50"
                    cy="50"
                    r="45"
                    stroke="currentColor"
                    strokeWidth="8"
                    fill="transparent"
                    className="text-gray-200"
                  />
                  <circle
                    cx="50"
                    cy="50"
                    r="45"
                    stroke="currentColor"
                    strokeWidth="8"
                    fill="transparent"
                    strokeDasharray={`${2 * Math.PI * 45}`}
                    strokeDashoffset={`${2 * Math.PI * 45 * (1 - stepProgress / 100)}`}
                    className="text-blue-500 transition-all duration-300"
                  />
                </svg>
                <div className="absolute inset-0 flex items-center justify-center">
                  <span className="text-2xl font-bold text-gray-700">{Math.round(stepProgress)}%</span>
                </div>
              </div>

              {/* Status Indicators */}
              <div className="flex justify-center gap-6 mb-8">
                <div className="flex items-center gap-2">
                  <div className={`w-3 h-3 rounded-full ${isPlaying ? 'bg-blue-500 animate-pulse' : 'bg-gray-300'}`}></div>
                  <span className="text-sm text-gray-600">Voice Guide</span>
                </div>
                <div className="flex items-center gap-2">
                  <div className={`w-3 h-3 rounded-full ${isListening ? 'bg-red-500 animate-pulse' : 'bg-gray-300'}`}></div>
                  <span className="text-sm text-gray-600">Listening</span>
                </div>
                <div className="flex items-center gap-2">
                  <div className={`w-3 h-3 rounded-full ${isPaused ? 'bg-yellow-500' : 'bg-green-500'}`}></div>
                  <span className="text-sm text-gray-600">{isPaused ? 'Paused' : 'Active'}</span>
                </div>
              </div>

              {/* Debug Info */}
              <div className="mb-4 p-3 bg-gray-100 rounded-lg text-xs text-gray-600">
                <p>Debug: isPaused={isPaused.toString()}, showChoices={showChoices.toString()}, waitingForVoice={waitingForVoice.toString()}</p>
                <p>Current Step: {currentSession.currentStep + 1}/{selectedScenario?.steps.length || 0}</p>
                <p>Points: {currentSession.points}</p>
                <p>üåç Language: {getLangKey(selectedVoice)} | Voice: {selectedVoice.name} ({selectedVoice.language})</p>
                <p>üé§ STT Language: {selectedVoice.language} | Expected: {(() => {
                  const step = selectedScenario?.steps[currentSession.currentStep];
                  if (step?.expectedResponse) {
                    const langKey = getLangKey(selectedVoice);
                    return step.expectedResponse[langKey] || step.expectedResponse['en'];
                  }
                  return 'No expected response';
                })()}</p>
              </div>

              {/* WORKING CHOICE BUTTONS */}
              {showChoices && currentSession && selectedScenario && !isPaused && (
                <div style={{
                  position: 'relative',
                  zIndex: 1000,
                  padding: '20px',
                  margin: '20px 0',
                  backgroundColor: '#fff',
                  border: '2px solid #e9ecef',
                  borderRadius: '10px'
                }}>
                  <h3 style={{ margin: '0 0 15px 0', color: '#333', fontSize: '18px', textAlign: 'center' }}>
                    Choose your response:
                  </h3>

                  <div style={{
                    display: 'grid',
                    gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))',
                    gap: '15px',
                    marginBottom: '15px'
                  }}>
                    {selectedScenario.steps[currentSession.currentStep]?.choices?.map((choice) => (
                      <button
                        key={choice.id}
                        style={{
                          padding: '20px',
                          backgroundColor: '#fff',
                          border: '2px solid #dee2e6',
                          borderRadius: '10px',
                          cursor: 'pointer',
                          textAlign: 'center',
                          transition: 'all 0.2s',
                          display: 'flex',
                          flexDirection: 'column',
                          alignItems: 'center',
                          gap: '10px',
                          minHeight: '120px',
                          justifyContent: 'center'
                        }}
                        onMouseEnter={(e) => {
                          e.currentTarget.style.borderColor = '#6f42c1';
                          e.currentTarget.style.backgroundColor = '#f8f9ff';
                          e.currentTarget.style.transform = 'scale(1.02)';
                        }}
                        onMouseLeave={(e) => {
                          e.currentTarget.style.borderColor = '#dee2e6';
                          e.currentTarget.style.backgroundColor = '#fff';
                          e.currentTarget.style.transform = 'scale(1)';
                        }}
                        onClick={() => {
                          console.log('Choice clicked:', choice.text, 'Points:', choice.points);

                          if (!currentSession) {
                            console.log('No current session for choice handling');
                            return;
                          }

                          // Handle choice immediately
                          setCelebrationMode(true);
                          setShowChoices(false);

                          // Add points and choice to session
                          const updatedSession = {
                            ...currentSession,
                            points: currentSession.points + choice.points,
                            userChoices: [...currentSession.userChoices, choice.id]
                          };
                          setCurrentSession(updatedSession);

                          // Get translated response
                          const langKey = getLangKey(selectedVoice);
                          const responseText = choice.response[langKey] || choice.response['en']; // Get translated response
                          const feedbackMessage = `${responseText} (+${choice.points} points!)`;
                          setCurrentFeedback(feedbackMessage);

                          // Speak the response if enabled
                          if (autoPlayVoice && !isPaused) {
                            setIsPlaying(true);
                            speakText(responseText, selectedVoice) // Speak the translated response
                              .finally(() => setIsPlaying(false));
                          }

                          setCelebrationMode(false);
                          console.log('Choice handling complete, points added:', choice.points);
                        }}
                        disabled={isPlaying}
                      >
                        <span style={{ fontSize: '36px' }}>{choice.emoji}</span>
                        <span style={{ fontSize: '16px', fontWeight: '500', color: '#333' }}>
                          {(() => {
                            const langKey = getLangKey(selectedVoice);
                            return choice.text[langKey] || choice.text['en'];
                          })()}
                        </span>
                        <span style={{ fontSize: '12px', color: '#6c757d' }}>+{choice.points} points</span>
                      </button>
                    ))}
                  </div>

                  <p style={{
                    fontSize: '14px',
                    color: '#6c757d',
                    textAlign: 'center',
                    margin: '0'
                  }}>
                    üí° Click any option above to continue. The AI will respond to your choice!
                  </p>
                </div>
              )}

              {/* Paused State */}
              {isPaused && (
                <div className="mb-6 p-6 bg-yellow-50 border-2 border-yellow-200 rounded-lg">
                  <div className="text-center">
                    <span className="text-4xl mb-2 block">‚è∏Ô∏è</span>
                    <p className="text-lg font-medium text-yellow-800">Session Paused</p>
                    <p className="text-sm text-yellow-600 mb-4">Take your time. Resume when you're ready to continue.</p>
                    <button
                      style={{
                        padding: '12px 20px',
                        backgroundColor: '#ffc107',
                        color: 'white',
                        border: 'none',
                        borderRadius: '6px',
                        cursor: 'pointer',
                        fontSize: '16px',
                        fontWeight: '500'
                      }}
                      onMouseEnter={(e) => e.currentTarget.style.backgroundColor = '#e0a800'}
                      onMouseLeave={(e) => e.currentTarget.style.backgroundColor = '#ffc107'}
                      onClick={() => setIsPaused(false)}
                    >
                      ‚ñ∂Ô∏è Resume Session
                    </button>
                  </div>
                </div>
              )}

              {/* WORKING VOICE INPUT SECTION */}
              {waitingForVoice && !isPaused && (
                <div style={{
                  position: 'relative',
                  zIndex: 1000,
                  textAlign: 'center',
                  marginBottom: '24px',
                  padding: '20px',
                  backgroundColor: '#fff',
                  border: '2px solid #e9ecef',
                  borderRadius: '10px'
                }}>
                  <div style={{
                    display: 'inline-flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    width: '96px',
                    height: '96px',
                    borderRadius: '50%',
                    marginBottom: '16px',
                    backgroundColor: isListening ? '#dc3545' : '#007bff',
                    boxShadow: isListening ? '0 10px 25px rgba(220, 53, 69, 0.3)' : '0 4px 15px rgba(0, 123, 255, 0.2)',
                    animation: isListening ? 'pulse 2s infinite' : 'none'
                  }}>
                    <Mic style={{ width: '40px', height: '40px', color: 'white' }} />
                  </div>
                  <h3 style={{
                    fontSize: '20px',
                    fontWeight: '600',
                    color: '#333',
                    marginBottom: '8px'
                  }}>
                    {isListening ? 'üé§ Listening... Speak now!' : 'üéØ Voice Challenge'}
                  </h3>
                  <p style={{
                    color: '#6c757d',
                    marginBottom: '16px',
                    fontSize: '16px'
                  }}>
                    {(() => {
                      const step = selectedScenario?.steps[currentSession.currentStep];
                      if (step?.expectedResponse) {
                        const langKey = getLangKey(selectedVoice);
                        const expectedText = step.expectedResponse[langKey] || step.expectedResponse['en'];
                        const tryText = {
                          en: 'Try saying:',
                          hi: '‡§ï‡§π‡§®‡•á ‡§ï‡•Ä ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞‡•á‡§Ç:',
                          mr: '‡§Æ‡•ç‡§π‡§£‡§£‡•ç‡§Ø‡§æ‡§ö‡§æ ‡§™‡•ç‡§∞‡§Ø‡§§‡•ç‡§® ‡§ï‡§∞‡§æ:'
                        };
                        return `${tryText[langKey] || tryText['en']} "${expectedText}"`;
                      } else {
                        const freeText = {
                          en: 'Express yourself freely and let your voice be heard!',
                          hi: '‡§Ö‡§™‡§®‡•á ‡§Ü‡§™ ‡§ï‡•ã ‡§∏‡•ç‡§µ‡§§‡§Ç‡§§‡•ç‡§∞ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§Ö‡§™‡§®‡•Ä ‡§Ü‡§µ‡§æ‡§ú‡§º ‡§∏‡•Å‡§®‡§æ‡§è‡§Ç!',
                          mr: '‡§∏‡•ç‡§µ‡§§‡§É‡§≤‡§æ ‡§Æ‡•Å‡§ï‡•ç‡§§‡§™‡§£‡•á ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§ ‡§ï‡§∞‡§æ ‡§Ü‡§£‡§ø ‡§§‡•Å‡§Æ‡§ö‡§æ ‡§Ü‡§µ‡§æ‡§ú ‡§ê‡§ï‡§µ‡§æ!'
                        };
                        const langKey = getLangKey(selectedVoice);
                        return freeText[langKey] || freeText['en'];
                      }
                    })()}
                  </p>

                  <div style={{
                    display: 'flex',
                    justifyContent: 'center',
                    gap: '12px',
                    marginBottom: '24px'
                  }}>
                    <button
                      style={{
                        padding: '15px 25px',
                        backgroundColor: isListening ? '#dc3545' : '#007bff',
                        color: 'white',
                        border: 'none',
                        borderRadius: '8px',
                        cursor: 'pointer',
                        fontSize: '16px',
                        fontWeight: '500',
                        display: 'flex',
                        alignItems: 'center',
                        gap: '8px',
                        opacity: (isPlaying || isPaused) ? 0.5 : 1,
                        position: 'relative',
                        zIndex: 1001
                      }}
                      onClick={() => {
                        console.log('Start Speaking button clicked!');
                        if (isListening) {
                          stopListening();
                        } else {
                          startListening();
                        }
                      }}
                      disabled={isPlaying || isPaused}
                    >
                      {isListening ? (
                        <>
                          <MicOff className="w-5 h-5" />
                          Stop Recording
                        </>
                      ) : (
                        <>
                          <Mic className="w-5 h-5" />
                          Start Speaking
                        </>
                      )}
                    </button>

                    <button
                      style={{
                        padding: '12px 16px',
                        backgroundColor: '#fff',
                        color: '#6c757d',
                        border: '1px solid #dee2e6',
                        borderRadius: '6px',
                        cursor: 'pointer',
                        fontSize: '14px',
                        display: 'flex',
                        alignItems: 'center',
                        gap: '8px',
                        opacity: isPlaying ? 0.5 : 1
                      }}
                      onClick={() => {
                        const currentStep = selectedScenario?.steps[currentSession.currentStep];
                        if (currentStep?.voiceGuide) {
                          const langKey = getLangKey(selectedVoice);
                          const guideText = currentStep.voiceGuide[langKey] || currentStep.voiceGuide['en'];
                          speakText(guideText, selectedVoice);
                        }
                      }}
                      disabled={isPlaying}
                    >
                      <Play className="w-4 h-4" />
                      Hear Instructions Again
                    </button>
                  </div>

                  {/* Voice Analysis Display */}
                  {voiceAnalysisResults.length > 0 && (
                    <div style={{
                      maxWidth: '500px',
                      margin: '0 auto 16px auto',
                      padding: '16px',
                      backgroundColor: '#f0f9ff',
                      border: '1px solid #22c55e',
                      borderRadius: '8px'
                    }}>
                      <p style={{ fontSize: '14px', color: '#15803d', fontWeight: '500', marginBottom: '4px' }}>‚úÖ Last recording:</p>
                      <p style={{ color: '#166534', fontWeight: '500' }}>"{voiceAnalysisResults[voiceAnalysisResults.length - 1]?.transcript}"</p>
                      <p style={{ fontSize: '12px', color: '#16a34a', marginTop: '4px' }}>Great job using your voice!</p>
                    </div>
                  )}

                  {/* Rich Voice Analysis Visualization */}
                  {voiceAnalysisResults.length > 0 && (
                    <div style={{
                      maxWidth: '600px',
                      margin: '0 auto 20px auto',
                      padding: '20px',
                      backgroundColor: 'rgba(255, 255, 255, 0.95)',
                      border: '1px solid #e5e7eb',
                      borderRadius: '12px',
                      boxShadow: '0 4px 6px rgba(0, 0, 0, 0.1)'
                    }}>
                      {(() => {
                        const latestAnalysis = voiceAnalysisResults[voiceAnalysisResults.length - 1];
                        if (!latestAnalysis) return null;

                        const { emotionalIndicators, mentalHealthIndicators, linguisticFeatures } = latestAnalysis;

                        return (
                          <>
                            <h3 style={{ fontSize: '16px', fontWeight: '600', color: '#374151', marginBottom: '16px', textAlign: 'center' }}>
                              üé§ Voice Analysis Insights
                            </h3>

                            {/* Emotional Indicators */}
                            <div style={{ marginBottom: '16px' }}>
                              <h4 style={{ fontSize: '14px', fontWeight: '500', color: '#6b7280', marginBottom: '8px' }}>Emotional State</h4>
                              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(120px, 1fr))', gap: '8px' }}>
                                <div style={{ padding: '8px', backgroundColor: '#fef3c7', borderRadius: '6px', textAlign: 'center' }}>
                                  <div style={{ fontSize: '18px' }}>
                                    {emotionalIndicators.tone === 'happy' ? 'üòä' :
                                      emotionalIndicators.tone === 'calm' ? 'üòå' :
                                        emotionalIndicators.tone === 'stressed' ? 'üò∞' :
                                          emotionalIndicators.tone === 'anxious' ? 'üòü' :
                                            emotionalIndicators.tone === 'sad' ? 'üò¢' : 'üòê'}
                                  </div>
                                  <div style={{ fontSize: '12px', fontWeight: '500', color: '#92400e', textTransform: 'capitalize' }}>
                                    {emotionalIndicators.tone}
                                  </div>
                                </div>
                                <div style={{ padding: '8px', backgroundColor: '#dbeafe', borderRadius: '6px', textAlign: 'center' }}>
                                  <div style={{ fontSize: '14px', fontWeight: '600', color: '#1e40af' }}>
                                    {Math.round(emotionalIndicators.intensity * 100)}%
                                  </div>
                                  <div style={{ fontSize: '12px', color: '#3730a3' }}>Intensity</div>
                                </div>
                                <div style={{ padding: '8px', backgroundColor: '#dcfce7', borderRadius: '6px', textAlign: 'center' }}>
                                  <div style={{ fontSize: '14px', fontWeight: '600', color: '#166534', textTransform: 'capitalize' }}>
                                    {emotionalIndicators.speechRate}
                                  </div>
                                  <div style={{ fontSize: '12px', color: '#15803d' }}>Speech Rate</div>
                                </div>
                              </div>
                            </div>

                            {/* Mental Health Indicators */}
                            <div style={{ marginBottom: '16px' }}>
                              <h4 style={{ fontSize: '14px', fontWeight: '500', color: '#6b7280', marginBottom: '8px' }}>Wellness Indicators</h4>
                              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(140px, 1fr))', gap: '8px' }}>
                                <div style={{ padding: '8px', backgroundColor: '#fef2f2', borderRadius: '6px' }}>
                                  <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
                                    <span style={{ fontSize: '12px', color: '#7f1d1d' }}>Stress Level</span>
                                    <span style={{ fontSize: '14px', fontWeight: '600', color: '#dc2626' }}>
                                      {Math.round(mentalHealthIndicators.stressLevel * 100)}%
                                    </span>
                                  </div>
                                  <div style={{
                                    width: '100%',
                                    height: '4px',
                                    backgroundColor: '#fee2e2',
                                    borderRadius: '2px',
                                    marginTop: '4px',
                                    overflow: 'hidden'
                                  }}>
                                    <div style={{
                                      width: `${mentalHealthIndicators.stressLevel * 100}%`,
                                      height: '100%',
                                      backgroundColor: mentalHealthIndicators.stressLevel > 0.7 ? '#dc2626' :
                                        mentalHealthIndicators.stressLevel > 0.4 ? '#f59e0b' : '#10b981',
                                      transition: 'width 0.3s ease'
                                    }}></div>
                                  </div>
                                </div>
                                <div style={{ padding: '8px', backgroundColor: '#f0f9ff', borderRadius: '6px' }}>
                                  <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
                                    <span style={{ fontSize: '12px', color: '#1e40af' }}>Emotional Regulation</span>
                                    <span style={{ fontSize: '14px', fontWeight: '600', color: '#2563eb' }}>
                                      {Math.round(mentalHealthIndicators.emotionalRegulation * 100)}%
                                    </span>
                                  </div>
                                  <div style={{
                                    width: '100%',
                                    height: '4px',
                                    backgroundColor: '#dbeafe',
                                    borderRadius: '2px',
                                    marginTop: '4px',
                                    overflow: 'hidden'
                                  }}>
                                    <div style={{
                                      width: `${mentalHealthIndicators.emotionalRegulation * 100}%`,
                                      height: '100%',
                                      backgroundColor: '#2563eb',
                                      transition: 'width 0.3s ease'
                                    }}></div>
                                  </div>
                                </div>
                              </div>
                            </div>

                            {/* Linguistic Features */}
                            {linguisticFeatures.emotionalWords.length > 0 && (
                              <div style={{ marginBottom: '12px' }}>
                                <h4 style={{ fontSize: '14px', fontWeight: '500', color: '#6b7280', marginBottom: '8px' }}>Emotional Expression</h4>
                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '4px' }}>
                                  {linguisticFeatures.emotionalWords.slice(0, 5).map((word, index) => (
                                    <span key={index} style={{
                                      padding: '4px 8px',
                                      backgroundColor: '#ecfdf5',
                                      color: '#065f46',
                                      fontSize: '12px',
                                      fontWeight: '500',
                                      borderRadius: '12px',
                                      border: '1px solid #a7f3d0'
                                    }}>
                                      {word}
                                    </span>
                                  ))}
                                </div>
                              </div>
                            )}

                            {/* Recommendations */}
                            {latestAnalysis.recommendations.immediate.length > 0 && (
                              <div style={{
                                padding: '12px',
                                backgroundColor: '#f0fdf4',
                                borderRadius: '8px',
                                border: '1px solid #bbf7d0'
                              }}>
                                <h4 style={{ fontSize: '14px', fontWeight: '500', color: '#166534', marginBottom: '6px' }}>
                                  üí° Personalized Insights
                                </h4>
                                <p style={{ fontSize: '13px', color: '#15803d', lineHeight: '1.4' }}>
                                  {latestAnalysis.recommendations.immediate[0]}
                                </p>
                              </div>
                            )}
                          </>
                        );
                      })()}
                    </div>
                  )}

                  <div style={{ display: 'flex', justifyContent: 'center' }}>
                    <button
                      style={{
                        padding: '12px 16px',
                        backgroundColor: '#fff',
                        color: '#6c757d',
                        border: '1px solid #dee2e6',
                        borderRadius: '6px',
                        cursor: 'pointer',
                        fontSize: '14px',
                        display: 'flex',
                        alignItems: 'center',
                        gap: '8px',
                        opacity: isPlaying ? 0.5 : 1,
                        position: 'relative',
                        zIndex: 1001
                      }}
                      onClick={() => {
                        console.log('Skip This Step button clicked');
                        if (!currentSession || !selectedScenario) return;

                        const nextStepIndex = currentSession.currentStep + 1;
                        if (nextStepIndex >= selectedScenario.steps.length) {
                          setIsActive(false);
                          setShowCompletion(true);
                          return;
                        }

                        const updatedSession = {
                          ...currentSession,
                          currentStep: nextStepIndex,
                          progress: (nextStepIndex / selectedScenario.steps.length) * 100
                        };
                        setCurrentSession(updatedSession);
                        setShowChoices(false);
                        setWaitingForVoice(false);
                        setCurrentFeedback('');

                        const step = selectedScenario.steps[nextStepIndex];
                        if (step?.type === 'choice') {
                          setShowChoices(true);
                        } else if (step?.type === 'voice') {
                          setWaitingForVoice(true);
                        }
                      }}
                      disabled={isPlaying}
                    >
                      <ArrowRight className="w-4 h-4" />
                      Skip This Step
                    </button>
                  </div>
                </div>
              )}

              {/* WORKING FEEDBACK DISPLAY */}
              {currentFeedback && (
                <div style={{
                  position: 'relative',
                  zIndex: 1000,
                  padding: '24px',
                  borderRadius: '8px',
                  marginBottom: '24px',
                  textAlign: 'center',
                  backgroundColor: celebrationMode ? '#f0f9ff' : '#eff6ff',
                  border: celebrationMode ? '2px solid #22c55e' : '2px solid #3b82f6'
                }}>
                  <p style={{
                    fontSize: '18px',
                    fontWeight: '500',
                    color: '#333',
                    margin: '0'
                  }}>{currentFeedback}</p>
                  {celebrationMode && (
                    <div style={{ marginTop: '8px' }}>
                      <span style={{ fontSize: '32px' }}>üéâ</span>
                      <span style={{
                        marginLeft: '8px',
                        fontSize: '14px',
                        fontWeight: '500',
                        color: '#16a34a'
                      }}>
                        +{currentSession?.points || 0} points!
                      </span>
                    </div>
                  )}
                </div>
              )}

              {/* WORKING BREATHING EXERCISE */}
              {selectedScenario?.steps[currentSession.currentStep]?.type === 'breathing' && !showChoices && !waitingForVoice && !isPaused && (
                <div style={{
                  position: 'relative',
                  zIndex: 1000,
                  textAlign: 'center',
                  marginBottom: '24px',
                  padding: '20px',
                  backgroundColor: '#fff',
                  border: '2px solid #e9ecef',
                  borderRadius: '10px'
                }}>
                  <div style={{
                    display: 'inline-flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    width: '80px',
                    height: '80px',
                    borderRadius: '50%',
                    marginBottom: '16px',
                    backgroundColor: '#28a745'
                  }}>
                    <span style={{ fontSize: '32px' }}>ü´Å</span>
                  </div>
                  <h3 style={{
                    fontSize: '20px',
                    fontWeight: '600',
                    color: '#333',
                    marginBottom: '16px'
                  }}>Breathing Exercise</h3>
                  <p style={{
                    color: '#6c757d',
                    marginBottom: '24px',
                    fontSize: '16px'
                  }}>Take deep, calming breaths at your own pace. Focus on your breathing and let go of any tension.</p>

                  <div style={{
                    display: 'flex',
                    justifyContent: 'center',
                    gap: '16px',
                    marginBottom: '16px'
                  }}>
                    <button
                      style={{
                        padding: '15px 25px',
                        backgroundColor: '#28a745',
                        color: 'white',
                        border: 'none',
                        borderRadius: '8px',
                        cursor: 'pointer',
                        fontSize: '16px',
                        fontWeight: '500',
                        opacity: isPlaying ? 0.5 : 1,
                        position: 'relative',
                        zIndex: 1001
                      }}
                      onMouseEnter={(e) => e.currentTarget.style.backgroundColor = '#218838'}
                      onMouseLeave={(e) => e.currentTarget.style.backgroundColor = '#28a745'}
                      onClick={() => {
                        console.log('Start Breathing Exercise button clicked!');
                        const step = selectedScenario?.steps[currentSession.currentStep];
                        if (step) {
                          setWaitingForVoice(false);
                          setShowChoices(false);
                          setCelebrationMode(true);

                          if (currentSession) {
                            const updatedSession = {
                              ...currentSession,
                              points: currentSession.points + (step.points || 20)
                            };
                            setCurrentSession(updatedSession);
                          }

                          const breathingGuide = "Let's breathe together. Inhale slowly for 4 counts... hold for 4... and exhale for 6. Take your time and breathe at your own pace.";
                          setCurrentFeedback(`${breathingGuide} (+${step.points || 20} points!)`);

                          if (autoPlayVoice) {
                            setIsPlaying(true);
                            speakText(breathingGuide, selectedVoice)
                              .finally(() => setIsPlaying(false));
                          }

                          setCelebrationMode(false);
                        }
                      }}
                      disabled={isPlaying}
                    >
                      ü´Å Start Breathing Exercise
                    </button>

                    <button
                      style={{
                        padding: '12px 20px',
                        backgroundColor: '#fff',
                        color: '#6c757d',
                        border: '1px solid #dee2e6',
                        borderRadius: '6px',
                        cursor: 'pointer',
                        fontSize: '14px',
                        display: 'flex',
                        alignItems: 'center',
                        gap: '8px',
                        opacity: isPlaying ? 0.5 : 1
                      }}
                      onClick={() => {
                        const currentStep = selectedScenario?.steps[currentSession.currentStep];
                        if (currentStep?.voiceGuide) {
                          const langKey = getLangKey(selectedVoice);
                          const guideText = currentStep.voiceGuide[langKey] || currentStep.voiceGuide['en'];
                          setIsPlaying(true);
                          speakText(guideText, selectedVoice);
                        }
                      }}
                      disabled={isPlaying}
                    >
                      <Play className="w-4 h-4" />
                      Hear Guidance
                    </button>
                  </div>
                </div>
              )}

              {/* WORKING STEP NAVIGATION */}
              {!showChoices && !waitingForVoice && selectedScenario?.steps[currentSession.currentStep]?.type !== 'breathing' && !isPaused && (
                <div style={{
                  position: 'relative',
                  zIndex: 1000,
                  display: 'flex',
                  justifyContent: 'center',
                  gap: '15px',
                  padding: '20px',
                  margin: '20px 0'
                }}>
                  {currentFeedback && (
                    <button
                      style={{
                        padding: '12px 20px',
                        backgroundColor: '#fff',
                        color: '#6c757d',
                        border: '1px solid #dee2e6',
                        borderRadius: '6px',
                        cursor: 'pointer',
                        fontSize: '14px'
                      }}
                      onClick={() => {
                        console.log('Clear Feedback button clicked');
                        setCurrentFeedback('');
                      }}
                    >
                      Clear Feedback
                    </button>
                  )}
                  <button
                    style={{
                      padding: '15px 25px',
                      background: 'linear-gradient(to right, #007bff, #6f42c1)',
                      color: 'white',
                      border: 'none',
                      borderRadius: '8px',
                      cursor: 'pointer',
                      fontSize: '16px',
                      fontWeight: '500',
                      display: 'flex',
                      alignItems: 'center',
                      gap: '8px'
                    }}
                    onClick={() => {
                      console.log('Next Step button clicked');

                      if (!currentSession || !selectedScenario) {
                        console.log('Cannot proceed: missing session or scenario');
                        return;
                      }

                      const nextStepIndex = currentSession.currentStep + 1;

                      // Check if we've completed all steps
                      if (nextStepIndex >= selectedScenario.steps.length) {
                        console.log('All steps completed, finishing session');
                        setIsActive(false);
                        setShowCompletion(true);
                        return;
                      }

                      // Update session
                      const updatedSession = {
                        ...currentSession,
                        currentStep: nextStepIndex,
                        progress: (nextStepIndex / selectedScenario.steps.length) * 100
                      };

                      console.log('Updating session to step:', nextStepIndex);
                      setCurrentSession(updatedSession);

                      // Reset UI state
                      setShowChoices(false);
                      setWaitingForVoice(false);
                      setCelebrationMode(false);
                      setCurrentFeedback('');

                      // Execute next step
                      setTimeout(() => {
                        const step = selectedScenario.steps[nextStepIndex];
                        if (step) {
                          console.log(`Executing step ${nextStepIndex + 1}: ${step.title}`);

                          // Handle different step types
                          if (step.type === 'choice') {
                            setShowChoices(true);
                            setCurrentFeedback("Choose one of the options below to continue:");
                          } else if (step.type === 'voice') {
                            setWaitingForVoice(true);
                            setCurrentFeedback("Click 'Start Speaking' when you're ready to use your voice:");
                          } else if (step.type === 'breathing') {
                            setCurrentFeedback("Take your time with this breathing exercise. Click 'Start' when ready:");
                          } else {
                            setCurrentFeedback("Read the instruction above and click 'Continue' when you're ready:");
                          }

                          // Speak voice guide if enabled
                          if (autoPlayVoice && !isPaused) {
                            const langKey = getLangKey(selectedVoice);
                            const guideText = step.voiceGuide[langKey] || step.voiceGuide['en'];
                            speakText(guideText, selectedVoice);
                          }
                        }
                      }, 500);
                    }}
                  >
                    <ArrowRight className="w-4 h-4" />
                    {currentSession.currentStep + 1 >= currentSession.scenario.steps.length ? 'Complete Session' : 'Next Step'}
                  </button>
                  <button
                    style={{
                      padding: '12px 20px',
                      backgroundColor: '#fff',
                      color: '#28a745',
                      border: '2px solid #28a745',
                      borderRadius: '6px',
                      cursor: 'pointer',
                      fontSize: '14px',
                      fontWeight: '500',
                      display: 'flex',
                      alignItems: 'center',
                      gap: '8px'
                    }}
                    onClick={() => {
                      console.log('Finish Now button clicked');

                      setIsActive(false);

                      if (currentSession) {
                        // Calculate achievements
                        const achievements: string[] = [];
                        if (currentSession.points >= 100) achievements.push('üèÜ Point Master');
                        if (currentSession.points >= 150) achievements.push('‚≠ê Superstar');
                        if (currentSession.voiceAnalysis.length >= 2) achievements.push('üé§ Voice Champion');
                        if (currentSession.userChoices.length >= 2) achievements.push('üéØ Decision Maker');
                        if (sessionTime >= 300) achievements.push('‚è∞ Dedicated Practitioner');
                        achievements.push('‚ú® Session Complete');

                        const completedSession = {
                          ...currentSession,
                          completed: true,
                          progress: 100,
                          achievements
                        };
                        setCurrentSession(completedSession);
                      }

                      setShowCompletion(true);
                      setCelebrationMode(true);

                      if (autoPlayVoice) {
                        speakText(
                          `Wonderful! You've completed your session and earned ${currentSession?.points || 0} points! You took control of your journey and that's amazing!`,
                          selectedVoice
                        );
                      }
                    }}
                  >
                    <CheckCircle className="w-4 h-4" />
                    Finish Now
                  </button>
                </div>
              )}

              {/* WORKING CONTINUE BUTTON */}
              {(showChoices || waitingForVoice || selectedScenario?.steps[currentSession.currentStep]?.type === 'breathing') && !isPaused && (
                <div style={{
                  display: 'flex',
                  justifyContent: 'center',
                  marginTop: '20px',
                  position: 'relative',
                  zIndex: 1000
                }}>
                  <button
                    style={{
                      padding: '12px 20px',
                      backgroundColor: '#fff',
                      color: '#6c757d',
                      border: '1px solid #dee2e6',
                      borderRadius: '6px',
                      cursor: 'pointer',
                      fontSize: '14px',
                      display: 'flex',
                      alignItems: 'center',
                      gap: '8px'
                    }}
                    onClick={() => {
                      console.log('Continue to Next Step button clicked');

                      if (!currentSession || !selectedScenario) {
                        console.log('Cannot proceed: missing session or scenario');
                        return;
                      }

                      const nextStepIndex = currentSession.currentStep + 1;

                      // Check if we've completed all steps
                      if (nextStepIndex >= selectedScenario.steps.length) {
                        console.log('All steps completed, finishing session');
                        setIsActive(false);
                        setShowCompletion(true);
                        return;
                      }

                      // Update session
                      const updatedSession = {
                        ...currentSession,
                        currentStep: nextStepIndex,
                        progress: (nextStepIndex / selectedScenario.steps.length) * 100
                      };

                      console.log('Updating session to step:', nextStepIndex);
                      setCurrentSession(updatedSession);

                      // Reset UI state
                      setShowChoices(false);
                      setWaitingForVoice(false);
                      setCelebrationMode(false);
                      setCurrentFeedback('');

                      // Execute next step
                      setTimeout(() => {
                        const step = selectedScenario.steps[nextStepIndex];
                        if (step) {
                          console.log(`Executing step ${nextStepIndex + 1}: ${step.title}`);

                          // Handle different step types
                          if (step.type === 'choice') {
                            setShowChoices(true);
                            setCurrentFeedback("Choose one of the options below to continue:");
                          } else if (step.type === 'voice') {
                            setWaitingForVoice(true);
                            setCurrentFeedback("Click 'Start Speaking' when you're ready to use your voice:");
                          } else if (step.type === 'breathing') {
                            setCurrentFeedback("Take your time with this breathing exercise. Click 'Start' when ready:");
                          } else {
                            setCurrentFeedback("Read the instruction above and click 'Continue' when you're ready:");
                          }

                          // Speak voice guide if enabled
                          if (autoPlayVoice && !isPaused) {
                            const langKey = getLangKey(selectedVoice);
                            const guideText = step.voiceGuide[langKey] || step.voiceGuide['en'];
                            speakText(guideText, selectedVoice);
                          }
                        }
                      }, 500);
                    }}
                  >
                    <ArrowRight className="w-4 h-4" />
                    Continue to Next Step
                  </button>
                </div>
              )}
            </div>
          </div>

          {/* WORKING RECENT VOICE ANALYSIS */}
          {voiceAnalysisResults.length > 0 && (
            <div style={{
              position: 'relative',
              zIndex: 1000,
              padding: '24px',
              backgroundColor: '#fff',
              border: '2px solid #e5e7eb',
              borderRadius: '10px',
              boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1)'
            }}>
              <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
                <Heart className="w-5 h-5 text-red-500" />
                Your Voice Journey
              </h3>
              <div className="space-y-3">
                {voiceAnalysisResults.slice(-2).map((result, index) => (
                  <div key={index} className="p-4 bg-gray-50 rounded-lg">
                    <div className="flex items-center justify-between mb-2">
                      <span className="text-sm font-medium text-gray-900 capitalize">
                        {result.emotionalIndicators.tone} tone
                      </span>
                      <span className="text-xs text-gray-500">
                        {Math.round(result.confidence * 100)}% confidence
                      </span>
                    </div>
                    <p className="text-sm text-gray-700 italic mb-2">"{result.transcript}"</p>
                    {result.recommendations.immediate.length > 0 && (
                      <p className="text-xs text-blue-600">
                        üí° {result.recommendations.immediate[0]}
                      </p>
                    )}
                  </div>
                ))}
              </div>
            </div>
          )}
        </div>
      )}
    </div>
  );
}